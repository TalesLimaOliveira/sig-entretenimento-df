<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pontos de Entretenimento DF</title>
    
    <!-- Favico                console.log('DOM pronto');
            }
            
            async checkDependencies() {
                console.log('Verificando depend√™ncias...');
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 fill=%22%23ff69b4%22/><text x=%2250%22 y=%2270%22 font-size=%2260%22 text-anchor=%22middle%22 fill=%22white%22>üë†</text></svg>" type="image/svg+xml">
    
    <!-- CSS - Layout Responsivo Otimizado -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="src/css/colors.css">
    <link rel="stylesheet" href="src/css/main.css">
    <link rel="stylesheet" href="src/css/components.css">
    
    <!-- Meta -->
    <meta name="description" content="Mapa interativo responsivo com pontos de entretenimento do Distrito Federal">
    <meta name="keywords" content="DF, entretenimento, mapa, pontos tur√≠sticos, responsivo">
</head>
<body class="theme-dark">
    <!-- Loading -->
    <div class="loading-screen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">Carregando Mapa...</div>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <!-- Navigation Buttons -->
                <nav class="header-navigation">
                    <div class="nav-buttons-container" id="nav-buttons-container">
                        <!-- Categorias ser√£o geradas dinamicamente pelo JavaScript -->
                    </div>
                </nav>
                
                <div class="header-actions">
                    <!-- Desktop Actions -->
                    <div class="desktop-actions">
                        <!-- Login Button -->
                        <button class="login-btn desktop" id="desktop-login-btn">
                            <i class="fas fa-user"></i>
                            <span class="login-btn-text">ENTRAR</span>
                        </button>
                    </div>
                    
                    <!-- Mobile Actions - sempre vis√≠veis em mobile/tablet -->
                    <div class="mobile-actions">
                        <!-- Login Button Mobile -->
                        <button class="login-btn mobile" id="mobile-login-btn">
                            <i class="fas fa-user"></i>
                            <span class="login-btn-text">ENTRAR</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <!-- Painel Lateral de Informa√ß√µes -->
            <div id="info-panel" class="info-panel hidden">
                <!-- Header do Painel com Imagem e Nome -->
                <div class="info-panel-header">
                    <div class="info-panel-image-container">
                        <img id="info-panel-image" class="info-panel-image" src="" alt="Imagem do local">
                        <div class="info-panel-image-placeholder">
                            <i class="fas fa-image"></i>
                            <span>Sem imagem dispon√≠vel</span>
                        </div>
                    </div>
                    <div class="info-panel-title-container">
                        <h2 id="info-panel-title">Nome do Local</h2>
                    </div>
                    <button id="info-panel-close" class="info-panel-close" aria-label="Fechar painel">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <!-- Abas do Painel -->
                <div class="info-panel-tabs">
                    <button class="info-panel-tab active" data-tab="overview">
                        <i class="fas fa-info-circle"></i>
                        Vis√£o Geral
                    </button>
                    <button class="info-panel-tab" data-tab="reviews">
                        <i class="fas fa-star"></i>
                        Avalia√ß√£o
                    </button>
                </div>

                <!-- Conte√∫do das Abas -->
                <div class="info-panel-content">
                    <!-- Aba: Vis√£o Geral -->
                    <div id="tab-overview" class="info-panel-tab-content active">
                        <!-- Informa√ß√µes do Local -->
                        <div class="info-panel-details">
                            <div id="info-panel-body">
                                <!-- Conte√∫do ser√° inserido dinamicamente -->
                            </div>
                        </div>
                    </div>

                    <!-- Aba: Avalia√ß√£o -->
                    <div id="tab-reviews" class="info-panel-tab-content">
                        <div class="info-panel-placeholder">
                            <i class="fas fa-comments"></i>
                            <h3>Coment√°rios e Avalia√ß√µes</h3>
                            <p>Esta funcionalidade estar√° dispon√≠vel em breve.</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Map -->
            <div class="map-container">
                <div id="map"></div>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="src/js/database.js"></script>
    <script src="src/js/auth.js"></script>
    <script src="src/js/info-panel.js"></script>
    <script src="src/js/map.js"></script>
    <script src="src/js/theme-colors.js"></script>
    <script src="src/components/modal.js"></script>
    <script src="src/components/login-modal.js"></script>
    <script src="src/components/user-menu.js"></script>
    <script src="src/components/add-point-modal.js"></script>
    <script src="src/components/error-handler.js"></script>
    <script src="src/js/app.js"></script>
    
    <!-- Initialize -->
    <script>
        // Sistema de inicializa√ß√£o robusto
        class AppInitializer {
            constructor() {
                this.managers = {};
                this.errors = [];
                this.initialized = false;
            }
            
            async init() {
                console.log('Iniciando sistema de inicializa√ß√£o...');
                
                try {
                    await this.waitForDOM();
                    await this.checkDependencies();
                    await this.waitForManagers();
                    await this.initializeApp();
                    
                    console.log('Sistema inicializado com sucesso!');
                    this.initialized = true;
                    
                } catch (error) {
                    console.error('Erro cr√≠tico na inicializa√ß√£o:', error);
                    this.showError(error);
                }
            }
            
            async waitForDOM() {
                if (document.readyState === 'loading') {
                    await new Promise(resolve => {
                        document.addEventListener('DOMContentLoaded', resolve);
                    });
                }
                console.log('‚úÖ DOM pronto');
            }
            
            async checkDependencies() {
                console.log('ÔøΩ Verificando depend√™ncias...');
                
                // Verificar Leaflet
                if (typeof L === 'undefined') {
                    throw new Error('Leaflet n√£o foi carregado');
                }
                
                // Verificar elemento do mapa
                const mapElement = document.getElementById('map');
                if (!mapElement) {
                    throw new Error('Elemento do mapa n√£o encontrado');
                }
                
                console.log('Depend√™ncias verificadas');
            }
            
            async waitForManagers() {
                console.log('Aguardando managers serem carregados...');
                
                const managersToCheck = [
                    { name: 'databaseManager', critical: true },
                    { name: 'authManager', critical: false },
                    { name: 'modalManager', critical: false },
                    { name: 'themeManager', critical: false },
                    { name: 'mapManager', critical: true }
                ];
                
                // Aguardar um pouco para os scripts carregarem
                await new Promise(resolve => setTimeout(resolve, 200));
                
                for (const manager of managersToCheck) {
                    const maxAttempts = 50; // 5 segundos m√°ximo
                    let attempts = 0;
                    
                    while (!window[manager.name] && attempts < maxAttempts) {
                        await new Promise(resolve => setTimeout(resolve, 100));
                        attempts++;
                    }
                    
                    if (window[manager.name]) {
                        console.log(`${manager.name} carregado`);
                        this.managers[manager.name] = window[manager.name];
                    } else {
                        const error = `${manager.name} n√£o foi carregado`;
                        console.error(error);
                        
                        if (manager.critical) {
                            throw new Error(`Manager cr√≠tico falhou: ${error}`);
                        } else {
                            this.errors.push(error);
                        }
                    }
                }
                
                if (this.errors.length > 0) {
                    console.warn('Alguns managers n√£o cr√≠ticos falharam:', this.errors);
                }
                
                console.log('Managers carregados');
            }
            
            async initializeApp() {
                console.log('Inicializando aplica√ß√£o principal...');
                
                // Aguardar um pouco mais
                await new Promise(resolve => setTimeout(resolve, 100));
                
                window.app = new PontosEntretenimentoApp();
                
                // CR√çTICO: Chamar o m√©todo init() da aplica√ß√£o
                await window.app.init();
                
                console.log('Aplica√ß√£o inicializada e pronta');
            }
            
            showError(error) {
                console.error('Stack trace:', error.stack);
                
                // Remove loading screen
                const loadingScreen = document.querySelector('.loading-screen');
                if (loadingScreen) {
                    loadingScreen.style.display = 'none';
                }
                
                // Mostra erro detalhado
                document.body.innerHTML = `
                    <div style="padding: 2rem; max-width: 800px; margin: 0 auto; font-family: Arial, sans-serif;">
                        <div style="text-align: center; color: #ef4444; margin-bottom: 2rem;">
                            <h1>Erro ao carregar a aplica√ß√£o</h1>
                            <p><strong>Detalhes:</strong> ${error.message}</p>
                        </div>
                        
                        ${this.errors.length > 0 ? `
                            <div style="margin-bottom: 2rem;">
                                <h3>Warnings:</h3>
                                <ul style="color: #f59e0b;">
                                    ${this.errors.map(err => `<li>${err}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}
                        
                        <details style="margin: 1rem 0;">
                            <summary style="cursor: pointer; font-weight: bold;">Informa√ß√µes t√©cnicas</summary>
                            <pre style="background: #f5f5f5; padding: 1rem; border-radius: 4px; overflow-x: auto; font-size: 12px; margin-top: 1rem;">${error.stack || 'Stack trace n√£o dispon√≠vel'}</pre>
                        </details>
                    </div>
                `;
            }
        }
        
        // Iniciar o sistema
        const initializer = new AppInitializer();
        initializer.init().catch(error => {
            console.error('Erro ao inicializar aplica√ß√£o:', error);
            // Mostrar erro espec√≠fico para o usu√°rio
            const loadingScreen = document.querySelector('.loading-screen');
            if (loadingScreen) {
                loadingScreen.innerHTML = `
                    <div style="text-align: center; color: red;">
                        <h3>Erro ao carregar aplica√ß√£o</h3>
                        <p>Verifique a conex√£o com a internet e recarregue a p√°gina.</p>
                        <button onclick="location.reload()" style="padding: 10px 20px; margin-top: 10px;">
                            Recarregar
                        </button>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>
