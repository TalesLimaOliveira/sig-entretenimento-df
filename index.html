<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pontos de Entretenimento DF</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 fill=%22%23ff69b4%22/><text x=%2250%22 y=%2270%22 font-size=%2260%22 text-anchor=%22middle%22 fill=%22white%22>üë†</text></svg>" type="image/svg+xml">
    
    <!-- CSS - Layout Responsivo Otimizado -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="src/css/colors.css">
    <link rel="stylesheet" href="src/css/main.css">
    <link rel="stylesheet" href="src/css/components.css">
    
    <!-- Meta -->
    <meta name="description" content="Mapa interativo responsivo com pontos de entretenimento do Distrito Federal">
    <meta name="keywords" content="DF, entretenimento, mapa, pontos tur√≠sticos, responsivo">
</head>
<body>
    <!-- Loading -->
    <div class="loading-screen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">Carregando Mapa...</div>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <!-- Navigation Buttons -->
                <nav class="header-navigation">
                    <div class="nav-buttons-container">
                        <!-- Favoritos - s√≥ aparece se usu√°rio comum estiver logado -->
                        <button class="nav-btn category-btn favoritos-btn hidden" data-categoria="favoritos">
                            <i class="fas fa-heart"></i>
                            <span class="nav-btn-text">Favoritos</span>
                        </button>
                        <button class="nav-btn active category-btn" data-categoria="todos">
                            <i class="fas fa-globe"></i>
                            <span class="nav-btn-text">Todos</span>
                        </button>
                        <button class="nav-btn category-btn" data-categoria="geral">
                            <i class="fas fa-map-marker-alt"></i>
                            <span class="nav-btn-text">Geral</span>
                        </button>
                        <button class="nav-btn category-btn" data-categoria="esportes-lazer">
                            <i class="fas fa-futbol"></i>
                            <span class="nav-btn-text">Esportes e Lazer</span>
                        </button>
                        <button class="nav-btn category-btn" data-categoria="gastronomia">
                            <i class="fas fa-utensils"></i>
                            <span class="nav-btn-text">Gastronomia</span>
                        </button>
                        <button class="nav-btn category-btn" data-categoria="geek-nerd">
                            <i class="fas fa-gamepad"></i>
                            <span class="nav-btn-text">Geek e Nerd</span>
                        </button>
                        <button class="nav-btn category-btn" data-categoria="alternativo">
                            <i class="fas fa-palette"></i>
                            <span class="nav-btn-text">Alternativo</span>
                        </button>
                        <button class="nav-btn category-btn" data-categoria="casas-noturnas">
                            <i class="fas fa-glass-cheers"></i>
                            <span class="nav-btn-text">Casas Noturnas</span>
                        </button>
                    </div>
                </nav>
                
                <div class="header-actions">
                    <!-- Mobile Menu Button -->
                    <button class="mobile-menu-btn" id="mobile-menu-btn">
                        <i class="fas fa-bars"></i>
                    </button>
                    
                    <!-- Mobile Menu Dropdown -->
                    <div class="mobile-menu-dropdown" id="mobile-menu-dropdown">
                        <button class="mobile-menu-item theme-btn" id="theme-btn">
                            <i class="fas fa-moon" id="theme-icon"></i>
                            <span>Alternar Tema</span>
                        </button>
                        <button class="mobile-menu-item login-btn" id="mobile-login-btn">
                            <i class="fas fa-user"></i>
                            <span>Entrar</span>
                        </button>
                    </div>
                    
                    <!-- Desktop Actions -->
                    <div class="desktop-actions">
                        <!-- Theme Button -->
                        <button class="theme-btn desktop-theme-btn" id="desktop-theme-btn">
                            <i class="fas fa-moon" id="desktop-theme-icon"></i>
                        </button>
                        
                        <!-- Login Button -->
                        <button class="login-btn desktop-login-btn" id="desktop-login-btn">
                            <i class="fas fa-user"></i>
                            <span class="login-btn-text">Login</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <!-- Painel Lateral de Informa√ß√µes -->
            <div id="info-panel" class="info-panel hidden">
                <!-- Header do Painel com Imagem e Nome -->
                <div class="info-panel-header">
                    <div class="info-panel-image-container">
                        <img id="info-panel-image" class="info-panel-image" src="" alt="Imagem do local">
                        <div class="info-panel-image-placeholder">
                            <i class="fas fa-image"></i>
                            <span>Sem imagem dispon√≠vel</span>
                        </div>
                    </div>
                    <div class="info-panel-title-container">
                        <h2 id="info-panel-title">Nome do Local</h2>
                    </div>
                    <button id="info-panel-close" class="info-panel-close" aria-label="Fechar painel">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <!-- Abas do Painel -->
                <div class="info-panel-tabs">
                    <button class="info-panel-tab active" data-tab="overview">
                        <i class="fas fa-info-circle"></i>
                        Vis√£o Geral
                    </button>
                    <button class="info-panel-tab" data-tab="reviews">
                        <i class="fas fa-star"></i>
                        Avalia√ß√£o
                    </button>
                </div>

                <!-- Conte√∫do das Abas -->
                <div class="info-panel-content">
                    <!-- Aba: Vis√£o Geral -->
                    <div id="tab-overview" class="info-panel-tab-content active">
                        <!-- Informa√ß√µes do Local -->
                        <div class="info-panel-details">
                            <div id="info-panel-body">
                                <!-- Conte√∫do ser√° inserido dinamicamente -->
                            </div>
                        </div>
                    </div>

                    <!-- Aba: Avalia√ß√£o -->
                    <div id="tab-reviews" class="info-panel-tab-content">
                        <div class="info-panel-placeholder">
                            <i class="fas fa-comments"></i>
                            <h3>Coment√°rios e Avalia√ß√µes</h3>
                            <p>Esta funcionalidade estar√° dispon√≠vel em breve.</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Map -->
            <div class="map-container">
                <div id="map"></div>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="src/js/database.js"></script>
    <script src="src/js/auth.js"></script>
    <script src="src/js/info-panel.js"></script>
    <script src="src/js/map.js"></script>
    <script src="src/js/theme.js"></script>
    <script src="src/js/theme-colors.js"></script>
    <script src="src/components/modal.js"></script>
    <script src="src/components/login-modal.js"></script>
    <script src="src/components/user-menu.js"></script>
    <script src="src/components/add-point-modal.js"></script>
    <script src="src/components/error-handler.js"></script>
    <script src="src/js/app.js"></script>
    
    <!-- Initialize -->
    <script>
        // Sistema de inicializa√ß√£o robusto
        class AppInitializer {
            constructor() {
                this.managers = {};
                this.errors = [];
                this.initialized = false;
            }
            
            async init() {
                console.log('üöÄ Iniciando sistema de inicializa√ß√£o...');
                
                try {
                    await this.waitForDOM();
                    await this.checkDependencies();
                    await this.initializeManagers();
                    await this.initializeApp();
                    
                    console.log('üéâ Sistema inicializado com sucesso!');
                    this.initialized = true;
                    
                } catch (error) {
                    console.error('‚ùå Erro cr√≠tico na inicializa√ß√£o:', error);
                    this.showError(error);
                }
            }
            
            async waitForDOM() {
                if (document.readyState === 'loading') {
                    await new Promise(resolve => {
                        document.addEventListener('DOMContentLoaded', resolve);
                    });
                }
                console.log('‚úÖ DOM pronto');
            }
            
            async checkDependencies() {
                console.log('ÔøΩ Verificando depend√™ncias...');
                
                // Verificar Leaflet
                if (typeof L === 'undefined') {
                    throw new Error('Leaflet n√£o foi carregado');
                }
                
                // Verificar elemento do mapa
                const mapElement = document.getElementById('map');
                if (!mapElement) {
                    throw new Error('Elemento do mapa n√£o encontrado');
                }
                
                console.log('‚úÖ Depend√™ncias verificadas');
            }
            
            async initializeManagers() {
                console.log('üì¶ Inicializando managers...');
                
                const managersToInit = [
                    { name: 'databaseManager', class: DatabaseManager, critical: true },
                    { name: 'authManager', class: AuthManager, critical: false },
                    { name: 'modalManager', class: ModalManager, critical: false },
                    { name: 'themeManager', class: ThemeManager, critical: false },
                    { name: 'mapManager', class: MapManager, critical: true }
                ];
                
                for (const manager of managersToInit) {
                    try {
                        console.log(`üîß Inicializando ${manager.name}...`);
                        window[manager.name] = new manager.class();
                        this.managers[manager.name] = window[manager.name];
                        console.log(`‚úÖ ${manager.name} inicializado`);
                        
                        // Pequena pausa entre managers
                        await new Promise(resolve => setTimeout(resolve, 50));
                        
                    } catch (error) {
                        console.error(`‚ùå Erro ao inicializar ${manager.name}:`, error);
                        
                        if (manager.critical) {
                            throw new Error(`Manager cr√≠tico falhou: ${manager.name} - ${error.message}`);
                        } else {
                            this.errors.push(`${manager.name}: ${error.message}`);
                        }
                    }
                }
                
                if (this.errors.length > 0) {
                    console.warn('‚ö†Ô∏è Alguns managers n√£o cr√≠ticos falharam:', this.errors);
                }
                
                console.log('‚úÖ Managers inicializados');
            }
            
            async initializeApp() {
                console.log('üéØ Inicializando aplica√ß√£o principal...');
                
                // Aguardar um pouco mais
                await new Promise(resolve => setTimeout(resolve, 100));
                
                window.app = new PontosEntretenimentoApp();
                console.log('‚úÖ Aplica√ß√£o inicializada');
            }
            
            showError(error) {
                console.error('Stack trace:', error.stack);
                
                // Remove loading screen
                const loadingScreen = document.querySelector('.loading-screen');
                if (loadingScreen) {
                    loadingScreen.style.display = 'none';
                }
                
                // Mostra erro detalhado
                document.body.innerHTML = `
                    <div style="padding: 2rem; max-width: 800px; margin: 0 auto; font-family: Arial, sans-serif;">
                        <div style="text-align: center; color: #ef4444; margin-bottom: 2rem;">
                            <h1>‚ùå Erro ao carregar a aplica√ß√£o</h1>
                            <p><strong>Detalhes:</strong> ${error.message}</p>
                        </div>
                        
                        ${this.errors.length > 0 ? `
                            <div style="margin-bottom: 2rem;">
                                <h3>‚ö†Ô∏è Warnings:</h3>
                                <ul style="color: #f59e0b;">
                                    ${this.errors.map(err => `<li>${err}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}
                        
                        <details style="margin: 1rem 0;">
                            <summary style="cursor: pointer; font-weight: bold;">üìã Informa√ß√µes t√©cnicas</summary>
                            <pre style="background: #f5f5f5; padding: 1rem; border-radius: 4px; overflow-x: auto; font-size: 12px; margin-top: 1rem;">${error.stack || 'Stack trace n√£o dispon√≠vel'}</pre>
                        </details>
                    </div>
                `;
            }
        }
        
        // Iniciar o sistema
        const initializer = new AppInitializer();
        initializer.init();
    </script>
</body>
</html>
