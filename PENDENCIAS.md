# Pendências do Projeto - SIG Entretenimento DF

Este arquivo lista todas as funcionalidades ainda não implementadas ou parcialmente concluídas no projeto.

## Resumo

Total de pendências identificadas: **10**

## Lista Detalhada de Pendências

### 1. Sistema de Favoritos (Prioridade Alta)

**Arquivos afetados:**
- `src/js/app.js` (linha 320, 1040)
- `src/js/database.js` (linha 1090, 1095, 1100, 1105)
- `src/js/map.js` (linha 1240, 1325, 1420, 1765)
- `src/js/info-panel.js` (linha 280)

**Descrição:**
Implementar sistema completo de favoritos que permite aos usuários:
- Adicionar/remover pontos dos favoritos
- Visualizar lista de pontos favoritos
- Filtrar por pontos favoritos
- Persistir favoritos por usuário

**Status:** Funcionalidade completamente não implementada

### 2. Sistema de Gerenciamento de Conta (Prioridade Média)

**Arquivos afetados:**
- `src/components/dynamic-user-button.js` (linha 185)

**Descrição:**
Implementar modal para gerenciamento de conta de usuário permitindo:
- Editar informações pessoais
- Alterar senha
- Configurações de perfil

**Status:** Modal não implementado

### 3. Controles Específicos de Mapa para Administradores (Prioridade Média)

**Arquivos afetados:**
- `src/js/map.js` (linha 650, 680)

**Descrição:**
Implementar controles específicos do mapa para administradores:
- Sistema de coordenadas em tempo real
- Controles customizados de administração
- Remoção apropriada de controles quando não é admin

**Status:** Parcialmente implementado

### 4. Tooltips Informativos na Interface Admin (Prioridade Baixa)

**Arquivos afetados:**
- `src/js/admin.js` (linha 195)

**Descrição:**
Implementar tooltips informativos na interface administrativa para melhorar a experiência do usuário.

**Status:** Não implementado

### 5. Sistema de Rejeição de Pontos com Feedback (Prioridade Média)

**Arquivos afetados:**
- `src/js/admin.js` (linha 890)

**Descrição:**
Implementar lógica de rejeição de pontos com feedback para o usuário que sugeriu.

**Status:** Não implementado

### 6. Funcionalidades de Modal para Nova Categoria (Prioridade Baixa)

**Arquivos afetados:**
- `src/js/admin.js` (linha 450)

**Descrição:**
Implementar modal para criação de novas categorias pelo administrador.

**Status:** Não implementado

### 7. Sistema de Relatórios (Prioridade Baixa)

**Arquivos afetados:**
- `src/js/admin.js` (linha 460, 470)

**Descrição:**
Implementar funcionalidades de geração e exportação de relatórios administrativos.

**Status:** Não implementado

### 8. Sistema de Logs e Ajuda (Prioridade Baixa)

**Arquivos afetados:**
- `src/js/admin.js` (linha 480, 490)

**Descrição:**
Implementar sistema de visualização de logs e sistema de ajuda para administradores.

**Status:** Não implementado

### 9. Salvamento Real no Servidor (Prioridade Média)

**Arquivos afetados:**
- `src/js/auth.js` (linha 420)

**Descrição:**
Implementar salvamento real de dados no servidor ao invés de usar apenas localStorage.

**Status:** Não implementado

### 10. Configuração de Estatísticas da Aplicação (Prioridade Baixa)

**Arquivos afetados:**
- `src/js/app.js` (linha 285)

**Descrição:**
Implementar lógica de configuração de estatísticas da aplicação.

**Status:** Não implementado

## Priorização Recomendada

### Implementar Imediatamente (Alta Prioridade)
1. **Sistema de Favoritos** - Funcionalidade principal que afeta diretamente a experiência do usuário

### Implementar na Próxima Versão (Média Prioridade)
2. **Sistema de Gerenciamento de Conta** - Melhora a experiência do usuário
3. **Controles Específicos de Mapa para Admin** - Facilita administração
4. **Sistema de Rejeição com Feedback** - Melhora fluxo administrativo
5. **Salvamento Real no Servidor** - Melhora persistência de dados

### Implementar Futuramente (Baixa Prioridade)
6. **Tooltips Administrativos** - Melhoria de UX
7. **Modal de Nova Categoria** - Funcionalidade administrativa adicional
8. **Sistema de Relatórios** - Funcionalidade analítica
9. **Sistema de Logs e Ajuda** - Ferramentas de suporte
10. **Configuração de Estatísticas** - Métricas avançadas

## Observações Técnicas

- Todas as pendências foram identificadas através dos comentários `!TODO:` no código
- O sistema de favoritos é a principal funcionalidade faltante que afeta a experiência do usuário final
- Funcionalidades administrativas são importantes mas não críticas para o funcionamento básico
- Dados atualmente são salvos apenas no localStorage, implementar persistência no servidor seria ideal

## Última Atualização

Este arquivo foi gerado automaticamente em **3 de agosto de 2025** através da análise dos comentários TODO no código fonte.

```javascript
/***DynamicUserButtonComponent*Managestheuserbuttondisplaybasedonauthenticationstate*Showsdifferentstatesforvisitors,regularusers,andadministrators**@authorGeneratedbyGitHubCopilot*@version1.0.0*/classDynamicUserButton{constructor(){this.currentUser=null;this.isAuthenticated=false;this.isAdmin=false;this.desktopButton=null;this.mobileButton=null;this.userMenu=null;this.isMenuOpen=false;this.init();}/***Initializethedynamicuserbuttoncomponent*/init(){console.log('InitializingDynamicUserButton...');//WaitforDOMifnotreadyif(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',()=>{this.initializeComponent();});}else{this.initializeComponent();}}/***InitializecomponentafterDOMisready*/initializeComponent(){this.findButtonElements();this.updateButtonState();this.setupEventListeners();console.log('DynamicUserButtoninitializedsuccessfully');}/***Findandcachebuttonelements*/findButtonElements(){this.desktopButton=document.getElementById('desktop-login-btn');this.mobileButton=document.getElementById('mobile-login-btn');if(!this.desktopButton||!this.mobileButton){console.warn('DynamicUserButton:Somebuttonelementsnotfound.Desktop:',!!this.desktopButton,'Mobile:',!!this.mobileButton);}else{console.log('DynamicUserButton:Buttonelementsfoundsuccessfully');}}/***Updatebuttonstatebasedonauthenticationstatus*/updateButtonState(){//Checkauthenticationstatusthis.checkAuthenticationState();//Updatebothdesktopandmobilebuttonsiftheyexistif(this.desktopButton){this.updateButton(this.desktopButton);}if(this.mobileButton){this.updateButton(this.mobileButton);}}/***Checkcurrentauthenticationstate*/checkAuthenticationState(){if(window.authManager&&window.authManager.isAuthenticated()){this.isAuthenticated=true;this.currentUser=window.authManager.getCurrentUser();this.isAdmin=this.currentUser&&this.currentUser.role==='administrator';}else{this.isAuthenticated=false;this.currentUser=null;this.isAdmin=false;}}/***Updateindividualbuttonbasedonstate*@param{HTMLElement}button-Buttonelementtoupdate*/updateButton(button){if(!button)return;if(!this.isAuthenticated){//Visitorstate-showloginbuttonthis.setVisitorState(button);}elseif(this.isAdmin){//Administratorstate-showadminbuttonthis.setAdminState(button);}else{//Regularuserstate-showuserbuttonthis.setUserState(button);}}/***Setbuttontovisitorstate*@param{HTMLElement}button-Buttonelement*/setVisitorState(button){consticon=button.querySelector('i');consttext=button.querySelector('.login-btn-text');if(icon){icon.className='fasfa-user';}if(text){text.textContent='ENTRAR';}button.className='login-btn'+(button.classList.contains('mobile')?'mobile':'desktop');button.setAttribute('aria-label','Fazerlogin');}/***Setbuttontoregularuserstate*@param{HTMLElement}button-Buttonelement*/setUserState(button){consticon=button.querySelector('i');consttext=button.querySelector('.login-btn-text');if(icon){icon.className='fasfa-user';}if(text){text.innerHTML=`${this.currentUser.nome}<iclass="fasfa-chevron-downuser-menu-arrow"></i>`;}button.className='user-btn'+(button.classList.contains('mobile')?'mobile':'desktop');button.setAttribute('aria-label','Menudousuário');}/***Setbuttontoadministratorstate*@param{HTMLElement}button-Buttonelement*/setAdminState(button){consticon=button.querySelector('i');consttext=button.querySelector('.login-btn-text');if(icon){icon.className='fasfa-shield-alt';}if(text){text.innerHTML=`${this.currentUser.nome}<iclass="fasfa-chevron-downuser-menu-arrow"></i>`;}button.className='admin-btn'+(button.classList.contains('mobile')?'mobile':'desktop');button.setAttribute('aria-label','Menudoadministrador');}/***Setupeventlisteners*/setupEventListeners(){//Desktopbuttonclickif(this.desktopButton){this.desktopButton.addEventListener('click',(e)=>this.handleButtonClick(e));}//Mobilebuttonclickif(this.mobileButton){this.mobileButton.addEventListener('click',(e)=>this.handleButtonClick(e));}//Listenforauthenticationstatechangesdocument.addEventListener('authStateChanged',()=>{console.log('DynamicUserButton:Authstatechanged,updatingbutton...');this.updateButtonState();});//Closemenuwhenclickingoutsidedocument.addEventListener('click',(e)=>{if(this.isMenuOpen&&!e.target.closest('.user-dropdown-menu')&&!e.target.closest('.user-btn')&&!e.target.closest('.admin-btn')){this.closeUserMenu();}});//ClosemenuwithESCkeydocument.addEventListener('keydown',(e)=>{if(e.key==='Escape'&&this.isMenuOpen){this.closeUserMenu();}});//Listenforresizeeventstorepositionmenuifopenwindow.addEventListener('resize',()=>{if(this.isMenuOpen&&this.userMenu){this.closeUserMenu();//Closeonresizeforsimplicity}});}/***Handlebuttonclick*@param{Event}e-Clickevent*/handleButtonClick(e){e.preventDefault();e.stopPropagation();if(!this.isAuthenticated){//Showloginmodalforvisitorsthis.openLoginModal();}else{//Toggleusermenuforauthenticatedusersthis.toggleUserMenu(e.target);}}/***Openloginmodal*/openLoginModal(){if(window.loginModal){window.loginModal.open();}else{console.error('DynamicUserButton:Loginmodalnotavailable');}}/***Toggleusermenudropdown*@param{HTMLElement}buttonElement-Clickedbuttonelement*/toggleUserMenu(buttonElement){if(this.isMenuOpen){this.closeUserMenu();}else{this.openUserMenu(buttonElement);}}/***Openusermenudropdown*@param{HTMLElement}buttonElement-Buttonelementthattriggeredthemenu*/openUserMenu(buttonElement){this.closeUserMenu();//Closeanyexistingmenufirst//Createmenuifitdoesn'texistif(!this.userMenu){this.createUserMenu();}//Updatemenucontentbasedonuserrolethis.updateMenuContent();//Positionandshowmenuthis.positionMenu(buttonElement);this.userMenu.style.display='block';this.isMenuOpen=true;//AddanimationrequestAnimationFrame(()=>{this.userMenu.classList.add('show');});}/***Closeusermenudropdown*/closeUserMenu(){if(this.userMenu&&this.isMenuOpen){this.userMenu.classList.remove('show');setTimeout(()=>{if(this.userMenu){this.userMenu.style.display='none';}},200);this.isMenuOpen=false;}}/***Createusermenudropdownelement*/createUserMenu(){constmenuHTML=`<divid="user-dropdown-menu"class="user-dropdown-menu"><divclass="user-dropdown-content"><!--Menuitemswillbeinsertedhere--></div></div>`;//RemoveexistingmenuifanyconstexistingMenu=document.getElementById('user-dropdown-menu');if(existingMenu){existingMenu.remove();}document.body.insertAdjacentHTML('beforeend',menuHTML);this.userMenu=document.getElementById('user-dropdown-menu');}/***Updatemenucontentbasedonuserrole*/updateMenuContent(){if(!this.userMenu)return;constmenuContent=this.userMenu.querySelector('.user-dropdown-content');letmenuItems=[];if(this.isAdmin){//AdministratormenuitemsmenuItems=[{icon:'fasfa-tachometer-alt',label:'PainelAdministrativo',action:'dashboard',class:'admin-item'},{icon:'fasfa-user-cog',label:'Gerenciarconta',action:'account',class:'account-item'},{icon:'fasfa-sign-out-alt',label:'Sair',action:'logout',class:'logout-item'}];}else{//RegularusermenuitemsmenuItems=[{icon:'fasfa-user-cog',label:'Gerenciarconta',action:'account',class:'account-item'},{icon:'fasfa-sign-out-alt',label:'Sair',action:'logout',class:'logout-item'}];}menuContent.innerHTML=menuItems.map(item=>`<buttonclass="user-menu-item${item.class}"data-action="${item.action}"><iclass="${item.icon}"></i><span>${item.label}</span></button>`).join('');//AddeventlistenerstomenuitemsmenuItems.forEach((item,index)=>{constbutton=menuContent.children[index];button.addEventListener('click',()=>{this.handleMenuAction(item.action);this.closeUserMenu();});});}/***Handlemenuaction*@param{string}action-Actiontoperform*/handleMenuAction(action){switch(action){case'dashboard':this.openAdminDashboard();break;case'account':this.openAccountManagement();break;case'logout':this.performLogout();break;default:console.warn(`DynamicUserButton:Unknownaction:${action}`);}}/***Openadmindashboard*/openAdminDashboard(){if(window.location.pathname.endsWith('admin.html')){//Alreadyonadminpagereturn;}window.location.href='admin.html';}/***Openaccountmanagement(placeholder)*/openAccountManagement(){//!TODO:Implementaccountmanagementmodalthis.showNotification('Funcionalidadedegerenciamentodecontaemdesenvolvimento','info');}/***Performlogout*/performLogout(){if(window.authManager&&window.authManager.logout){window.authManager.logout();this.showNotification('Logoutrealizadocomsucesso','success');//UpdatebuttonstateandreloadpagesetTimeout(()=>{window.location.reload();},800);}else{console.error('DynamicUserButton:AuthManagernotavailableforlogout');}}/***Positionmenurelativetobutton*@param{HTMLElement}buttonElement-Buttonelement*/positionMenu(buttonElement){if(!this.userMenu||!buttonElement)return;constbuttonRect=buttonElement.getBoundingClientRect();constmenuWidth=220;constmenuHeight=this.isAdmin?140:100;constviewport={width:window.innerWidth,height:window.innerHeight};letleft=buttonRect.left;lettop=buttonRect.bottom+8;//Formobile,centerthemenumoreappropriatelyif(viewport.width<=768){left=Math.max(8,Math.min(buttonRect.left,viewport.width-menuWidth-8));}else{//Desktop:adjustifmenuwouldgooffscreenif(left+menuWidth>viewport.width){left=buttonRect.right-menuWidth;}}//Adjustverticalpositionifmenuwouldgooffscreenif(top+menuHeight>viewport.height){top=buttonRect.top-menuHeight-8;}//Ensuremenustayswithinviewportleft=Math.max(8,Math.min(left,viewport.width-menuWidth-8));top=Math.max(8,Math.min(top,viewport.height-menuHeight-8));this.userMenu.style.left=`${left}px`;this.userMenu.style.top=`${top}px`;}/***Shownotificationmessage*@param{string}message-Messagetoshow*@param{string}type-Typeofnotification(success,error,info,warning)*/showNotification(message,type='info'){if(window.infoPanelManager&&window.infoPanelManager.showNotification){window.infoPanelManager.showNotification(message,type);}else{console.log(`${type.toUpperCase()}:${message}`);}}/***Refreshthebuttonstate(calledexternallywhenauthstatechanges)*/refresh(){this.updateButtonState();}}//Initializegloballywindow.dynamicUserButton=newDynamicUserButton();
```

### src/components/user-menu.js

**Linha 1:** Implementaddpointformopeningforusersif(window.addPointModal){window.addPointModal.open();}else{this.showNotification('Funcionalidadeemdesenvolvimento','info');}}logout(){if(window.authManager?.logout){window.authManager.logout();this.showNotification('Logoutrealizadocomsucesso','success');//RecarregarapáginaautomaticamenteapósumbrevedelaysetTimeout(()=>{window.location.reload();},800);}}showNotification(message,type='info'){if(window.infoPanelManager?.showNotification){window.infoPanelManager.showNotification(message,type);}else{console.log(`${type.toUpperCase()}:${message}`);}}}//Inicializarglobalmentewindow.userMenu=newUserMenu();

```javascript
/***MenuDropdowndoUsuário*Exibeopçõesdiferentesparausuáriocomumeadministrador*/classUserMenu{constructor(){this.menu=null;this.isOpen=false;this.init();}init(){this.createMenu();this.setupEventListeners();}createMenu(){constmenuHTML=`<divid="user-menu"class="user-menu"style="display:none;"><divclass="user-menu-content"><!--Conteúdoseráinseridodinamicamente--></div></div>`;document.body.insertAdjacentHTML('beforeend',menuHTML);this.menu=document.getElementById('user-menu');}setupEventListeners(){//Fecharaoclicarforadocument.addEventListener('click',(e)=>{if(this.isOpen&&!e.target.closest('.user-menu')&&!e.target.closest('.user-info')){this.close();}});//ESCparafechardocument.addEventListener('keydown',(e)=>{if(e.key==='Escape'&&this.isOpen){this.close();}});}toggle(buttonElement){if(this.isOpen){this.close();}else{this.open(buttonElement);}}open(buttonElement){constuser=window.authManager?.getCurrentUser();if(!user)return;this.updateMenuContent(user);this.positionMenu(buttonElement);this.menu.style.display='block';this.isOpen=true;//AnimaçãodeentradarequestAnimationFrame(()=>{this.menu.classList.add('open');});}close(){this.menu.classList.remove('open');this.isOpen=false;//AguardaanimaçãoantesdeescondersetTimeout(()=>{if(!this.isOpen){this.menu.style.display='none';}},200);}updateMenuContent(user){constisAdmin=user.role==='administrator';constmenuContent=this.menu.querySelector('.user-menu-content');constmenuItems=isAdmin?[{icon:'fasfa-tachometer-alt',label:'Dashboard',action:()=>this.openDashboard()},{icon:'fasfa-plus-circle',label:'AdicionarPonto',action:()=>this.addPoint()},{icon:'fasfa-sign-out-alt',label:'Sair',action:()=>this.logout(),class:'logout'}]:[{icon:'fasfa-plus-circle',label:'AdicionarPonto',action:()=>this.addPoint()},{icon:'fasfa-sign-out-alt',label:'Sair',action:()=>this.logout(),class:'logout'}];menuContent.innerHTML=menuItems.map(item=>`<buttonclass="user-menu-item${item.class||''}"data-action="${item.label}"><iclass="${item.icon}"></i><span>${item.label}</span></button>`).join('');//AdicionareventlistenersaositensmenuItems.forEach((item,index)=>{constbutton=menuContent.children[index];button.addEventListener('click',()=>{item.action();this.close();});});}positionMenu(buttonElement){constrect=buttonElement.getBoundingClientRect();constmenuWidth=200;constmenuHeight=160;letleft=rect.left;lettop=rect.bottom+8;//Ajustarsesairdatelaif(left+menuWidth>window.innerWidth){left=rect.right-menuWidth;}if(top+menuHeight>window.innerHeight){top=rect.top-menuHeight-8;}this.menu.style.left=`${Math.max(8,left)}px`;this.menu.style.top=`${Math.max(8,top)}px`;}openDashboard(){//Usarcaminhorelativocorretoif(window.location.pathname.endsWith('admin.html')){//Jáestánodashboardreturn;}window.location.href='admin.html';}addPoint(){//!TODO:Implementaddpointformopeningforusersif(window.addPointModal){window.addPointModal.open();}else{this.showNotification('Funcionalidadeemdesenvolvimento','info');}}logout(){if(window.authManager?.logout){window.authManager.logout();this.showNotification('Logoutrealizadocomsucesso','success');//RecarregarapáginaautomaticamenteapósumbrevedelaysetTimeout(()=>{window.location.reload();},800);}}showNotification(message,type='info'){if(window.infoPanelManager?.showNotification){window.infoPanelManager.showNotification(message,type);}else{console.log(`${type.toUpperCase()}:${message}`);}}}//Inicializarglobalmentewindow.userMenu=newUserMenu();
```

**Linha 1:** Implementaddpointformopeningforusersif(window.addPointModal){window.addPointModal.open();}else{this.showNotification('Funcionalidadeemdesenvolvimento','info');}}logout(){if(window.authManager?.logout){window.authManager.logout();this.showNotification('Logoutrealizadocomsucesso','success');//RecarregarapáginaautomaticamenteapósumbrevedelaysetTimeout(()=>{window.location.reload();},800);}}showNotification(message,type='info'){if(window.infoPanelManager?.showNotification){window.infoPanelManager.showNotification(message,type);}else{console.log(`${type.toUpperCase()}:${message}`);}}}//Inicializarglobalmentewindow.userMenu=newUserMenu();

```javascript
/***MenuDropdowndoUsuário*Exibeopçõesdiferentesparausuáriocomumeadministrador*/classUserMenu{constructor(){this.menu=null;this.isOpen=false;this.init();}init(){this.createMenu();this.setupEventListeners();}createMenu(){constmenuHTML=`<divid="user-menu"class="user-menu"style="display:none;"><divclass="user-menu-content"><!--Conteúdoseráinseridodinamicamente--></div></div>`;document.body.insertAdjacentHTML('beforeend',menuHTML);this.menu=document.getElementById('user-menu');}setupEventListeners(){//Fecharaoclicarforadocument.addEventListener('click',(e)=>{if(this.isOpen&&!e.target.closest('.user-menu')&&!e.target.closest('.user-info')){this.close();}});//ESCparafechardocument.addEventListener('keydown',(e)=>{if(e.key==='Escape'&&this.isOpen){this.close();}});}toggle(buttonElement){if(this.isOpen){this.close();}else{this.open(buttonElement);}}open(buttonElement){constuser=window.authManager?.getCurrentUser();if(!user)return;this.updateMenuContent(user);this.positionMenu(buttonElement);this.menu.style.display='block';this.isOpen=true;//AnimaçãodeentradarequestAnimationFrame(()=>{this.menu.classList.add('open');});}close(){this.menu.classList.remove('open');this.isOpen=false;//AguardaanimaçãoantesdeescondersetTimeout(()=>{if(!this.isOpen){this.menu.style.display='none';}},200);}updateMenuContent(user){constisAdmin=user.role==='administrator';constmenuContent=this.menu.querySelector('.user-menu-content');constmenuItems=isAdmin?[{icon:'fasfa-tachometer-alt',label:'Dashboard',action:()=>this.openDashboard()},{icon:'fasfa-plus-circle',label:'AdicionarPonto',action:()=>this.addPoint()},{icon:'fasfa-sign-out-alt',label:'Sair',action:()=>this.logout(),class:'logout'}]:[{icon:'fasfa-plus-circle',label:'AdicionarPonto',action:()=>this.addPoint()},{icon:'fasfa-sign-out-alt',label:'Sair',action:()=>this.logout(),class:'logout'}];menuContent.innerHTML=menuItems.map(item=>`<buttonclass="user-menu-item${item.class||''}"data-action="${item.label}"><iclass="${item.icon}"></i><span>${item.label}</span></button>`).join('');//AdicionareventlistenersaositensmenuItems.forEach((item,index)=>{constbutton=menuContent.children[index];button.addEventListener('click',()=>{item.action();this.close();});});}positionMenu(buttonElement){constrect=buttonElement.getBoundingClientRect();constmenuWidth=200;constmenuHeight=160;letleft=rect.left;lettop=rect.bottom+8;//Ajustarsesairdatelaif(left+menuWidth>window.innerWidth){left=rect.right-menuWidth;}if(top+menuHeight>window.innerHeight){top=rect.top-menuHeight-8;}this.menu.style.left=`${Math.max(8,left)}px`;this.menu.style.top=`${Math.max(8,top)}px`;}openDashboard(){//Usarcaminhorelativocorretoif(window.location.pathname.endsWith('admin.html')){//Jáestánodashboardreturn;}window.location.href='admin.html';}addPoint(){//!TODO:Implementaddpointformopeningforusersif(window.addPointModal){window.addPointModal.open();}else{this.showNotification('Funcionalidadeemdesenvolvimento','info');}}logout(){if(window.authManager?.logout){window.authManager.logout();this.showNotification('Logoutrealizadocomsucesso','success');//RecarregarapáginaautomaticamenteapósumbrevedelaysetTimeout(()=>{window.location.reload();},800);}}showNotification(message,type='info'){if(window.infoPanelManager?.showNotification){window.infoPanelManager.showNotification(message,type);}else{console.log(`${type.toUpperCase()}:${message}`);}}}//Inicializarglobalmentewindow.userMenu=newUserMenu();
```

### src/js/admin.js

**Linha 1:** Implementinformativetooltipsinadmininterface}/***RedirecionarparaloginredirectToLogin(){window.location.href='index.html';}/***Mostrarnotificação*@param{string}mensagem-Mensagemdanotificação*@param{string}tipo-TipodanotificaçãoshowNotification(mensagem,tipo='info'){//Usarosistemadenotificaçõesdoappprincipalif(window.app){window.app.showNotification(mensagem,tipo);}else{console.log(`${tipo.toUpperCase()}:${mensagem}`);}}/***ToggledomenudousuáriotoggleUserMenu(){constuserMenu=document.querySelector('.user-menu');if(userMenu){userMenu.classList.toggle('active');}}/***MostrarmodaldenovopontomostrarModalNovoPonto(){modalManager.abrirModalAdicaoPonto();}/***MostrarmodaldenovacategoriamostrarModalNovaCategoria(){//!TODO:Implementnewcategorymodalfunctionalitythis.showNotification('Funcionalidadedenovacategoriaemdesenvolvimento','info');}/***MostrarmodaldenovousuáriomostrarModalNovoUsuario(){//!TODO:Implementnewusermodalfunctionalitythis.showNotification('Funcionalidadedenovousuárioemdesenvolvimento','info');}/***ExportarrelatórioexportarRelatorio(){//!TODO:Implementreportexportfunctionalitythis.showNotification('Funcionalidadedeexportaçãoderelatórioemdesenvolvimento','info');}/***GerarrelatóriogerarRelatorio(){//!TODO:Implementreportgenerationfunctionalitythis.showNotification('Funcionalidadedegeraçãoderelatórioemdesenvolvimento','info');}/***MostrarajudamostrarAjuda(){//!TODO:Implementhelpsystemfunctionalitythis.showNotification('Sistemadeajudaemdesenvolvimento','info');}/***MostrarlogsmostrarLogs(){//!TODO:Implementlogsvisualizationfunctionalitythis.showNotification('Visualizaçãodelogsemdesenvolvimento','info');}/***GerenciarpontospendentesmostrarPontosPendentes(){constpontosPendentes=databaseManager.getPontosPendentes();consthtml=`<divclass="admin-section"><divclass="section-header"><h2><iclass="fasfa-clock"></i>PontosPendentesdeAprovação</h2><p>Total:${pontosPendentes.length}pontosaguardandoaprovação</p></div>${pontosPendentes.length===0?`<divclass="empty-state"><iclass="fasfa-check-circle"></i><h3>Nenhumpontopendente</h3><p>Todosospontosforamrevisados!</p></div>`:`<divclass="table-responsive"><tableclass="admin-table"><thead><tr><th>Nome</th><th>Categoria</th><th>Enviadopor</th><th>Data</th><th>Ações</th></tr></thead><tbody>${pontosPendentes.map(ponto=>`<tr><td><strong>${ponto.nome}</strong><br><smallclass="text-muted">${ponto.endereco||'Semendereço'}</small></td><td><spanclass="badgebadge-info">${ponto.categoria}</span></td><td>${ponto.adicionadoPor||'Anônimo'}</td><td>${newDate(ponto.dataAdicao).toLocaleDateString('pt-BR')}</td><td><divclass="btn-group"><buttonclass="btnbtn-successbtn-sm"onclick="adminManager.aprovarPonto(${ponto.id})"><iclass="fasfa-check"></i>Aprovar</button><buttonclass="btnbtn-warningbtn-sm"onclick="adminManager.visualizarPonto(${ponto.id})"><iclass="fasfa-eye"></i>Ver</button><buttonclass="btnbtn-dangerbtn-sm"onclick="adminManager.rejeitarPonto(${ponto.id})"><iclass="fasfa-times"></i>Rejeitar</button></div></td></tr>`).join('')}</tbody></table></div>`}</div>`;this.renderTabContent(html);}/***AprovarpontopendenteaprovarPonto(pontoId){if(confirm('Aprovaresteponto?')){try{databaseManager.aprovarPonto(pontoId,'administrator');this.showNotification('Pontoaprovadocomsucesso!','success');this.mostrarPontosPendentes();//Recarregarlistathis.atualizarContadores();}catch(error){this.showNotification('Erroaoaprovarponto:'+error.message,'error');}}}/***RejeitarpontopendenterejeitarPonto(pontoId){if(confirm('Rejeitaresteponto?Eleserámovidoparapontosocultos.')){try{databaseManager.ocultarPonto(pontoId,'administrator');this.showNotification('Pontorejeitadoeocultado','warning');this.mostrarPontosPendentes();//Recarregarlistathis.atualizarContadores();}catch(error){this.showNotification('Erroaorejeitarponto:'+error.message,'error');}}}/***MostrarpontosocultosmostrarPontosOcultos(){constpontosOcultos=databaseManager.getPontosOcultos();consthtml=`<divclass="admin-section"><divclass="section-header"><h2><iclass="fasfa-eye-slash"></i>PontosOcultos</h2><p>Total:${pontosOcultos.length}pontosocultos</p></div>${pontosOcultos.length===0?`<divclass="empty-state"><iclass="fasfa-eye"></i><h3>Nenhumpontooculto</h3><p>Todosospontosestãovisíveis!</p></div>`:`<divclass="table-responsive"><tableclass="admin-table"><thead><tr><th>Nome</th><th>Categoria</th><th>DataOcultação</th><th>Ações</th></tr></thead><tbody>${pontosOcultos.map(ponto=>`<tr><td><strong>${ponto.nome}</strong><br><smallclass="text-muted">${ponto.endereco||'Semendereço'}</small></td><td><spanclass="badgebadge-secondary">${ponto.categoria}</span></td><td>${ponto.dataOcultacao?newDate(ponto.dataOcultacao).toLocaleDateString('pt-BR'):'N/A'}</td><td><divclass="btn-group"><buttonclass="btnbtn-successbtn-sm"onclick="adminManager.restaurarPonto(${ponto.id})"><iclass="fasfa-undo"></i>Restaurar</button><buttonclass="btnbtn-infobtn-sm"onclick="adminManager.visualizarPonto(${ponto.id})"><iclass="fasfa-eye"></i>Ver</button></div></td></tr>`).join('')}</tbody></table></div>`}</div>`;this.renderTabContent(html);}/***RestaurarpontoocultorestaurarPonto(pontoId){if(confirm('Restauraresteponto?Eleficarávisívelnovamente.')){try{databaseManager.restaurarPonto(pontoId,'administrator');this.showNotification('Pontorestauradocomsucesso!','success');this.mostrarPontosOcultos();//Recarregarlistathis.atualizarContadores();}catch(error){this.showNotification('Erroaorestaurarponto:'+error.message,'error');}}}/***MostrarsugestõespendentesmostrarSugestoes(){constsugestoes=databaseManager.getSugestoesPendentes();consthtml=`<divclass="admin-section"><divclass="section-header"><h2><iclass="fasfa-edit"></i>SugestõesdeMudança</h2><p>Total:${sugestoes.length}sugestõespendentes</p></div>${sugestoes.length===0?`<divclass="empty-state"><iclass="fasfa-check-circle"></i><h3>Nenhumasugestãopendente</h3><p>Todasassugestõesforamrevisadas!</p></div>`:`<divclass="suggestions-list">${sugestoes.map(sugestao=>{constponto=databaseManager.getPontoById(sugestao.pontoId);return`<divclass="suggestion-card"><divclass="suggestion-header"><h4>${ponto?ponto.nome:'Pontonãoencontrado'}</h4><spanclass="badgebadge-warning">Pendente</span></div><divclass="suggestion-content"><p><strong>Sugeridopor:</strong>${sugestao.usuarioSugeriu}</p><p><strong>Data:</strong>${newDate(sugestao.dataSugestao).toLocaleDateString('pt-BR')}</p><h5>Mudançaspropostas:</h5><divclass="changes-list">${Object.entries(sugestao.sugestoes).map(([campo,valor])=>`<divclass="change-item"><strong>${campo}:</strong>${valor}</div>`).join('')}</div></div><divclass="suggestion-actions"><buttonclass="btnbtn-successbtn-sm"onclick="adminManager.aprovarSugestao(${sugestao.id})"><iclass="fasfa-check"></i>Aprovar</button><buttonclass="btnbtn-dangerbtn-sm"onclick="adminManager.rejeitarSugestao(${sugestao.id})"><iclass="fasfa-times"></i>Rejeitar</button></div></div>`;}).join('')}</div>`}</div>`;this.renderTabContent(html);}/***AprovarsugestãoaprovarSugestao(sugestaoId){if(confirm('Aprovarestasugestão?Asmudançasserãoaplicadasaoponto.')){try{databaseManager.aprovarSugestao(sugestaoId,'administrator');this.showNotification('Sugestãoaprovadacomsucesso!','success');this.mostrarSugestoes();//Recarregarlistathis.atualizarContadores();}catch(error){this.showNotification('Erroaoaprovarsugestão:'+error.message,'error');}}}/***RejeitarsugestãorejeitarSugestao(sugestaoId){if(confirm('Rejeitarestasugestão?')){//!TODO:Implementpointrejectionlogicwithuserfeedbackthis.showNotification('Funcionalidadeemdesenvolvimento','info');}}/***AtualizarcontadoresnasabasatualizarContadores(){constpendentesCount=databaseManager.getPontosPendentes().length;constsugestoesCount=databaseManager.getSugestoesPendentes().length;constpendentesBadge=document.getElementById('pendentes-count');constsugestoesBadge=document.getElementById('sugestoes-count');if(pendentesBadge){pendentesBadge.textContent=pendentesCount;pendentesCount>0?pendentesBadge.classList.add('pulse'):pendentesBadge.classList.remove('pulse');}if(sugestoesBadge){sugestoesBadge.textContent=sugestoesCount;sugestoesCount>0?sugestoesBadge.classList.add('pulse'):sugestoesBadge.classList.remove('pulse');}}/***MostrarnotificaçãoshowNotification(message,type='info'){//Implementaçãosimplesdenotificaçãoconstcolors={success:'#27ae60',error:'#e74c3c',warning:'#f39c12',info:'#3498db'};constnotification=document.createElement('div');notification.style.cssText=`position:fixed;top:20px;right:20px;background:${colors[type]};color:white;padding:1rem;border-radius:6px;z-index:10001;max-width:300px;box-shadow:04px12pxrgba(0,0,0,0.15);`;notification.textContent=message;document.body.appendChild(notification);setTimeout(()=>{notification.remove();},4000);}}//Disponibilizarglobalmentewindow.AdminManager=AdminManager;

```javascript
/***GerenciadorAdministrativo-PontosdeEntretenimentoDF*Funcionalidadesespecíficasparaopaineladministrativo**@authorTalesOliveira(github.com/TalesLimaOliveira)*@version1.0.0*@noteEstearquivocontémtrechosdecódigogeradoscomauxíliodeInteligênciaArtificial.*/classAdminManager{constructor(){this.currentTab='dashboard';this.currentPage=1;this.itemsPerPage=10;this.sortBy='nome';this.sortOrder='asc';this.filters={categoria:'todos',search:'',status:'todos'};this.charts={};this.init();}/***Inicializarogerenciadoradministrativo*/asyncinit(){try{console.log('InicializandoAdminManager...');//Debug:verificarestadodosmanagersconsole.log('AuthManagerdisponível:',!!window.authManager);console.log('DatabaseManagerdisponível:',!!window.databaseManager);console.log('ModalManagerdisponível:',!!window.modalManager);//Verificarpermissõesconsole.log('Verificandopermissõesdeadmin...');if(!window.authManager){console.error('AuthManagernãoestádisponível');thrownewError('AuthManagernãoinicializado');}constisAuthenticated=window.authManager.isAuthenticated();constcurrentUser=window.authManager.getCurrentUser();console.log('Usuárioautenticado:',isAuthenticated);console.log('Usuárioatual:',currentUser);//Senãoháusuáriologado,fazerloginautomáticocomoadminparadesenvolvimentoif(!isAuthenticated){console.log('Nenhumusuáriologado,tentandologinautomáticodeadmin...');try{awaitwindow.authManager.login('admin','admin');console.log('Loginautomáticodeadminrealizado');}catch(loginError){console.error('Falhanologinautomático:',loginError);this.redirectToLogin();return;}}if(!window.authManager.isAdmin()){console.warn('Usuárionãoéadministrador');this.redirectToLogin();return;}console.log('Permissõesconfirmadas-usuárioéadmin');//Configurarinterfaceconsole.log('Configurandointerface...');this.setupInterface();console.log('Interfaceconfigurada');//Carregardadosiniciaisconsole.log('Carregandodadosiniciais...');awaitthis.loadInitialData();console.log('Dadosiniciaiscarregados');//Configurareventlistenersconsole.log('Configurandoeventlisteners...');this.setupEventListeners();console.log('Eventlistenersconfigurados');//Inicializarmapaadminconsole.log('Inicializandomapaadmin...');this.initializeAdminMap();console.log('Mapaadmininicializado');//Removerteladeloadingconsole.log('Removendoteladeloading...');this.hideLoadingScreen();console.log('AdminManagerinicializadocomsucesso');}catch(error){console.error('ErrocríticoduranteinicializaçãodoAdminManager:',error);this.showNotification('Erroaoinicializarpaineladministrativo','error');//Tentarremoverloadingmesmocomerrothis.hideLoadingScreen();}}/***Configurarinterfaceadministrativa*/setupInterface(){//Atualizarinformaçõesdousuáriothis.updateUserInfo();//Mostrartabinicialthis.showTab('dashboard');//Configurartooltipsthis.setupTooltips();}/***Carregardadosiniciais*/asyncloadInitialData(){try{console.log('Iniciandocarregamentodedados...');//Carregarestatísticasconsole.log('Carregandoestatísticas...');awaitthis.loadStatistics();console.log('Estatísticascarregadas');//Carregardadosdastabsconsole.log('Carregandodadosdastabs...');awaitthis.loadTabData();console.log('Dadosdastabscarregados');//Inicializargráficosconsole.log('Inicializandográficos...');this.initializeCharts();console.log('Gráficosinicializados');}catch(error){console.error('Erroaocarregardados:',error);this.showNotification('Erroaocarregardados','error');throwerror;//Re-throwparasercapturadopeloinit()}}/***Configurareventlisteners*/setupEventListeners(){//Eventosdenavegaçãodocument.addEventListener('click',(e)=>{if(e.target.matches('.nav-tab')){consttab=e.target.dataset.tab;this.showTab(tab);}});//Eventosdefiltrosdocument.getElementById('filter-categoria')?.addEventListener('change',()=>{this.applyFilters();});document.getElementById('search-pontos')?.addEventListener('input',(e)=>{this.filters.search=e.target.value;this.applyFilters();});//Eventosdeordenaçãodocument.getElementById('sort-pontos')?.addEventListener('change',(e)=>{this.sortBy=e.target.value;this.applyFilters();});//Eventosdepaginaçãodocument.addEventListener('click',(e)=>{if(e.target.matches('[data-action="prev-page"]')){this.previousPage();}elseif(e.target.matches('[data-action="next-page"]')){this.nextPage();}});//Eventosdemodaldocument.addEventListener('click',(e)=>{if(e.target.matches('.action-btn-edit')){constid=e.target.dataset.id;this.editItem(id);}elseif(e.target.matches('.action-btn-delete')){constid=e.target.dataset.id;this.deleteItem(id);}});}/***Inicializarmapaadministrativo*/initializeAdminMap(){try{constmapElement=document.getElementById('admin-map');if(!mapElement)return;//Criarmapathis.adminMap=L.map('admin-map').setView([-15.7975,-47.8919],11);//AdicionartilelayerL.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'©OpenStreetMapcontributors'}).addTo(this.adminMap);//Carregarpontosthis.loadMapPoints();console.log('Mapaadministrativoinicializado');}catch(error){console.error('Erroaoinicializarmapaadmin:',error);}}/***Carregarpontosnomapa*/loadMapPoints(){constpontos=window.databaseManager?.obterTodos()||[];pontos.forEach(ponto=>{constmarker=L.marker([ponto.latitude,ponto.longitude]).addTo(this.adminMap).bindPopup(`<divclass="popup-admin"><h4>${ponto.nome}</h4><p><strong>Categoria:</strong>${ponto.categoria}</p><p><strong>Endereço:</strong>${ponto.endereco||'N/A'}</p><divclass="popup-actions"><buttonclass="btnbtn-smbtn-primary"onclick="window.adminManager.editPoint(${ponto.id})"><iclass="fasfa-edit"></i>Editar</button><buttonclass="btnbtn-smbtn-danger"onclick="window.adminManager.deletePoint(${ponto.id})"><iclass="fasfa-trash"></i>Excluir</button></div></div>`);//Adicionareventodecliqueparaediçãomarker.on('click',()=>{this.selectPoint(ponto.id);});});}/***Carregarestatísticas*/asyncloadStatistics(){try{conststats=window.databaseManager?.getEstatisticas?.()||{totalPontos:0,pontosPorCategoria:{},pontosRecentes:[]};//Atualizarcardsdeestatísticas(comfallbackseelementosnãoexistirem)conststatElements={'stat-total-pontos':stats.totalPontos,'stat-categorias':Object.keys(stats.pontosPorCategoria||{}).length,'stat-usuarios':window.authManager?.getTotalUsers?.()||0,'stat-hoje':this.getPointsAddedToday()};Object.entries(statElements).forEach(([id,value])=>{constelement=document.getElementById(id);if(element){element.textContent=value;}});}catch(error){console.error('Erroaocarregarestatísticas:',error);}}/***Carregardadosdastabs*/asyncloadTabData(){try{console.log('Carregandodadosdepontos...');//Carregardadosdatabdepontosthis.loadPointsData();console.log('Carregandodadosdecategorias...');//Carregardadosdatabdecategoriasthis.loadCategoriesData();console.log('Carregandodadosdeusuários...');//Carregardadosdatabdeusuáriosthis.loadUsersData();console.log('Todososdadosdastabscarregados');}catch(error){console.error('Erroaocarregardadosdastabs:',error);throwerror;}}/***Carregardadosdepontos*/loadPointsData(){constpontos=window.databaseManager?.obterTodos()||[];consttbody=document.getElementById('pontos-tbody');if(!tbody)return;//AplicarfiltrosletfilteredPontos=this.filterPoints(pontos);//AplicarordenaçãofilteredPontos=this.sortPoints(filteredPontos);//AplicarpaginaçãoconststartIndex=(this.currentPage-1)*this.itemsPerPage;constendIndex=startIndex+this.itemsPerPage;constpaginatedPontos=filteredPontos.slice(startIndex,endIndex);//GerarHTMLtbody.innerHTML=paginatedPontos.map(ponto=>`<tr><td>${ponto.id}</td><td>${ponto.nome}</td><td><spanclass="badgebadge-primary">${ponto.categoria}</span></td><td>${ponto.endereco||'N/A'}</td><td><spanclass="status-badge${ponto.status==='aprovado'?'status-active':'status-pending'}">${ponto.status||'Ativo'}</span></td><td><divclass="table-actions"><buttonclass="btnbtn-smbtn-primary"onclick="window.adminManager.editPoint(${ponto.id})"title="Editar"><iclass="fasfa-edit"></i></button><buttonclass="btnbtn-smbtn-danger"onclick="window.adminManager.deletePoint(${ponto.id})"title="Excluir"><iclass="fasfa-trash"></i></button></div></td></tr>`).join('');//Atualizarpaginaçãothis.updatePagination(filteredPontos.length);}/***Carregardadosdecategorias*/loadCategoriesData(){constcategorias=databaseManager.getCategorias();constcontainer=document.getElementById('categories-grid');if(!container)return;container.innerHTML=categorias.map(categoria=>{conststats=databaseManager.getEstatisticas();constcount=stats.pontosPorCategoria[categoria.id]||0;return`<divclass="category-card"><divclass="category-header"><divclass="category-icon"style="background:${categoria.cor}20;color:${categoria.cor};"><iclass="${categoria.icon}"></i></div><divclass="category-actions"><buttonclass="action-btnaction-btn-edit"onclick="adminManager.editCategory('${categoria.id}')"><iclass="fasfa-edit"></i></button><buttonclass="action-btnaction-btn-delete"onclick="adminManager.deleteCategory('${categoria.id}')"><iclass="fasfa-trash"></i></button></div></div><divclass="category-name">${categoria.nome}</div><divclass="category-description">${categoria.descricao||'Semdescrição'}</div><divclass="category-stats"><span>Pontos:<spanclass="category-count">${count}</span></span><spanstyle="color:${categoria.cor};">●</span></div></div>`;}).join('');}/***Carregardadosdeusuários*/loadUsersData(){constusuarios=authManager.getAllUsers();consttbody=document.getElementById('usuarios-tbody');if(!tbody)return;tbody.innerHTML=usuarios.map(usuario=>`<tr><td>${usuario.id}</td><td>${usuario.name}</td><td>${usuario.email||'N/A'}</td><td><spanclass="badge${usuario.role==='administrator'?'badge-danger':'badge-secondary'}">${usuario.role==='administrator'?'Administrador':'Usuário'}</span></td><td><spanclass="status-badge${usuario.active?'status-active':'status-inactive'}">${usuario.active?'Ativo':'Inativo'}</span></td><td>${usuario.lastLogin?newDate(usuario.lastLogin).toLocaleDateString():'Nunca'}</td><td><divclass="table-actions"><buttonclass="action-btnaction-btn-edit"onclick="adminManager.editUser(${usuario.id})"><iclass="fasfa-edit"></i></button><buttonclass="action-btnaction-btn-delete"onclick="adminManager.deleteUser(${usuario.id})"${usuario.role==='administrator'?'disabled':''}><iclass="fasfa-trash"></i></button></div></td></tr>`).join('');}/***Obterpontosadicionadoshoje*/getPointsAddedToday(){constpontos=window.databaseManager?.obterTodos()||[];consthoje=newDate().toDateString();returnpontos.filter(ponto=>{constdataAdicao=newDate(ponto.dataAdicao||ponto.dataCriacao||Date.now());returndataAdicao.toDateString()===hoje;}).length;}/***Mostrartabespecífica*@param{string}tabName-Nomedatab*/showTab(tabName){//Removeractivedetodasastabsdocument.querySelectorAll('.nav-tab').forEach(tab=>{tab.classList.remove('active');});document.querySelectorAll('.tab-content').forEach(content=>{content.classList.remove('active');});//Ativartabatualdocument.querySelector(`[data-tab="${tabName}"]`).classList.add('active');document.getElementById(`tab-${tabName}`).classList.add('active');this.currentTab=tabName;//Carregardadosespecíficosdatabthis.loadTabSpecificData(tabName);}/***Carregardadosespecíficosdeumatab*@param{string}tabName-Nomedatab*/loadTabSpecificData(tabName){switch(tabName){case'dashboard':this.loadStatistics();this.initializeCharts();break;case'pontos':this.loadPointsData();this.populateFilters();break;case'pendentes':this.mostrarPontosPendentes();break;case'ocultos':this.mostrarPontosOcultos();break;case'sugestoes':this.mostrarSugestoes();break;case'usuarios':this.loadUsersData();break;case'relatorios':this.loadReportsData();break;}//Atualizarcontadoressemprequetrocardeabathis.atualizarContadores();}/***Inicializargráficos*/initializeCharts(){this.initializeCategoriesChart();}/***Inicializargráficodecategorias*/initializeCategoriesChart(){constcanvas=document.getElementById('categorias-chart');if(!canvas)return;constctx=canvas.getContext('2d');conststats=databaseManager.getEstatisticas();constcategorias=databaseManager.getCategorias();constdata={labels:categorias.map(c=>c.nome),datasets:[{label:'PontosporCategoria',data:categorias.map(c=>stats.pontosPorCategoria[c.id]||0),backgroundColor:categorias.map(c=>c.cor+'80'),borderColor:categorias.map(c=>c.cor),borderWidth:2}]};if(this.charts.categorias){this.charts.categorias.destroy();}this.charts.categorias=newChart(ctx,{type:'doughnut',data:data,options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom'}}}});}/***Filtrarpontos*@param{Array}pontos-Arraydepontos*@returns{Array}Pontosfiltrados*/filterPoints(pontos){returnpontos.filter(ponto=>{//Filtroporcategoriaif(this.filters.categoria!=='todos'&&ponto.categoria!==this.filters.categoria){returnfalse;}//Filtroporbuscaif(this.filters.search){constsearchTerm=this.filters.search.toLowerCase();returnponto.nome.toLowerCase().includes(searchTerm)||ponto.endereco.toLowerCase().includes(searchTerm)||ponto.categoria.toLowerCase().includes(searchTerm);}returntrue;});}/***Ordenarpontos*@param{Array}pontos-Arraydepontos*@returns{Array}Pontosordenados*/sortPoints(pontos){returnpontos.sort((a,b)=>{letaVal=a[this.sortBy];letbVal=b[this.sortBy];if(typeofaVal==='string'){aVal=aVal.toLowerCase();bVal=bVal.toLowerCase();}if(this.sortOrder==='asc'){returnaVal>bVal?1:-1;}else{returnaVal<bVal?1:-1;}});}/***Aplicarfiltros*/applyFilters(){this.filters.categoria=document.getElementById('filter-categoria')?.value||'todos';this.currentPage=1;//Resetparaprimeirapáginathis.loadPointsData();}/***Atualizarpaginação*@param{number}totalItems-Totaldeitens*/updatePagination(totalItems){consttotalPages=Math.ceil(totalItems/this.itemsPerPage);//AtualizarinformaçõesconstpaginationInfo=document.getElementById('pagination-info');if(paginationInfo){conststart=(this.currentPage-1)*this.itemsPerPage+1;constend=Math.min(start+this.itemsPerPage-1,totalItems);paginationInfo.textContent=`Mostrando${start}a${end}de${totalItems}pontos`;}//AtualizarcontrolesconstpaginationCurrent=document.getElementById('pagination-current');if(paginationCurrent){paginationCurrent.textContent=`Página${this.currentPage}de${totalPages}`;}//AtualizarbotõesconstbtnPrev=document.querySelector('[data-action="prev-page"]');constbtnNext=document.querySelector('[data-action="next-page"]');if(btnPrev){btnPrev.disabled=this.currentPage===1;}if(btnNext){btnNext.disabled=this.currentPage===totalPages;}}/***Páginaanterior*/previousPage(){if(this.currentPage>1){this.currentPage--;this.loadPointsData();}}/***Próximapágina*/nextPage(){this.currentPage++;this.loadPointsData();}/***Visualizarponto*@param{number}id-IDdoponto*/viewPoint(id){constponto=databaseManager.obterPorId(id);if(!ponto)return;constconteudo=`<divclass="point-details"><h4>${ponto.nome}</h4><p><strong>Categoria:</strong>${ponto.categoria}</p><p><strong>Endereço:</strong>${ponto.endereco}</p><p><strong>Descrição:</strong>${ponto.descricao||'Semdescrição'}</p><p><strong>Telefone:</strong>${ponto.telefone||'Nãoinformado'}</p><p><strong>Horário:</strong>${ponto.horario||'Nãoinformado'}</p><p><strong>Coordenadas:</strong>${ponto.latitude},${ponto.longitude}</p><p><strong>DatadeCriação:</strong>${newDate(ponto.dataCriacao||Date.now()).toLocaleDateString()}</p></div>`;constbotoes=[{texto:'Fechar',classe:'btn-secondary',acao:()=>modalManager.fecharModal()}];constmodal=modalManager.criarModal(`Detalhes:${ponto.nome}`,conteudo,botoes);modalManager.mostrarModal(modal);}/***Editarponto*@param{number}id-IDdoponto*/editPoint(id){constponto=databaseManager.obterPorId(id);if(!ponto)return;modalManager.abrirModalEdicaoPonto(ponto);}/***Excluirponto*@param{number}id-IDdoponto*/deletePoint(id){constponto=databaseManager.obterPorId(id);if(!ponto)return;if(confirm(`Temcertezaquedesejaexcluiroponto"${ponto.nome}"?`)){if(databaseManager.removerPonto(id)){this.showNotification('Pontoexcluídocomsucesso!','success');this.loadPointsData();this.loadStatistics();this.loadMapPoints();}else{this.showNotification('Erroaoexcluirponto','error');}}}/***Obterpontosadicionadoshoje*@returns{number}Quantidadedepontos*/getPointsAddedToday(){consthoje=newDate();hoje.setHours(0,0,0,0);constpontos=databaseManager.obterTodos();returnpontos.filter(ponto=>{constdataCriacao=newDate(ponto.dataCriacao||0);returndataCriacao>=hoje;}).length;}/***Popularizarfiltros*/populateFilters(){constselectCategoria=document.getElementById('filter-categoria');if(!selectCategoria)return;constcategorias=databaseManager.getCategorias();selectCategoria.innerHTML='<optionvalue="todos">Todas</option>';categorias.forEach(categoria=>{constoption=document.createElement('option');option.value=categoria.id;option.textContent=categoria.nome;selectCategoria.appendChild(option);});}/***Atualizarinformaçõesdousuário*/updateUserInfo(){constusuario=authManager.getCurrentUser();if(!usuario)return;constuserNameElement=document.querySelector('.user-name');if(userNameElement){userNameElement.textContent=usuario.name;}}/***Ocultarteladeloading*/hideLoadingScreen(){try{constloadingScreen=document.querySelector('.loading-screen');if(loadingScreen){loadingScreen.style.display='none';console.log('Teladeloadingremovida');}else{console.warn('Elemento.loading-screennãoencontrado');}}catch(error){console.error('Erroaoremoverteladeloading:',error);}}/***Configurartooltips*/setupTooltips(){//!TODO:Implementinformativetooltipsinadmininterface}/***Redirecionarparalogin*/redirectToLogin(){window.location.href='index.html';}/***Mostrarnotificação*@param{string}mensagem-Mensagemdanotificação*@param{string}tipo-Tipodanotificação*/showNotification(mensagem,tipo='info'){//Usarosistemadenotificaçõesdoappprincipalif(window.app){window.app.showNotification(mensagem,tipo);}else{console.log(`${tipo.toUpperCase()}:${mensagem}`);}}/***Toggledomenudousuário*/toggleUserMenu(){constuserMenu=document.querySelector('.user-menu');if(userMenu){userMenu.classList.toggle('active');}}/***Mostrarmodaldenovoponto*/mostrarModalNovoPonto(){modalManager.abrirModalAdicaoPonto();}/***Mostrarmodaldenovacategoria*/mostrarModalNovaCategoria(){//!TODO:Implementnewcategorymodalfunctionalitythis.showNotification('Funcionalidadedenovacategoriaemdesenvolvimento','info');}/***Mostrarmodaldenovousuário*/mostrarModalNovoUsuario(){//!TODO:Implementnewusermodalfunctionalitythis.showNotification('Funcionalidadedenovousuárioemdesenvolvimento','info');}/***Exportarrelatório*/exportarRelatorio(){//!TODO:Implementreportexportfunctionalitythis.showNotification('Funcionalidadedeexportaçãoderelatórioemdesenvolvimento','info');}/***Gerarrelatório*/gerarRelatorio(){//!TODO:Implementreportgenerationfunctionalitythis.showNotification('Funcionalidadedegeraçãoderelatórioemdesenvolvimento','info');}/***Mostrarajuda*/mostrarAjuda(){//!TODO:Implementhelpsystemfunctionalitythis.showNotification('Sistemadeajudaemdesenvolvimento','info');}/***Mostrarlogs*/mostrarLogs(){//!TODO:Implementlogsvisualizationfunctionalitythis.showNotification('Visualizaçãodelogsemdesenvolvimento','info');}/***Gerenciarpontospendentes*/mostrarPontosPendentes(){constpontosPendentes=databaseManager.getPontosPendentes();consthtml=`<divclass="admin-section"><divclass="section-header"><h2><iclass="fasfa-clock"></i>PontosPendentesdeAprovação</h2><p>Total:${pontosPendentes.length}pontosaguardandoaprovação</p></div>${pontosPendentes.length===0?`<divclass="empty-state"><iclass="fasfa-check-circle"></i><h3>Nenhumpontopendente</h3><p>Todosospontosforamrevisados!</p></div>`:`<divclass="table-responsive"><tableclass="admin-table"><thead><tr><th>Nome</th><th>Categoria</th><th>Enviadopor</th><th>Data</th><th>Ações</th></tr></thead><tbody>${pontosPendentes.map(ponto=>`<tr><td><strong>${ponto.nome}</strong><br><smallclass="text-muted">${ponto.endereco||'Semendereço'}</small></td><td><spanclass="badgebadge-info">${ponto.categoria}</span></td><td>${ponto.adicionadoPor||'Anônimo'}</td><td>${newDate(ponto.dataAdicao).toLocaleDateString('pt-BR')}</td><td><divclass="btn-group"><buttonclass="btnbtn-successbtn-sm"onclick="adminManager.aprovarPonto(${ponto.id})"><iclass="fasfa-check"></i>Aprovar</button><buttonclass="btnbtn-warningbtn-sm"onclick="adminManager.visualizarPonto(${ponto.id})"><iclass="fasfa-eye"></i>Ver</button><buttonclass="btnbtn-dangerbtn-sm"onclick="adminManager.rejeitarPonto(${ponto.id})"><iclass="fasfa-times"></i>Rejeitar</button></div></td></tr>`).join('')}</tbody></table></div>`}</div>`;this.renderTabContent(html);}/***Aprovarpontopendente*/aprovarPonto(pontoId){if(confirm('Aprovaresteponto?')){try{databaseManager.aprovarPonto(pontoId,'administrator');this.showNotification('Pontoaprovadocomsucesso!','success');this.mostrarPontosPendentes();//Recarregarlistathis.atualizarContadores();}catch(error){this.showNotification('Erroaoaprovarponto:'+error.message,'error');}}}/***Rejeitarpontopendente*/rejeitarPonto(pontoId){if(confirm('Rejeitaresteponto?Eleserámovidoparapontosocultos.')){try{databaseManager.ocultarPonto(pontoId,'administrator');this.showNotification('Pontorejeitadoeocultado','warning');this.mostrarPontosPendentes();//Recarregarlistathis.atualizarContadores();}catch(error){this.showNotification('Erroaorejeitarponto:'+error.message,'error');}}}/***Mostrarpontosocultos*/mostrarPontosOcultos(){constpontosOcultos=databaseManager.getPontosOcultos();consthtml=`<divclass="admin-section"><divclass="section-header"><h2><iclass="fasfa-eye-slash"></i>PontosOcultos</h2><p>Total:${pontosOcultos.length}pontosocultos</p></div>${pontosOcultos.length===0?`<divclass="empty-state"><iclass="fasfa-eye"></i><h3>Nenhumpontooculto</h3><p>Todosospontosestãovisíveis!</p></div>`:`<divclass="table-responsive"><tableclass="admin-table"><thead><tr><th>Nome</th><th>Categoria</th><th>DataOcultação</th><th>Ações</th></tr></thead><tbody>${pontosOcultos.map(ponto=>`<tr><td><strong>${ponto.nome}</strong><br><smallclass="text-muted">${ponto.endereco||'Semendereço'}</small></td><td><spanclass="badgebadge-secondary">${ponto.categoria}</span></td><td>${ponto.dataOcultacao?newDate(ponto.dataOcultacao).toLocaleDateString('pt-BR'):'N/A'}</td><td><divclass="btn-group"><buttonclass="btnbtn-successbtn-sm"onclick="adminManager.restaurarPonto(${ponto.id})"><iclass="fasfa-undo"></i>Restaurar</button><buttonclass="btnbtn-infobtn-sm"onclick="adminManager.visualizarPonto(${ponto.id})"><iclass="fasfa-eye"></i>Ver</button></div></td></tr>`).join('')}</tbody></table></div>`}</div>`;this.renderTabContent(html);}/***Restaurarpontooculto*/restaurarPonto(pontoId){if(confirm('Restauraresteponto?Eleficarávisívelnovamente.')){try{databaseManager.restaurarPonto(pontoId,'administrator');this.showNotification('Pontorestauradocomsucesso!','success');this.mostrarPontosOcultos();//Recarregarlistathis.atualizarContadores();}catch(error){this.showNotification('Erroaorestaurarponto:'+error.message,'error');}}}/***Mostrarsugestõespendentes*/mostrarSugestoes(){constsugestoes=databaseManager.getSugestoesPendentes();consthtml=`<divclass="admin-section"><divclass="section-header"><h2><iclass="fasfa-edit"></i>SugestõesdeMudança</h2><p>Total:${sugestoes.length}sugestõespendentes</p></div>${sugestoes.length===0?`<divclass="empty-state"><iclass="fasfa-check-circle"></i><h3>Nenhumasugestãopendente</h3><p>Todasassugestõesforamrevisadas!</p></div>`:`<divclass="suggestions-list">${sugestoes.map(sugestao=>{constponto=databaseManager.getPontoById(sugestao.pontoId);return`<divclass="suggestion-card"><divclass="suggestion-header"><h4>${ponto?ponto.nome:'Pontonãoencontrado'}</h4><spanclass="badgebadge-warning">Pendente</span></div><divclass="suggestion-content"><p><strong>Sugeridopor:</strong>${sugestao.usuarioSugeriu}</p><p><strong>Data:</strong>${newDate(sugestao.dataSugestao).toLocaleDateString('pt-BR')}</p><h5>Mudançaspropostas:</h5><divclass="changes-list">${Object.entries(sugestao.sugestoes).map(([campo,valor])=>`<divclass="change-item"><strong>${campo}:</strong>${valor}</div>`).join('')}</div></div><divclass="suggestion-actions"><buttonclass="btnbtn-successbtn-sm"onclick="adminManager.aprovarSugestao(${sugestao.id})"><iclass="fasfa-check"></i>Aprovar</button><buttonclass="btnbtn-dangerbtn-sm"onclick="adminManager.rejeitarSugestao(${sugestao.id})"><iclass="fasfa-times"></i>Rejeitar</button></div></div>`;}).join('')}</div>`}</div>`;this.renderTabContent(html);}/***Aprovarsugestão*/aprovarSugestao(sugestaoId){if(confirm('Aprovarestasugestão?Asmudançasserãoaplicadasaoponto.')){try{databaseManager.aprovarSugestao(sugestaoId,'administrator');this.showNotification('Sugestãoaprovadacomsucesso!','success');this.mostrarSugestoes();//Recarregarlistathis.atualizarContadores();}catch(error){this.showNotification('Erroaoaprovarsugestão:'+error.message,'error');}}}/***Rejeitarsugestão*/rejeitarSugestao(sugestaoId){if(confirm('Rejeitarestasugestão?')){//!TODO:Implementpointrejectionlogicwithuserfeedbackthis.showNotification('Funcionalidadeemdesenvolvimento','info');}}/***Atualizarcontadoresnasabas*/atualizarContadores(){constpendentesCount=databaseManager.getPontosPendentes().length;constsugestoesCount=databaseManager.getSugestoesPendentes().length;constpendentesBadge=document.getElementById('pendentes-count');constsugestoesBadge=document.getElementById('sugestoes-count');if(pendentesBadge){pendentesBadge.textContent=pendentesCount;pendentesCount>0?pendentesBadge.classList.add('pulse'):pendentesBadge.classList.remove('pulse');}if(sugestoesBadge){sugestoesBadge.textContent=sugestoesCount;sugestoesCount>0?sugestoesBadge.classList.add('pulse'):sugestoesBadge.classList.remove('pulse');}}/***Mostrarnotificação*/showNotification(message,type='info'){//Implementaçãosimplesdenotificaçãoconstcolors={success:'#27ae60',error:'#e74c3c',warning:'#f39c12',info:'#3498db'};constnotification=document.createElement('div');notification.style.cssText=`position:fixed;top:20px;right:20px;background:${colors[type]};color:white;padding:1rem;border-radius:6px;z-index:10001;max-width:300px;box-shadow:04px12pxrgba(0,0,0,0.15);`;notification.textContent=message;document.body.appendChild(notification);setTimeout(()=>{notification.remove();},4000);}}//Disponibilizarglobalmentewindow.AdminManager=AdminManager;
```

### src/js/app.js

**Linha 1:** Implementarsistemadefavoritos//this.addFavoritesCategory();this.configureUserActions();}/***AddadministratorbuttonsaddAdminButtons(){console.log('Addingadministratorfunctionalities');}/***ConfigureactionsforregularuserconfigureUserActions(){console.log('Configuringuseractions');}/***ShowusermenushowUserMenu(user){if(user.role==='administrator'){//Adminpermanecenapáginaprincipaleacessapainelpelomenuconsole.log(`Administrator${user.name}loggedin-accessadminpanelviamenu`);}else{constlogout=confirm(`Hello${user.name}!\n\nDoyouwanttologout?`);if(logout){if(window.authManager)window.authManager.logout();location.reload();}}}asyncconfigureInterface(){try{console.log('Configuringinterface...');//DatabaseManagerjáfoiinicializadopeloAppInitializer//Verificarseestárealmentedisponívelif(!window.databaseManager){thrownewError('DatabaseManagernãodisponívelapósinicialização');}//Configurarmenudecategoriasapósdadosestaremcarregados//SeráchamadonovamenteemcarregarDados()paragarantirqueestáatualizadoconsole.log('Configuringcategorymenu(firstcall)');this.configureCategoryMenu();this.updateStatistics();console.log('Interfaceconfigured');}catch(error){console.error('Erroaoconfigurarinterface:',error);throwerror;}}configureStatistics(){//!TODO:Implementapplicationstatisticsconfigurationlogic}configureEvents(){//Eventlistenerparamudançasdeautenticaçãodocument.addEventListener('authStateChanged',(e)=>{try{const{type,user}=e.detail;console.log(`🔔Eventodeautenticaçãorecebido:${type}`);if(type==='login'){this.configureLoggedUser(user);this.reloadData();}elseif(type==='logout'){this.configureVisitorUser();this.reloadData();}}catch(error){console.error('Errorprocessingauthenticationevent:',error);//Trytoreconfigureasvisitorincaseoferrortry{this.configureVisitorUser();}catch(fallbackError){console.error('Errorinconfigurationfallback:',fallbackError);}}});//Configurarbotõesresponsivosthis.configureResponsiveButtons();//Nota:EventlistenersparafavoritoesugestãosãogerenciadospeloInfoPanelManager//paraevitarduplicaçãodeeventos}configureResponsiveButtons(){//ODynamicUserButtonagoragerenciaoseventosdecliquedosbotões//Nãoprecisamosmaisconfigurareventosmanuaisaqui//Ocomponenteseauto-inicializaegerenciatodoocomportamento//Notificarocomponentesobremudançasdeestadodeautenticaçãoif(window.dynamicUserButton){window.dynamicUserButton.updateButtonState();}}/***HandleaçãodefavoritarhandleFavoriteAction(e){e.preventDefault();e.stopPropagation();//Verificarseousuárioestáautenticadoif(!window.authManager||!window.authManager.isAuthenticated()){console.log('Usuárionãoautenticado-abrindomodaldelogin');//VerificarseloginModalexisteif(!window.loginModal){console.error('Modaldeloginnãodisponível');this.showNotification('Sistemadeloginnãodisponível.Recarregueapágina.','error');return;}//Abrirmodaldelogincomaçãopendentewindow.loginModal.open({pendingAction:()=>this.handleFavoriteAction(e)});return;}//ImplementarlógicadefavoritosparausuárioslogadosconstpontoId=this.getCurrentPontoId();if(pontoId){this.toggleFavorito(pontoId);}else{console.warn('Nenhumpontoselecionadoparafavoritar');this.showNotification('Selecioneumpontoparafavoritar','warning');}}/***HandleaçãodesugerirmudançahandleSuggestAction(e){e.preventDefault();e.stopPropagation();//Verificarseousuárioestáautenticadoif(!window.authManager||!window.authManager.isAuthenticated()){console.log('Usuárionãoautenticado-abrindomodaldelogin');//VerificarseloginModalexisteif(!window.loginModal){console.error('Modaldeloginnãodisponível');this.showNotification('Sistemadeloginnãodisponível.Recarregueapágina.','error');return;}//Abrirmodaldelogincomaçãopendentewindow.loginModal.open({pendingAction:()=>this.handleSuggestAction(e)});return;}//ImplementarsistemadesugestõesparamudançasnospontosconstpontoId=this.getCurrentPontoId();if(pontoId){this.openSuggestionModal(pontoId);}else{console.warn('Nenhumpontoselecionadoparasugerirmudança');this.showNotification('Selecioneumpontoparasugerirmudanças','warning');}}/***RecarregardadosapósmudançadeautenticaçãoreloadData(){if(window.mapManager){constuser=window.authManager&&window.authManager.getCurrentUser?window.authManager.getCurrentUser():null;window.mapManager.reloadPoints(user?user.role:'visitor',user?user.username:null);}this.updateStatistics();}/***Togglefavorito-FUNCIONALIDADEEMDESENVOLVIMENTO*!TODO:ImplementarsistemacompletodefavoritostoggleFavorito(pontoId){//Mostrarnotificaçãodefuncionalidadeemdesenvolvimentothis.showNotification('Funcionalidadeemdesenvolvimento','info');console.log('!TODO:Implementarsistemadefavoritos-pontoId:',pontoId);}/***GetcurrentpointIDgetCurrentPontoId(){//TentarobteroIDdopontoapartirdopaineldeinformaçõesabertoconstinfoPanel=document.getElementById('info-panel');if(infoPanel&&!infoPanel.classList.contains('hidden')){//Primeiro:verificarseháumbotãocomdata-ponto-id(maisconfiável)constpontoButton=infoPanel.querySelector('[data-ponto-id]');if(pontoButton){constpontoId=pontoButton.getAttribute('data-ponto-id');console.log('PontosApp:IDdopontoatualobtido:',pontoId);returnpontoId;}//Fallback:tentarobterdotítulodopainelconsttitleElement=infoPanel.querySelector('.info-panel-title');if(titleElement&&titleElement.textContent){//Buscaropontopelosdadoscarregadosusandoonomeconstpontos=window.databaseManager?window.databaseManager.getPontosConfirmados():[];constponto=pontos.find(p=>p.nome===titleElement.textContent.trim());if(ponto){console.log('PontosApp:IDdopontoobtidoviafallback:',ponto.id);returnponto.id;}}}console.warn('PontosApp:Nenhumpontoatualmenteselecionado');returnnull;}/***Abrirmodaldesugestão(placeholder)openSuggestionModal(pontoId){console.log(`AbrindomodaldesugestãoparapontoID:${pontoId}`);this.showNotification('Sistemadesugestõesemdesenvolvimento','info');}/***Shownotificationtouser*@param{string}message-Messagetodisplay*@param{string}type-Typeofnotification(success,error,warning,info)showNotification(message,type='info'){try{//UseerrorHandlerifavailableif(window.errorHandler){switch(type){case'success':window.errorHandler.showSuccess(message);break;case'error':window.errorHandler.showCustomError(message);break;case'warning':case'info':default://Forwarningandinfo,usesimplenotificationthis.createSimpleNotification(message,type);break;}}else{//Fallbacktoconsoleconsole.log(`${type.toUpperCase()}:${message}`);//CreatesimplenotificationifnoerrorHandlerthis.createSimpleNotification(message,type);}}catch(error){console.error('Errorshowingnotification:',error);console.log(`[${type.toUpperCase()}]${message}`);}}/***CreatesimplenotificationasfallbackcreateSimpleNotification(message,type){//RemovepreviousnotificationifexistsconstexistingNotification=document.querySelector('.simple-notification');if(existingNotification){existingNotification.remove();}//Createnewnotificationconstnotification=document.createElement('div');notification.className=`simple-notification${type}`;notification.style.cssText=`position:fixed;top:20px;right:20px;background:${type==='error'?'#ef4444':type==='warning'?'#f59e0b':type==='success'?'#10b981':'#3b82f6'};color:white;padding:12px20px;border-radius:6px;box-shadow:04px12pxrgba(0,0,0,0.3);z-index:10000;max-width:300px;font-size:14px;animation:slideIn0.3sease;`;notification.textContent=message;document.body.appendChild(notification);//Removerapós5segundossetTimeout(()=>{if(notification.parentNode){notification.style.animation='slideOut0.3sease';setTimeout(()=>notification.remove(),300);}},5000);//AdicionarCSSdeanimaçãosenãoexistirif(!document.querySelector('#simple-notification-styles')){conststyle=document.createElement('style');style.id='simple-notification-styles';style.textContent=`@keyframesslideIn{from{transform:translateX(100%);opacity:0;}to{transform:translateX(0);opacity:1;}}@keyframesslideOut{from{transform:translateX(0);opacity:1;}to{transform:translateX(100%);opacity:0;}}`;document.head.appendChild(style);}}loadData(){try{console.log('Loadingdata...');//Verificarseosmanagersestãodisponíveisif(!window.databaseManager){thrownewError('DatabaseManagernotavailable');}if(!window.mapManager){console.warn('MapManagernaodisponivel,pulandorenderizacaodepontos');this.updateStatistics();return;}//Inicializaromapaseaindanãofoiinicializadoif(!window.mapManager.map){console.log('Inicializandomapa...');window.mapManager.init();}//Renderizarpontoseatualizarestatísticasthis.renderPoints();this.updateStatistics();//Reconfigurarmenudecategoriasapósdadosestaremcarregadosconsole.log('Segundachamada:reconfigurandomenudecategorias...');this.configureCategoryMenu();//GarantirqueosbotõessãovisíveissetTimeout(()=>{constcontainer=document.getElementById('nav-buttons-container');constbuttons=container?container.querySelectorAll('.nav-btn'):[];console.log(`Verificaçãofinal:container=${!!container},botões=${buttons.length}`);if(container){container.style.display='flex';container.style.visibility='visible';container.style.opacity='1';console.log('Forçadavisibilidadedocontainerdenavegação');}buttons.forEach((btn,index)=>{btn.style.display='flex';btn.style.visibility='visible';btn.style.opacity='1';console.log(`Botão${index+1}forçadocomovisível`);});},100);console.log('Dadoscarregadoscomsucesso');}catch(error){console.error('Erroaocarregardados:',error);//Onlyshowerrorpop-upifnotduringinitializationif(this.isInitialized){this.showError('Erroaocarregardadosdomapa.');}throwerror;}}configureCategoryMenu(){constcontainer=document.getElementById('nav-buttons-container');if(!container){console.warn('Navigationcontainernotfound');return;}constcategorias=window.databaseManager.getCategorias();if(!categorias||categorias.length===0){console.warn('Nocategoriesfound');return;}console.log('Configurandomenudecategoriascom',categorias.length,'categorias');console.log('Categoriascarregadas:',categorias);//Criarbotão"Todos"primeiroletbuttonsHtml=`<buttonclass="nav-btnactivecategory-btn"data-categoria="todos"title="Todosospontos"style="display:flex!important;visibility:visible!important;opacity:1!important;"><iclass="fasfa-globe"></i><spanclass="nav-btn-text">Todos</span></button>`;//!TODO:Implementarsistemadefavoritos//Botãodefavoritosremovidodanavegaçãoconformesolicitação//(mantémapenasobotão"AdicionarFavoritos"nosdetalhesdoponto)//GerarbotõesparacadacategoriadoJSONcategorias.forEach(categoria=>{consticonClass=this.getIconClassForCategory(categoria);console.log(`Categoria:${categoria.id},Ícone:${iconClass},Nome:${categoria.nome}`);buttonsHtml+=`<buttonclass="nav-btncategory-btn"data-categoria="${categoria.id}"style="--category-color:${categoria.cor};display:flex!important;visibility:visible!important;opacity:1!important;"title="${categoria.nome}"><iclass="${iconClass}"></i><spanclass="nav-btn-text">${categoria.nome}</span></button>`;});//InserirHTMLnocontainercontainer.innerHTML=buttonsHtml;container.style.display='flex';container.style.visibility='visible';container.style.opacity='1';console.log('HTMLdosbotõesinseridonocontainer');//VerificarseosbotõesforamrealmentecriadosconstbuttonsCreated=container.querySelectorAll('.nav-btn');console.log(`${buttonsCreated.length}botõescriadosnoDOM`);//Configurareventlistenerscontainer.addEventListener('click',(e)=>{constbutton=e.target.closest('[data-categoria]');if(button){e.preventDefault();e.stopPropagation();constcategoria=button.dataset.categoria;console.log(`Cliquenacategoria:${categoria}`);this.filterByCategory(categoria);}});console.log(`Menudenavegaçãoconfiguradocom${categorias.length+1}botões(incluindo"Todos")`);}/***Mapearíconesparacategoriasbaseadonocampoicone/icondoJSONgetIconClassForCategory(categoria){//PrimeirotentarusaroíconedoJSON(seforclasseCSS)if(categoria.icon&&categoria.icon.startsWith('fas')){returncategoria.icon;}//Setememojinocampoicone,usaromapeamentoFontAwesomebaseadonoIDconsticonMap={'geral':'fasfa-map-marker-alt','esportes-lazer':'fasfa-futbol','gastronomia':'fasfa-utensils','geek-nerd':'fasfa-gamepad','casas-noturnas':'fasfa-glass-cheers'};returniconMap[categoria.id]||'fasfa-map-marker-alt';}filterByCategory(categoria){try{console.log(`Filteringbycategory:${categoria}`);this.activeCategory=categoria;//Atualizarbotõesdenavegaçãocomdebounceparaevitarmúltiploscliquesthis.updateCategoryButtons(categoria);console.log(`Botõesatualizadosparacategoria:${categoria}`);//Verificarseéfiltrodefavoritoseusuárioestálogadoif(categoria==='favoritos'){if(!window.authManager||!window.authManager.isAuthenticated()){console.log('Usernotloggedin,openingloginmodal');//Usuárionãologadotentandoverfavoritos-abrirmodaldeloginwindow.loginModal.open({pendingAction:()=>this.filterByCategory('favoritos')});return;}}//VerificarseMapManagerestádisponívelif(!window.mapManager){console.error('MapManagernotavailable');return;}if(typeofwindow.mapManager.filterByCategory!=='function'){console.error('MethodfilterByCategorynotfoundinMapManager');return;}//Filtrarmarcadoresconsole.log(`CallingMapManager.filterByCategorywith:${categoria}`);constuser=window.authManager&&window.authManager.getCurrentUser?window.authManager.getCurrentUser():null;console.log(`Usercontext:`,user?user.username:'anonymous');window.mapManager.filterByCategory(categoria,user?user.username:null);console.log(`Filterappliedsuccessfully:${categoria}`);}catch(error){console.error('Errorfilteringbycategory:',error);}}/***AtualizarestadovisualdosbotõesdecategoriaupdateCategoryButtons(categoriaAtiva){constbotoes=document.querySelectorAll('.nav-btn[data-categoria]');botoes.forEach(btn=>{constisActive=btn.dataset.categoria===categoriaAtiva;btn.classList.toggle('active',isActive);//Adicionaratributoparaacessibilidadebtn.setAttribute('aria-pressed',isActive);});}renderPoints(){try{if(!window.mapManager){console.warn('MapManagernaodisponivelpararenderizarpontos');return;}if(!window.databaseManager){console.warn('DatabaseManagernaodisponivel');return;}console.log('Startingpointrenderingviaapp...');//VerificarsehápontosnoDatabaseManagerconstpontosDisponiveis=window.databaseManager.getPontos();console.log(`PointsavailableinDatabaseManager:`,pontosDisponiveis.length);if(pontosDisponiveis.length===0){console.warn('NopointsfoundinDatabaseManager');//Trytoforcedatareloadconsole.log('Attemptingtoforcedatareload...');window.databaseManager.loadAllData().then(()=>{constnovospontos=window.databaseManager.getPontos();console.log(`Afterreload:${novospontos.length}points`);if(novospontos.length>0){this.renderPoints();//Tryagain}}).catch(error=>{console.error('Errorreloadingdata:',error);});return;}//Mostraralgunspontosdeexemploconsole.log('Examplepoints:',pontosDisponiveis.slice(0,3).map(p=>({id:p.id,nome:p.nome,categoria:p.categoria,coordenadas:p.coordenadas})));//UsarométodoreloadPointsdoMapManageremvezderenderizarmanualmenteconstuser=window.authManager?.getCurrentUser();constuserRole=user?.role||'visitor';constusername=user?.username||null;console.log(`Contextodousuário:${userRole}(${username||'anonymous'})`);//DelegarparaoMapManagerqueagoratemlógicaaprimoradaconsole.log('DelegandocarregamentoparaMapManager...');window.mapManager.reloadPoints(userRole,username);//Ativarfiltro"todos"porpadrãoapóscarregarpontossetTimeout(()=>{console.log('Aplicandofiltro"todos"apóscarregamento...');this.filterByCategory('todos');},200);console.log('RenderizaçãodelegadaparaMapManager');}catch(error){console.error('Errorrenderingpoints:',error);}}updateStatistics(){//Estatísticasremovidasdainterface//Métodomantidoparacompatibilidade}updateAdminInterface(){try{constelementos=document.querySelectorAll('.admin-only');elementos.forEach(el=>{el.style.display=this.isAdmin?'block':'none';});console.log(`Interfaceadminatualizada(${elementos.length}elementos)`);}catch(error){console.error('Erroaoatualizarinterfaceadmin:',error);}}mostrarModalLogin(){try{if(window.modalManager&&typeofwindow.modalManager.mostrar==='function'){window.modalManager.mostrar('login');}else{console.warn('ModalManagernaodisponivel');alert('Sistemadeloginnãoestádisponívelnomomento.');}}catch(error){console.error('Erroaomostrarmodaldelogin:',error);}}showError(message){console.error(message);//Useerrorhandlertoshowinteractivepopupif(window.errorHandler){window.errorHandler.showCustomError(message);}}removeLoadingScreen(){try{constloading=document.querySelector('.loading-screen');if(loading){document.body.classList.add('app-loaded');setTimeout(()=>{if(loading.parentNode){loading.remove();}//Forçarredimensionamentodomapaapósaremoçãodoloadingthis.forceMapResize();},500);console.log('Loadingscreenremovido');}else{console.log('Loadingscreennaoencontrado');//Mesmosemloadingscreen,tentarredimensionaromapathis.forceMapResize();}}catch(error){console.error('Erroaoremoverloadingscreen:',error);}}/***ForçaoredimensionamentodomapaparacorrigirproblemasderenderizaçãoinicialforceMapResize(){if(window.mapManager&&typeofwindow.mapManager.forceResize==='function'){//AguardarumpoucoparagarantirqueasdimensõesestãoestabilizadassetTimeout(()=>{window.mapManager.forceResize();},100);}elseif(window.mapManager&&window.mapManager.map){//FallbackparamétododiretosetTimeout(()=>{try{console.log('Forcandoredimensionamentodomapa(fallback)...');window.mapManager.map.invalidateSize(true);setTimeout(()=>{window.mapManager.map.invalidateSize(true);console.log('Maparedimensionadocomsucesso');},200);}catch(error){console.error('Erroaoredimensionarmapa:',error);}},100);}}/***ConfigureglobalapplicationresponsivenessconfigureResponsiveness(){console.log('Configurandoresponsividade...');//Configureviewportmetatagifitdoesn'texistthis.configureViewport();//Eventlistenersfororientationchangesandresizingthis.configureResponsiveEventListeners();//Configuretouchbehaviorformobilethis.configureTouchBehavior();//Applyclassesbasedonscreensizethis.applyResponsiveClasses();console.log('Responsividadeconfigurada');}/***ConfigureviewportmetatagconfigureViewport(){letviewportMeta=document.querySelector('meta[name="viewport"]');if(!viewportMeta){viewportMeta=document.createElement('meta');viewportMeta.name='viewport';document.head.appendChild(viewportMeta);}viewportMeta.content='width=device-width,initial-scale=1.0,maximum-scale=5.0,user-scalable=yes';}/***ConfigureresponsiveeventlistenersconfigureResponsiveEventListeners(){//DebouncedresizehandlerletresizeTimeout;consthandleResize=()=>{clearTimeout(resizeTimeout);resizeTimeout=setTimeout(()=>{this.applyResponsiveClasses();this.adjustLayoutForScreenSize();},150);};//OrientationchangehandlerconsthandleOrientationChange=()=>{setTimeout(()=>{this.applyResponsiveClasses();this.adjustLayoutForScreenSize();//Triggermapresizeseexistirthis.forceMapResize();},300);};window.addEventListener('resize',handleResize);window.addEventListener('orientationchange',handleOrientationChange);}/***ConfiguretouchbehaviorformobiledevicesconfigureTouchBehavior(){//MelhorarperformancetouchemiOSdocument.addEventListener('touchstart',()=>{},{passive:true});//PrevenirzoomindesejadoemdoubletapemalgunselementosconstpreventZoomElements=document.querySelectorAll('.nav-btn,.btn,.theme-toggle-label');preventZoomElements.forEach(element=>{element.addEventListener('touchend',(e)=>{e.preventDefault();element.click();});});}/***ApplyCSSclassesbasedonscreensizeapplyResponsiveClasses(){constwidth=window.innerWidth;constbody=document.body;//Removerclassesexistentesbody.classList.remove('mobile','tablet','desktop');//Aplicarclassebaseadanalarguraif(width<=480){body.classList.add('mobile');}elseif(width<=768){body.classList.add('tablet');}else{body.classList.add('desktop');}}/***AdjustlayoutforscreensizeadjustLayoutForScreenSize(){constisMobile=window.innerWidth<=768;//AjustaralturadomapaconstmapContainer=document.querySelector('.map-container');if(mapContainer){if(isMobile){mapContainer.style.height='calc(100vh-180px)';}else{mapContainer.style.height='calc(100vh-120px)';}}}//APIpúblicaparaadminadicionarPonto(dadosPonto){if(!this.isAdmin)returnfalse;//Obtercontextodousuárioatualconstuser=window.authManager?.getCurrentUser();constuserRole=user?.role||'visitor';constusername=user?.username||null;constponto=window.databaseManager.adicionarPonto(dadosPonto,userRole,username);window.mapManager.adicionarMarcador(ponto);this.updateStatistics();returntrue;}removerPonto(pontoId){if(!this.isAdmin)returnfalse;//Obtercontextodousuárioatualconstuser=window.authManager?.getCurrentUser();constuserRole=user?.role||'visitor';window.databaseManager.removerPonto(pontoId,userRole);window.mapManager.removerMarcador(pontoId);this.updateStatistics();returntrue;}}//Nãoinstanciaraqui-seráfeitonoHTML

```javascript
/***PontosEntretenimentoApp-AplicaçãoPrincipal**Estaclasseéopontocentraldecoordenaçãodaaplicação,implementando*osprincípiosdeCleanArchitecture.Elagerenciaociclodevidacompleto*daaplicação,desdeainicializaçãoatéocarregamentodosdados.**ResponsabilidadesPrincipais:*-Coordenarinicializaçãodetodososmanagers*-Gerenciarestadoglobaldaaplicação(categoriaativa,usuário,etc.)*-Controlarresponsividadeeadaptaçãomobile*-Orquestrarcomunicaçãoentrecomponentes*-Gerenciarloadingetratamentodeerros**FluxodeInicialização:*1.AguardarDOMestarpronto*2.Aguardartodososmanagersestaremdisponíveis*3.Configurarresponsividade*4.Verificarautenticação*5.Configurarinterfacebaseadanousuário*6.Configurareventosglobais*7.Carregarerenderizardados*8.Removerteladeloading**Usadopor:index.html(instanciação)*Dependências:DatabaseManager,AuthManager,MapManager**@authorTalesOliveira(github.com/TalesLimaOliveira)*@version1.0.0*@noteEstearquivocontémtrechosdecódigogeradoscomauxíliodeInteligênciaArtificial.*/classPontosEntretenimentoApp{/***Construtordaaplicaçãoprincipal**Inicializapropriedadesbásicaseiniciaoprocessodecarregamento*/constructor(){//Estadodaaplicaçãothis.isAdmin=false;//Seusuárioatualéadministradorthis.activeCategory='todos';//Categoriaatualmentefiltradathis.isInitialized=false;//Seaplicaçãofoitotalmenteinicializada//Configuraçõesderesponsividadethis.breakpoints={mobile:768,tablet:1024,desktop:1200};//Note:init()willbecalledbyAppInitializerinindex.html}/***Inicializaçãoprincipaldaaplicação**PontodeentradaqueaguardaoDOMestarprontoantesdeprosseguir*comainicializaçãocompleta.Implementatratamentorobustodeerros.**Usadopor:constructor*/asyncinit(){//Preventdoubleinitializationif(this.isInitialized){console.log('Applicationalreadyinitialized,skipping...');return;}try{console.log('InitializingSIGEntretenimentoDFapplication...');//AguardarDOMestarprontoif(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',()=>this._initialize());}else{awaitthis._initialize();}}catch(error){console.error('Criticalerrorduringapplicationinitialization:',error);this._showInitializationError(error);}}/***Completesequentialinitializationprocess**Implementstheinitializationflowinwell-definedstages,*ensuringeachdependencyisavailablebeforeproceeding.**@private*/async_initialize(){try{console.log('Waitingformanagers...');awaitthis.waitForManagers();console.log('Managersloaded');console.log('Configuringresponsiveness...');this.configureResponsiveness();console.log('Responsivenessconfigured');console.log('Verifyingauthentication...');this.verifyAuthentication();console.log('Authenticationverified');console.log('Configuringinterface...');awaitthis.configureInterface();console.log('Interfaceconfigured');console.log('Configuringevents...');this.configureEvents();console.log('Eventsconfigured');console.log('Loadingdata...');this.loadData();console.log('Dataloaded');console.log('Finalizinginitialization...');this.removeLoadingScreen();this._markAsInitialized();console.log('Applicationinitializedsuccessfully');}catch(error){console.error('Errorduringinitialization:',error);this._showInitializationError(error);}}/***Markapplicationasinitialized*@private*/_markAsInitialized(){this.isInitialized=true;document.body.classList.add('app-initialized');}/***Showinitializationerrorandremoveloading*@private*/_showInitializationError(error){//Onlylogtheerror,don'tshowpop-upsinceAppInitializerhandlesthisthis.removeLoadingScreen();console.error('Criticalerrorduringapplicationinitialization:',error);}/***Waitforallmanagerstobeavailable**Implementspollingwithtimeouttocheckifallnecessary*managershavebeenloadedandarefunctional.**@private*/asyncwaitForManagers(){constTIMEOUT_MS=10000;//10secondsconstCHECK_INTERVAL_MS=50;//50msconststart=Date.now();console.log('Waitingformanagers...');while(Date.now()-start<TIMEOUT_MS){constmanagersReady=this.checkManagers();if(managersReady.allReady){console.log('Allmanagersareready:',managersReady.ready);return;}if(managersReady.hasMinimal){console.log('Essentialmanagersready:',managersReady.ready);console.log('Missingmanagers:',managersReady.missing);return;}awaitnewPromise(resolve=>setTimeout(resolve,CHECK_INTERVAL_MS));}constmanagersStatus=this.checkManagers();console.error('Timeoutwaitingformanagers.Status:',managersStatus);if(managersStatus.hasMinimal){console.warn('Continuingwithessentialmanagers:',managersStatus.ready);return;}thrownewError('Essentialmanagerswerenotloadedwithintimelimit');}/***Checkwhichmanagersareready*/checkManagers(){constmanagers={databaseManager:window.databaseManager,authManager:window.authManager,modalManager:window.modalManager,mapManager:window.mapManager};constready=[];constmissing=[];for(const[name,manager]ofObject.entries(managers)){if(manager&&typeofmanager==='object'){ready.push(name);}else{missing.push(name);}}return{ready,missing,allReady:missing.length===0,hasMinimal:ready.includes('databaseManager')};}verifyAuthentication(){try{if(window.authManager&&window.authManager.isAuthenticated()){constuser=window.authManager.getCurrentUser();this.configureLoggedUser(user);}else{this.configureVisitorUser();}}catch(error){console.error('Errorverifyingauthentication:',error);this.configureVisitorUser();}}/***Configureinterfaceforloggeduser*/configureLoggedUser(user){console.log(`Loggeduser:${user.name}(${user.role})`);this.updateLoginButton(user);if(user.role==='administrator'){this.isAdmin=true;this.configureAdminInterface();}elseif(user.role==='user'){this.isAdmin=false;this.configureUserInterface();}this.updateFavoritesVisibility(user.role);}/***Configureinterfaceforvisitor*/configureVisitorUser(){console.log('Visitoruser');this.isAdmin=false;this.configureLoginButton();this.updateFavoritesVisibility('visitor');}/***Configureloginbuttonforvisitors*/configureLoginButton(){constloginBtn=document.getElementById('header-login-btn');if(loginBtn){loginBtn.innerHTML='<iclass="fasfa-user"></i>ENTRAR';loginBtn.onclick=()=>{window.loginModal.open();};}}/***Updatebuttonafterlogin*/updateLoginButton(user){constloginBtn=document.getElementById('header-login-btn');if(loginBtn){constisAdmin=user.role==='admin';constadminIcon=isAdmin?'<iclass="fasfa-shield-altadmin-icon"></i>':'';loginBtn.outerHTML=`<buttonclass="user-info${isAdmin?'is-admin':''}"id="user-info-btn"><divclass="user-avatar">${user.name.charAt(0).toUpperCase()}</div>${adminIcon}<iclass="fasfa-chevron-downdropdown-arrow"></i></button>`;this.configureUserMenu();}}/***Configureinterfaceforadministrator*/configureAdminInterface(){console.log('Configuringadministratorinterface');this.addAdminButtons();}/***Configureinterfaceforregularuser*/configureUserInterface(){console.log('Configuringuserinterface');//!TODO:Implementarsistemadefavoritos//this.addFavoritesCategory();this.configureUserActions();}/***Addadministratorbuttons*/addAdminButtons(){console.log('Addingadministratorfunctionalities');}/***Configureactionsforregularuser*/configureUserActions(){console.log('Configuringuseractions');}/***Showusermenu*/showUserMenu(user){if(user.role==='administrator'){//Adminpermanecenapáginaprincipaleacessapainelpelomenuconsole.log(`Administrator${user.name}loggedin-accessadminpanelviamenu`);}else{constlogout=confirm(`Hello${user.name}!\n\nDoyouwanttologout?`);if(logout){if(window.authManager)window.authManager.logout();location.reload();}}}asyncconfigureInterface(){try{console.log('Configuringinterface...');//DatabaseManagerjáfoiinicializadopeloAppInitializer//Verificarseestárealmentedisponívelif(!window.databaseManager){thrownewError('DatabaseManagernãodisponívelapósinicialização');}//Configurarmenudecategoriasapósdadosestaremcarregados//SeráchamadonovamenteemcarregarDados()paragarantirqueestáatualizadoconsole.log('Configuringcategorymenu(firstcall)');this.configureCategoryMenu();this.updateStatistics();console.log('Interfaceconfigured');}catch(error){console.error('Erroaoconfigurarinterface:',error);throwerror;}}configureStatistics(){//!TODO:Implementapplicationstatisticsconfigurationlogic}configureEvents(){//Eventlistenerparamudançasdeautenticaçãodocument.addEventListener('authStateChanged',(e)=>{try{const{type,user}=e.detail;console.log(`🔔Eventodeautenticaçãorecebido:${type}`);if(type==='login'){this.configureLoggedUser(user);this.reloadData();}elseif(type==='logout'){this.configureVisitorUser();this.reloadData();}}catch(error){console.error('Errorprocessingauthenticationevent:',error);//Trytoreconfigureasvisitorincaseoferrortry{this.configureVisitorUser();}catch(fallbackError){console.error('Errorinconfigurationfallback:',fallbackError);}}});//Configurarbotõesresponsivosthis.configureResponsiveButtons();//Nota:EventlistenersparafavoritoesugestãosãogerenciadospeloInfoPanelManager//paraevitarduplicaçãodeeventos}configureResponsiveButtons(){//ODynamicUserButtonagoragerenciaoseventosdecliquedosbotões//Nãoprecisamosmaisconfigurareventosmanuaisaqui//Ocomponenteseauto-inicializaegerenciatodoocomportamento//Notificarocomponentesobremudançasdeestadodeautenticaçãoif(window.dynamicUserButton){window.dynamicUserButton.updateButtonState();}}/***Handleaçãodefavoritar*/handleFavoriteAction(e){e.preventDefault();e.stopPropagation();//Verificarseousuárioestáautenticadoif(!window.authManager||!window.authManager.isAuthenticated()){console.log('Usuárionãoautenticado-abrindomodaldelogin');//VerificarseloginModalexisteif(!window.loginModal){console.error('Modaldeloginnãodisponível');this.showNotification('Sistemadeloginnãodisponível.Recarregueapágina.','error');return;}//Abrirmodaldelogincomaçãopendentewindow.loginModal.open({pendingAction:()=>this.handleFavoriteAction(e)});return;}//ImplementarlógicadefavoritosparausuárioslogadosconstpontoId=this.getCurrentPontoId();if(pontoId){this.toggleFavorito(pontoId);}else{console.warn('Nenhumpontoselecionadoparafavoritar');this.showNotification('Selecioneumpontoparafavoritar','warning');}}/***Handleaçãodesugerirmudança*/handleSuggestAction(e){e.preventDefault();e.stopPropagation();//Verificarseousuárioestáautenticadoif(!window.authManager||!window.authManager.isAuthenticated()){console.log('Usuárionãoautenticado-abrindomodaldelogin');//VerificarseloginModalexisteif(!window.loginModal){console.error('Modaldeloginnãodisponível');this.showNotification('Sistemadeloginnãodisponível.Recarregueapágina.','error');return;}//Abrirmodaldelogincomaçãopendentewindow.loginModal.open({pendingAction:()=>this.handleSuggestAction(e)});return;}//ImplementarsistemadesugestõesparamudançasnospontosconstpontoId=this.getCurrentPontoId();if(pontoId){this.openSuggestionModal(pontoId);}else{console.warn('Nenhumpontoselecionadoparasugerirmudança');this.showNotification('Selecioneumpontoparasugerirmudanças','warning');}}/***Recarregardadosapósmudançadeautenticação*/reloadData(){if(window.mapManager){constuser=window.authManager&&window.authManager.getCurrentUser?window.authManager.getCurrentUser():null;window.mapManager.reloadPoints(user?user.role:'visitor',user?user.username:null);}this.updateStatistics();}/***Togglefavorito-FUNCIONALIDADEEMDESENVOLVIMENTO*!TODO:Implementarsistemacompletodefavoritos*/toggleFavorito(pontoId){//Mostrarnotificaçãodefuncionalidadeemdesenvolvimentothis.showNotification('Funcionalidadeemdesenvolvimento','info');console.log('!TODO:Implementarsistemadefavoritos-pontoId:',pontoId);}/***GetcurrentpointID*/getCurrentPontoId(){//TentarobteroIDdopontoapartirdopaineldeinformaçõesabertoconstinfoPanel=document.getElementById('info-panel');if(infoPanel&&!infoPanel.classList.contains('hidden')){//Primeiro:verificarseháumbotãocomdata-ponto-id(maisconfiável)constpontoButton=infoPanel.querySelector('[data-ponto-id]');if(pontoButton){constpontoId=pontoButton.getAttribute('data-ponto-id');console.log('PontosApp:IDdopontoatualobtido:',pontoId);returnpontoId;}//Fallback:tentarobterdotítulodopainelconsttitleElement=infoPanel.querySelector('.info-panel-title');if(titleElement&&titleElement.textContent){//Buscaropontopelosdadoscarregadosusandoonomeconstpontos=window.databaseManager?window.databaseManager.getPontosConfirmados():[];constponto=pontos.find(p=>p.nome===titleElement.textContent.trim());if(ponto){console.log('PontosApp:IDdopontoobtidoviafallback:',ponto.id);returnponto.id;}}}console.warn('PontosApp:Nenhumpontoatualmenteselecionado');returnnull;}/***Abrirmodaldesugestão(placeholder)*/openSuggestionModal(pontoId){console.log(`AbrindomodaldesugestãoparapontoID:${pontoId}`);this.showNotification('Sistemadesugestõesemdesenvolvimento','info');}/***Shownotificationtouser*@param{string}message-Messagetodisplay*@param{string}type-Typeofnotification(success,error,warning,info)*/showNotification(message,type='info'){try{//UseerrorHandlerifavailableif(window.errorHandler){switch(type){case'success':window.errorHandler.showSuccess(message);break;case'error':window.errorHandler.showCustomError(message);break;case'warning':case'info':default://Forwarningandinfo,usesimplenotificationthis.createSimpleNotification(message,type);break;}}else{//Fallbacktoconsoleconsole.log(`${type.toUpperCase()}:${message}`);//CreatesimplenotificationifnoerrorHandlerthis.createSimpleNotification(message,type);}}catch(error){console.error('Errorshowingnotification:',error);console.log(`[${type.toUpperCase()}]${message}`);}}/***Createsimplenotificationasfallback*/createSimpleNotification(message,type){//RemovepreviousnotificationifexistsconstexistingNotification=document.querySelector('.simple-notification');if(existingNotification){existingNotification.remove();}//Createnewnotificationconstnotification=document.createElement('div');notification.className=`simple-notification${type}`;notification.style.cssText=`position:fixed;top:20px;right:20px;background:${type==='error'?'#ef4444':type==='warning'?'#f59e0b':type==='success'?'#10b981':'#3b82f6'};color:white;padding:12px20px;border-radius:6px;box-shadow:04px12pxrgba(0,0,0,0.3);z-index:10000;max-width:300px;font-size:14px;animation:slideIn0.3sease;`;notification.textContent=message;document.body.appendChild(notification);//Removerapós5segundossetTimeout(()=>{if(notification.parentNode){notification.style.animation='slideOut0.3sease';setTimeout(()=>notification.remove(),300);}},5000);//AdicionarCSSdeanimaçãosenãoexistirif(!document.querySelector('#simple-notification-styles')){conststyle=document.createElement('style');style.id='simple-notification-styles';style.textContent=`@keyframesslideIn{from{transform:translateX(100%);opacity:0;}to{transform:translateX(0);opacity:1;}}@keyframesslideOut{from{transform:translateX(0);opacity:1;}to{transform:translateX(100%);opacity:0;}}`;document.head.appendChild(style);}}loadData(){try{console.log('Loadingdata...');//Verificarseosmanagersestãodisponíveisif(!window.databaseManager){thrownewError('DatabaseManagernotavailable');}if(!window.mapManager){console.warn('MapManagernaodisponivel,pulandorenderizacaodepontos');this.updateStatistics();return;}//Inicializaromapaseaindanãofoiinicializadoif(!window.mapManager.map){console.log('Inicializandomapa...');window.mapManager.init();}//Renderizarpontoseatualizarestatísticasthis.renderPoints();this.updateStatistics();//Reconfigurarmenudecategoriasapósdadosestaremcarregadosconsole.log('Segundachamada:reconfigurandomenudecategorias...');this.configureCategoryMenu();//GarantirqueosbotõessãovisíveissetTimeout(()=>{constcontainer=document.getElementById('nav-buttons-container');constbuttons=container?container.querySelectorAll('.nav-btn'):[];console.log(`Verificaçãofinal:container=${!!container},botões=${buttons.length}`);if(container){container.style.display='flex';container.style.visibility='visible';container.style.opacity='1';console.log('Forçadavisibilidadedocontainerdenavegação');}buttons.forEach((btn,index)=>{btn.style.display='flex';btn.style.visibility='visible';btn.style.opacity='1';console.log(`Botão${index+1}forçadocomovisível`);});},100);console.log('Dadoscarregadoscomsucesso');}catch(error){console.error('Erroaocarregardados:',error);//Onlyshowerrorpop-upifnotduringinitializationif(this.isInitialized){this.showError('Erroaocarregardadosdomapa.');}throwerror;}}configureCategoryMenu(){constcontainer=document.getElementById('nav-buttons-container');if(!container){console.warn('Navigationcontainernotfound');return;}constcategorias=window.databaseManager.getCategorias();if(!categorias||categorias.length===0){console.warn('Nocategoriesfound');return;}console.log('Configurandomenudecategoriascom',categorias.length,'categorias');console.log('Categoriascarregadas:',categorias);//Criarbotão"Todos"primeiroletbuttonsHtml=`<buttonclass="nav-btnactivecategory-btn"data-categoria="todos"title="Todosospontos"style="display:flex!important;visibility:visible!important;opacity:1!important;"><iclass="fasfa-globe"></i><spanclass="nav-btn-text">Todos</span></button>`;//!TODO:Implementarsistemadefavoritos//Botãodefavoritosremovidodanavegaçãoconformesolicitação//(mantémapenasobotão"AdicionarFavoritos"nosdetalhesdoponto)//GerarbotõesparacadacategoriadoJSONcategorias.forEach(categoria=>{consticonClass=this.getIconClassForCategory(categoria);console.log(`Categoria:${categoria.id},Ícone:${iconClass},Nome:${categoria.nome}`);buttonsHtml+=`<buttonclass="nav-btncategory-btn"data-categoria="${categoria.id}"style="--category-color:${categoria.cor};display:flex!important;visibility:visible!important;opacity:1!important;"title="${categoria.nome}"><iclass="${iconClass}"></i><spanclass="nav-btn-text">${categoria.nome}</span></button>`;});//InserirHTMLnocontainercontainer.innerHTML=buttonsHtml;container.style.display='flex';container.style.visibility='visible';container.style.opacity='1';console.log('HTMLdosbotõesinseridonocontainer');//VerificarseosbotõesforamrealmentecriadosconstbuttonsCreated=container.querySelectorAll('.nav-btn');console.log(`${buttonsCreated.length}botõescriadosnoDOM`);//Configurareventlistenerscontainer.addEventListener('click',(e)=>{constbutton=e.target.closest('[data-categoria]');if(button){e.preventDefault();e.stopPropagation();constcategoria=button.dataset.categoria;console.log(`Cliquenacategoria:${categoria}`);this.filterByCategory(categoria);}});console.log(`Menudenavegaçãoconfiguradocom${categorias.length+1}botões(incluindo"Todos")`);}/***Mapearíconesparacategoriasbaseadonocampoicone/icondoJSON*/getIconClassForCategory(categoria){//PrimeirotentarusaroíconedoJSON(seforclasseCSS)if(categoria.icon&&categoria.icon.startsWith('fas')){returncategoria.icon;}//Setememojinocampoicone,usaromapeamentoFontAwesomebaseadonoIDconsticonMap={'geral':'fasfa-map-marker-alt','esportes-lazer':'fasfa-futbol','gastronomia':'fasfa-utensils','geek-nerd':'fasfa-gamepad','casas-noturnas':'fasfa-glass-cheers'};returniconMap[categoria.id]||'fasfa-map-marker-alt';}filterByCategory(categoria){try{console.log(`Filteringbycategory:${categoria}`);this.activeCategory=categoria;//Atualizarbotõesdenavegaçãocomdebounceparaevitarmúltiploscliquesthis.updateCategoryButtons(categoria);console.log(`Botõesatualizadosparacategoria:${categoria}`);//Verificarseéfiltrodefavoritoseusuárioestálogadoif(categoria==='favoritos'){if(!window.authManager||!window.authManager.isAuthenticated()){console.log('Usernotloggedin,openingloginmodal');//Usuárionãologadotentandoverfavoritos-abrirmodaldeloginwindow.loginModal.open({pendingAction:()=>this.filterByCategory('favoritos')});return;}}//VerificarseMapManagerestádisponívelif(!window.mapManager){console.error('MapManagernotavailable');return;}if(typeofwindow.mapManager.filterByCategory!=='function'){console.error('MethodfilterByCategorynotfoundinMapManager');return;}//Filtrarmarcadoresconsole.log(`CallingMapManager.filterByCategorywith:${categoria}`);constuser=window.authManager&&window.authManager.getCurrentUser?window.authManager.getCurrentUser():null;console.log(`Usercontext:`,user?user.username:'anonymous');window.mapManager.filterByCategory(categoria,user?user.username:null);console.log(`Filterappliedsuccessfully:${categoria}`);}catch(error){console.error('Errorfilteringbycategory:',error);}}/***Atualizarestadovisualdosbotõesdecategoria*/updateCategoryButtons(categoriaAtiva){constbotoes=document.querySelectorAll('.nav-btn[data-categoria]');botoes.forEach(btn=>{constisActive=btn.dataset.categoria===categoriaAtiva;btn.classList.toggle('active',isActive);//Adicionaratributoparaacessibilidadebtn.setAttribute('aria-pressed',isActive);});}renderPoints(){try{if(!window.mapManager){console.warn('MapManagernaodisponivelpararenderizarpontos');return;}if(!window.databaseManager){console.warn('DatabaseManagernaodisponivel');return;}console.log('Startingpointrenderingviaapp...');//VerificarsehápontosnoDatabaseManagerconstpontosDisponiveis=window.databaseManager.getPontos();console.log(`PointsavailableinDatabaseManager:`,pontosDisponiveis.length);if(pontosDisponiveis.length===0){console.warn('NopointsfoundinDatabaseManager');//Trytoforcedatareloadconsole.log('Attemptingtoforcedatareload...');window.databaseManager.loadAllData().then(()=>{constnovospontos=window.databaseManager.getPontos();console.log(`Afterreload:${novospontos.length}points`);if(novospontos.length>0){this.renderPoints();//Tryagain}}).catch(error=>{console.error('Errorreloadingdata:',error);});return;}//Mostraralgunspontosdeexemploconsole.log('Examplepoints:',pontosDisponiveis.slice(0,3).map(p=>({id:p.id,nome:p.nome,categoria:p.categoria,coordenadas:p.coordenadas})));//UsarométodoreloadPointsdoMapManageremvezderenderizarmanualmenteconstuser=window.authManager?.getCurrentUser();constuserRole=user?.role||'visitor';constusername=user?.username||null;console.log(`Contextodousuário:${userRole}(${username||'anonymous'})`);//DelegarparaoMapManagerqueagoratemlógicaaprimoradaconsole.log('DelegandocarregamentoparaMapManager...');window.mapManager.reloadPoints(userRole,username);//Ativarfiltro"todos"porpadrãoapóscarregarpontossetTimeout(()=>{console.log('Aplicandofiltro"todos"apóscarregamento...');this.filterByCategory('todos');},200);console.log('RenderizaçãodelegadaparaMapManager');}catch(error){console.error('Errorrenderingpoints:',error);}}updateStatistics(){//Estatísticasremovidasdainterface//Métodomantidoparacompatibilidade}updateAdminInterface(){try{constelementos=document.querySelectorAll('.admin-only');elementos.forEach(el=>{el.style.display=this.isAdmin?'block':'none';});console.log(`Interfaceadminatualizada(${elementos.length}elementos)`);}catch(error){console.error('Erroaoatualizarinterfaceadmin:',error);}}mostrarModalLogin(){try{if(window.modalManager&&typeofwindow.modalManager.mostrar==='function'){window.modalManager.mostrar('login');}else{console.warn('ModalManagernaodisponivel');alert('Sistemadeloginnãoestádisponívelnomomento.');}}catch(error){console.error('Erroaomostrarmodaldelogin:',error);}}showError(message){console.error(message);//Useerrorhandlertoshowinteractivepopupif(window.errorHandler){window.errorHandler.showCustomError(message);}}removeLoadingScreen(){try{constloading=document.querySelector('.loading-screen');if(loading){document.body.classList.add('app-loaded');setTimeout(()=>{if(loading.parentNode){loading.remove();}//Forçarredimensionamentodomapaapósaremoçãodoloadingthis.forceMapResize();},500);console.log('Loadingscreenremovido');}else{console.log('Loadingscreennaoencontrado');//Mesmosemloadingscreen,tentarredimensionaromapathis.forceMapResize();}}catch(error){console.error('Erroaoremoverloadingscreen:',error);}}/***Forçaoredimensionamentodomapaparacorrigirproblemasderenderizaçãoinicial*/forceMapResize(){if(window.mapManager&&typeofwindow.mapManager.forceResize==='function'){//AguardarumpoucoparagarantirqueasdimensõesestãoestabilizadassetTimeout(()=>{window.mapManager.forceResize();},100);}elseif(window.mapManager&&window.mapManager.map){//FallbackparamétododiretosetTimeout(()=>{try{console.log('Forcandoredimensionamentodomapa(fallback)...');window.mapManager.map.invalidateSize(true);setTimeout(()=>{window.mapManager.map.invalidateSize(true);console.log('Maparedimensionadocomsucesso');},200);}catch(error){console.error('Erroaoredimensionarmapa:',error);}},100);}}/***Configureglobalapplicationresponsiveness*/configureResponsiveness(){console.log('Configurandoresponsividade...');//Configureviewportmetatagifitdoesn'texistthis.configureViewport();//Eventlistenersfororientationchangesandresizingthis.configureResponsiveEventListeners();//Configuretouchbehaviorformobilethis.configureTouchBehavior();//Applyclassesbasedonscreensizethis.applyResponsiveClasses();console.log('Responsividadeconfigurada');}/***Configureviewportmetatag*/configureViewport(){letviewportMeta=document.querySelector('meta[name="viewport"]');if(!viewportMeta){viewportMeta=document.createElement('meta');viewportMeta.name='viewport';document.head.appendChild(viewportMeta);}viewportMeta.content='width=device-width,initial-scale=1.0,maximum-scale=5.0,user-scalable=yes';}/***Configureresponsiveeventlisteners*/configureResponsiveEventListeners(){//DebouncedresizehandlerletresizeTimeout;consthandleResize=()=>{clearTimeout(resizeTimeout);resizeTimeout=setTimeout(()=>{this.applyResponsiveClasses();this.adjustLayoutForScreenSize();},150);};//OrientationchangehandlerconsthandleOrientationChange=()=>{setTimeout(()=>{this.applyResponsiveClasses();this.adjustLayoutForScreenSize();//Triggermapresizeseexistirthis.forceMapResize();},300);};window.addEventListener('resize',handleResize);window.addEventListener('orientationchange',handleOrientationChange);}/***Configuretouchbehaviorformobiledevices*/configureTouchBehavior(){//MelhorarperformancetouchemiOSdocument.addEventListener('touchstart',()=>{},{passive:true});//PrevenirzoomindesejadoemdoubletapemalgunselementosconstpreventZoomElements=document.querySelectorAll('.nav-btn,.btn,.theme-toggle-label');preventZoomElements.forEach(element=>{element.addEventListener('touchend',(e)=>{e.preventDefault();element.click();});});}/***ApplyCSSclassesbasedonscreensize*/applyResponsiveClasses(){constwidth=window.innerWidth;constbody=document.body;//Removerclassesexistentesbody.classList.remove('mobile','tablet','desktop');//Aplicarclassebaseadanalarguraif(width<=480){body.classList.add('mobile');}elseif(width<=768){body.classList.add('tablet');}else{body.classList.add('desktop');}}/***Adjustlayoutforscreensize*/adjustLayoutForScreenSize(){constisMobile=window.innerWidth<=768;//AjustaralturadomapaconstmapContainer=document.querySelector('.map-container');if(mapContainer){if(isMobile){mapContainer.style.height='calc(100vh-180px)';}else{mapContainer.style.height='calc(100vh-120px)';}}}//APIpúblicaparaadminadicionarPonto(dadosPonto){if(!this.isAdmin)returnfalse;//Obtercontextodousuárioatualconstuser=window.authManager?.getCurrentUser();constuserRole=user?.role||'visitor';constusername=user?.username||null;constponto=window.databaseManager.adicionarPonto(dadosPonto,userRole,username);window.mapManager.adicionarMarcador(ponto);this.updateStatistics();returntrue;}removerPonto(pontoId){if(!this.isAdmin)returnfalse;//Obtercontextodousuárioatualconstuser=window.authManager?.getCurrentUser();constuserRole=user?.role||'visitor';window.databaseManager.removerPonto(pontoId,userRole);window.mapManager.removerMarcador(pontoId);this.updateStatistics();returntrue;}}//Nãoinstanciaraqui-seráfeitonoHTML
```

### src/js/auth.js

**Linha 1:** Implementarsalvamentorealnoservidor//awaitfetch('/api/users',{//method:'POST',//headers:{'Content-Type':'application/json'},//body:JSON.stringify(users)//});}catch(error){console.error('AuthManager:Erroaosalvarusuários:',error);thrownewError('Erroaosalvardadosdousuário');}}/***GerarIDúnicoparausuário*@param{string}usuario-Nomedeusuário*@returns{string}IDúnicogenerateUserId(usuario){consttimestamp=Date.now();constrandom=Math.random().toString(36).substr(2,5);return`${usuario}_${timestamp}_${random}`;}/***CarregarsessãosalvaloadSession(){try{constsessionData=localStorage.getItem('pontosDF_session');if(!sessionData){returnfalse;}constsession=JSON.parse(sessionData);//Verificarseasessãonãoexpirouif(Date.now()>session.expiresAt){this.logout();returnfalse;}this.currentUser=session.user;returntrue;}catch(error){console.error('Erroaocarregarsessão:',error);this.logout();returnfalse;}}/***ValidarsessãoatualvalidateSession(){constsessionData=localStorage.getItem('pontosDF_session');if(!sessionData){if(this.currentUser){this.logout();}returnfalse;}try{constsession=JSON.parse(sessionData);if(Date.now()>session.expiresAt){this.logout();returnfalse;}returntrue;}catch(error){this.logout();returnfalse;}}/***Verificarseusuárioestálogado*@returns{boolean}isAuthenticated(){returnthis.currentUser!==null&&this.validateSession();}/***Verificarseusuárioéadministrador*@returns{boolean}isAdmin(){returnthis.isAuthenticated()&&this.currentUser.role==='administrator';}/***Verificarseusuáriotempermissãoespecífica*@param{string}permission-Permissãoaverificar*@returns{boolean}hasPermission(permission){if(!this.isAuthenticated()){returnfalse;}returnthis.currentUser.permissions.includes(permission);}/***Obterusuárioatual*@returns{Object|null}getCurrentUser(){returnthis.currentUser;}/***Verificarseestáempáginaadministrativa*@returns{boolean}isAdminPage(){returnwindow.location.pathname.includes('admin.html');}/***ProtegerrotaadministrativaprotectAdminRoute(){if(this.isAdminPage()&&!this.isAdmin()){alert('Acessonegado.Apenasadministradorespodemacessarestapágina.');window.location.href='index.html';returnfalse;}returntrue;}/***MarcarinatividadedousuáriomarkInactivity(){if(this.currentUser){constsessionData=JSON.parse(localStorage.getItem('pontosDF_session'));sessionData.lastActivity=Date.now();localStorage.setItem('pontosDF_session',JSON.stringify(sessionData));}}/***EstendersessãoextendSession(){if(this.currentUser){constsessionData=JSON.parse(localStorage.getItem('pontosDF_session'));sessionData.expiresAt=Date.now()+this.sessionTimeout;localStorage.setItem('pontosDF_session',JSON.stringify(sessionData));}}/***Disparareventodeautenticação*@param{string}type-Tipodoevento(login/logout)*@param{Object}user-DadosdousuáriodispatchAuthEvent(type,user){try{constevent=newCustomEvent('authStateChanged',{detail:{type,user}});document.dispatchEvent(event);console.log(`Eventodeautenticaçãodisparado:${type}`);}catch(error){console.error('Erroaodisparareventodeautenticação:',error);//Continuarmesmocomerronoevento}}/***Gerartokentemporárioparaaçõessensíveis*@returns{string}generateActionToken(){if(!this.isAuthenticated()){thrownewError('Usuárionãoautenticado');}consttoken={user:this.currentUser.username,timestamp:Date.now(),expires:Date.now()+(5*60*1000),//5minutosnonce:Math.random().toString(36).substr(2,9)};returnbtoa(JSON.stringify(token));}/***Validartokendeação*@param{string}token-Tokenavalidar*@returns{boolean}validateActionToken(token){try{consttokenData=JSON.parse(atob(token));if(Date.now()>tokenData.expires){returnfalse;}if(tokenData.user!==this.currentUser.username){returnfalse;}returntrue;}catch(error){returnfalse;}}}//CriarinstânciaglobalconstauthManager=newAuthManager();//Exportarparausoemmódulosif(typeofmodule!=='undefined'&&module.exports){module.exports=AuthManager;}//Disponibilizarglobalmentewindow.AuthManager=AuthManager;window.authManager=authManager;console.log('🔐AuthManagerinicializadoedisponibilizadoglobalmente

```javascript
/***AuthenticationSystem*Manageslogin,logoutandaccesscontrol**@authorTalesOliveira(github.com/TalesLimaOliveira)*@version1.0.0*@noteThisfilecontainsAI-generatedcodesnippets*/classAuthManager{constructor(){this.currentUser=null;this.sessionTimeout=24*60*60*1000;//24horasthis.init();}/***Initializeauthenticationsystem*/init(){console.log('InitializingAuthManager...');this.loadSession();this.setupEventListeners();console.log('AuthManagerinitializedsuccessfully');}/***Configureeventlisteners*/setupEventListeners(){document.addEventListener('visibilitychange',()=>{if(document.hidden){this.markInactivity();}});setInterval(()=>{this.validateSession();},5*60*1000);}/***CarregarusuáriosdoarquivoJSON*@returns{Promise<Object>}Listadeusuários*/asyncloadUsers(){try{constresponse=awaitfetch('database/usuarios.json');if(!response.ok){thrownewError(`HTTP${response.status}:${response.statusText}`);}constusers=awaitresponse.json();console.log('AuthManager:UsuárioscarregadosdoJSON:',Object.keys(users));returnusers;}catch(error){console.error('AuthManager:ErroaocarregarusuáriosdoJSON:',error);//Fallbackparausuáriospadrãoemmemóriaconsole.warn('AuthManager:Usandousuáriospadrãocomofallback');returnthis.getDefaultUsers();}}/***Usuáriospadrãocomofallback*/getDefaultUsers(){return{admin:{id:'admin',nome:'AdministradordoSistema',usuario:'admin',email:'admin@sistema.com',senha:'admin',role:'administrator',permissions:['view','create','edit','delete','approve','manage_users','hide_points'],dataCriacao:newDate().toISOString(),ultimoLogin:null,ativo:true},user:{id:'user',nome:'UsuárioPadrão',usuario:'user',email:'user@sistema.com',senha:'user',role:'user',permissions:['view','create_pending','suggest_changes','favorite'],dataCriacao:newDate().toISOString(),ultimoLogin:null,ativo:true}};}/***Performlogin*@param{string}identifier-Usernameoremail*@param{string}password-Password*@returns{Promise<Object>}Loginresult*/asynclogin(identifier,password){try{constusers=awaitthis.loadUsers();letuser=null;//Buscarusuárioporusernameouemailfor(const[key,userData]ofObject.entries(users)){if(userData.usuario===identifier||userData.email===identifier){user=userData;break;}}if(!user){thrownewError('Usuárionãoencontrado');}if(!user.ativo){thrownewError('Usuáriodesativado');}if(user.senha!==password){thrownewError('Senhaincorreta');}//Atualizarúltimologinuser.ultimoLogin=newDate().toISOString();constsessionData={user:{id:user.id,nome:user.nome,usuario:user.usuario,email:user.email,role:user.role,permissions:user.permissions,ultimoLogin:user.ultimoLogin},loginTime:Date.now(),expiresAt:Date.now()+this.sessionTimeout};localStorage.setItem('pontosDF_session',JSON.stringify(sessionData));this.currentUser=sessionData.user;this.dispatchAuthEvent('login',this.currentUser);console.log('AuthManager:Loginrealizadocomsucessopara:',user.nome);return{success:true,user:this.currentUser,message:'Loginrealizadocomsucesso'};}catch(error){console.error('AuthManager:Erronologin:',error.message);return{success:false,error:error.message,message:'Falhanaautenticação'};}}/***Realizarlogout*/logout(){try{constuser=this.currentUser;console.log('🔓Efetuandologout...');//LimpardadosdasessãolocalStorage.removeItem('pontosDF_session');this.currentUser=null;//Disparareventodelogoutthis.dispatchAuthEvent('logout',user);console.log('Logoutcompletedsuccessfully');//Redirecionarparapáginaprincipalseestivernoadminif(this.isAdminPage()){window.location.href='index.html';}else{//Sejáestivernapáginaprincipal,apenasrecarregarapósumdelaysetTimeout(()=>{try{window.location.reload();}catch(reloadError){console.error('Erroaorecarregarpágina:',reloadError);//Fallback:recarregarforçadowindow.location.href=window.location.href;}},500);}}catch(error){console.error('Errodurantelogout:',error);//AindaassimtentarlimparasessãolocalStorage.removeItem('pontosDF_session');this.currentUser=null;//TentarrecarregarmesmocomerrosetTimeout(()=>{window.location.reload();},100);}}/***Cadastrarnovousuário*@param{Object}userData-Dadosdousuário*@returns{Promise<Object>}Resultadodocadastro*/asynccadastrarUsuario(userData){try{const{nome,usuario,email,senha}=userData;//Validaçõesbásicasif(!nome||!usuario||!email||!senha){thrownewError('Todososcampossãoobrigatórios');}if(nome.length<2){thrownewError('Nomedeveterpelomenos2caracteres');}if(usuario.length<3){thrownewError('Usuáriodeveterpelomenos3caracteres');}if(!email.includes('@')){thrownewError('Emaildeveterformatoválido');}if(senha.length<4){thrownewError('Senhadeveterpelomenos4caracteres');}//Carregarusuáriosexistentesconstusers=awaitthis.loadUsers();//Verificarseusuárioouemailjáexistemfor(const[key,existingUser]ofObject.entries(users)){if(existingUser.usuario===usuario){thrownewError('Nomedeusuáriojáexiste');}if(existingUser.email===email){thrownewError('Emailjáestáemuso');}}//CriarnovousuárioconstnovoId=this.generateUserId(usuario);constnovoUsuario={id:novoId,nome:nome.trim(),usuario:usuario.toLowerCase().trim(),email:email.toLowerCase().trim(),senha:senha,//Emprodução,seriahasheadarole:'user',permissions:['view','create_pending','suggest_changes','favorite'],dataCriacao:newDate().toISOString(),ultimoLogin:null,ativo:true};//Adicionaràlistadeusuáriosusers[novoId]=novoUsuario;//SalvarnoJSON(simulação-emproduçãoseriaservidor)awaitthis.saveUsers(users);console.log('AuthManager:Usuáriocadastradocomsucesso:',novoUsuario.nome);return{success:true,user:{id:novoUsuario.id,nome:novoUsuario.nome,usuario:novoUsuario.usuario,email:novoUsuario.email},message:'Usuáriocadastradocomsucesso'};}catch(error){console.error('AuthManager:Erronocadastro:',error.message);return{success:false,error:error.message,message:'Falhanocadastro'};}}/***SalvarusuáriosnoJSON(simulação)*@param{Object}users-Listadeusuários*/asyncsaveUsers(users){try{//Emproduçãoreal,issoseriaumarequisiçãoPOSTparaoservidor//Porora,salvamosnolocalStoragecomobackuplocalStorage.setItem('pontosDF_users_backup',JSON.stringify(users));console.log('AuthManager:Usuáriossalvos(simulação)',Object.keys(users).length);//!TODO:Implementarsalvamentorealnoservidor//awaitfetch('/api/users',{//method:'POST',//headers:{'Content-Type':'application/json'},//body:JSON.stringify(users)//});}catch(error){console.error('AuthManager:Erroaosalvarusuários:',error);thrownewError('Erroaosalvardadosdousuário');}}/***GerarIDúnicoparausuário*@param{string}usuario-Nomedeusuário*@returns{string}IDúnico*/generateUserId(usuario){consttimestamp=Date.now();constrandom=Math.random().toString(36).substr(2,5);return`${usuario}_${timestamp}_${random}`;}/***Carregarsessãosalva*/loadSession(){try{constsessionData=localStorage.getItem('pontosDF_session');if(!sessionData){returnfalse;}constsession=JSON.parse(sessionData);//Verificarseasessãonãoexpirouif(Date.now()>session.expiresAt){this.logout();returnfalse;}this.currentUser=session.user;returntrue;}catch(error){console.error('Erroaocarregarsessão:',error);this.logout();returnfalse;}}/***Validarsessãoatual*/validateSession(){constsessionData=localStorage.getItem('pontosDF_session');if(!sessionData){if(this.currentUser){this.logout();}returnfalse;}try{constsession=JSON.parse(sessionData);if(Date.now()>session.expiresAt){this.logout();returnfalse;}returntrue;}catch(error){this.logout();returnfalse;}}/***Verificarseusuárioestálogado*@returns{boolean}*/isAuthenticated(){returnthis.currentUser!==null&&this.validateSession();}/***Verificarseusuárioéadministrador*@returns{boolean}*/isAdmin(){returnthis.isAuthenticated()&&this.currentUser.role==='administrator';}/***Verificarseusuáriotempermissãoespecífica*@param{string}permission-Permissãoaverificar*@returns{boolean}*/hasPermission(permission){if(!this.isAuthenticated()){returnfalse;}returnthis.currentUser.permissions.includes(permission);}/***Obterusuárioatual*@returns{Object|null}*/getCurrentUser(){returnthis.currentUser;}/***Verificarseestáempáginaadministrativa*@returns{boolean}*/isAdminPage(){returnwindow.location.pathname.includes('admin.html');}/***Protegerrotaadministrativa*/protectAdminRoute(){if(this.isAdminPage()&&!this.isAdmin()){alert('Acessonegado.Apenasadministradorespodemacessarestapágina.');window.location.href='index.html';returnfalse;}returntrue;}/***Marcarinatividadedousuário*/markInactivity(){if(this.currentUser){constsessionData=JSON.parse(localStorage.getItem('pontosDF_session'));sessionData.lastActivity=Date.now();localStorage.setItem('pontosDF_session',JSON.stringify(sessionData));}}/***Estendersessão*/extendSession(){if(this.currentUser){constsessionData=JSON.parse(localStorage.getItem('pontosDF_session'));sessionData.expiresAt=Date.now()+this.sessionTimeout;localStorage.setItem('pontosDF_session',JSON.stringify(sessionData));}}/***Disparareventodeautenticação*@param{string}type-Tipodoevento(login/logout)*@param{Object}user-Dadosdousuário*/dispatchAuthEvent(type,user){try{constevent=newCustomEvent('authStateChanged',{detail:{type,user}});document.dispatchEvent(event);console.log(`Eventodeautenticaçãodisparado:${type}`);}catch(error){console.error('Erroaodisparareventodeautenticação:',error);//Continuarmesmocomerronoevento}}/***Gerartokentemporárioparaaçõessensíveis*@returns{string}*/generateActionToken(){if(!this.isAuthenticated()){thrownewError('Usuárionãoautenticado');}consttoken={user:this.currentUser.username,timestamp:Date.now(),expires:Date.now()+(5*60*1000),//5minutosnonce:Math.random().toString(36).substr(2,9)};returnbtoa(JSON.stringify(token));}/***Validartokendeação*@param{string}token-Tokenavalidar*@returns{boolean}*/validateActionToken(token){try{consttokenData=JSON.parse(atob(token));if(Date.now()>tokenData.expires){returnfalse;}if(tokenData.user!==this.currentUser.username){returnfalse;}returntrue;}catch(error){returnfalse;}}}//CriarinstânciaglobalconstauthManager=newAuthManager();//Exportarparausoemmódulosif(typeofmodule!=='undefined'&&module.exports){module.exports=AuthManager;}//Disponibilizarglobalmentewindow.AuthManager=AuthManager;window.authManager=authManager;console.log('🔐AuthManagerinicializadoedisponibilizadoglobalmente');
```

### src/js/database.js

**Linha 1:** Implementarsistemadefavoritoscompleto//{//id:'favoritos',//nome:'Favoritos',//icon:'fasfa-heart',//cor:'#ec4899',//descricao:'Pontosmarcadoscomofavoritospelousuário'//}];this.saveCategories();console.log('Categoriaspadrãocarregadas');//Disparareventoparaatualizarmarcadoresdocument.dispatchEvent(newCustomEvent('database_categoriasCarregadas',{detail:{categorias:this.categorias}}));}}/***SalvatodososdadossaveAllData(){localStorage.setItem(this.baseStorageKey+'_pontosConfirmados',JSON.stringify(this.confirmedPoints));localStorage.setItem(this.baseStorageKey+'_pontosPendentes',JSON.stringify(this.pendingPoints));localStorage.setItem(this.baseStorageKey+'_pontosOcultos',JSON.stringify(this.hiddenPoints));localStorage.setItem(this.baseStorageKey+'_usuarios',JSON.stringify(this.usuarios));}saveCategories(){localStorage.setItem(this.baseStorageKey+'_categorias',JSON.stringify(this.categorias));}/***ObtémdadosdousuáriooucriasenãoexistirobterDadosUsuario(username){if(!this.usuarios[username]){this.usuarios[username]={username:username,favoritos:[],pontosEnviados:[],sugestoesEnviadas:[],dataCriacao:newDate().toISOString()};this.saveAllData();}returnthis.usuarios[username];}/***InicializardadospadrãoquandonãohádadossalvosinitializeDefaultData(){console.log('Inicializandodadospadrão...');this.inicializarPontosDefault();this.loadCategories();//Garantirquecategoriasestejamcarregadasconsole.log('Dadospadraoinicializados');}inicializarPontosDefault(){constpontosDefault=[{id:1,nome:'TeatroNacionalClaudioSantoro',descricao:'PrincipalteatrodeBrasília,comprogramaçãodiversificada',categoria:'geral',coordenadas:[-15.796,-47.878],endereco:'ViaN2-AsaNorte,Brasília',telefone:'(61)3325-6268',horario:'Conformeprogramação',preco:'R$20-80',nota:4.6,verificado:true,status:'confirmado',dataAdicao:newDate().toISOString(),imagem:{url:'https://images.unsplash.com/photo-1507924538820-ede94a04019d?w=400',source:'web',description:'TeatroNacionaldeBrasília'}},{id:2,nome:'CineBrasília',descricao:'Cinemadearteecultura,comfilmesalternativos',categoria:'geral',coordenadas:[-15.795,-47.882],endereco:'EQS106/107-AsaSul,Brasília',telefone:'(61)3244-1660',horario:'14hàs22h',preco:'R$10-15',nota:4.4,verificado:true,status:'confirmado',dataAdicao:newDate().toISOString(),imagem:{url:'https://images.unsplash.com/photo-1489599433510-0fcf9d9c4e2d?w=400',source:'web',description:'CinemaBrasília'}},{id:3,nome:'EstádioNacionaldeBrasília',descricao:'Arenamultiusoparagrandeseventosesportivos',categoria:'esportes-lazer',coordenadas:[-15.783,-47.899],endereco:'SRPN-AsaNorte,Brasília',telefone:'(61)3424-4000',horario:'Conformeeventos',preco:'Variável',nota:4.5,verificado:true,status:'confirmado',dataAdicao:newDate().toISOString(),imagem:{url:'/assets/images/estadio-nacional.jpg',source:'local',description:'EstádioNacionaldeBrasília-ManéGarrincha'}},{id:4,nome:'ParquedaCidadeSarahKubitschek',descricao:'Maiorparqueurbanodomundo,idealparaesporteselazer',categoria:'esportes-lazer',coordenadas:[-15.788,-47.907],endereco:'AsaSul,Brasília',horario:'24horas',preco:'Gratuito',nota:4.7,verificado:true,status:'confirmado',dataAdicao:newDate().toISOString()},{id:5,nome:'RestauranteOlivae',descricao:'Restauranteitalianosofisticadocomambienteacolhedor',categoria:'gastronomia',coordenadas:[-15.795,-48.105],endereco:'CLN201-AsaNorte,Brasília',telefone:'(61)3340-8120',horario:'12hàs15h,19hàs23h',preco:'R$80-120',nota:4.5,verificado:true,status:'confirmado',dataAdicao:newDate().toISOString()},{id:6,nome:'FeiradaTorredeTV',descricao:'Feiragastronômicatradicionalaosfinsdesemana',categoria:'gastronomia',coordenadas:[-15.790,-47.896],endereco:'TorredeTV,AsaNorte,Brasília',horario:'Sábadosedomingos,9hàs18h',preco:'R$15-40',nota:4.2,verificado:true,status:'confirmado',dataAdicao:newDate().toISOString()},{id:7,nome:'Dragonstore',descricao:'Lojaespecializadaemjogos,cardseculturageek',categoria:'geek-nerd',coordenadas:[-15.794,-47.889],endereco:'CLN208-AsaNorte,Brasília',telefone:'(61)3328-1234',horario:'10hàs22h',preco:'R$20-200',nota:4.6,verificado:true,status:'confirmado',dataAdicao:newDate().toISOString()},{id:8,nome:'ArenaE-SportsBSB',descricao:'Centrodee-sportscomtorneiosecompetições',categoria:'geek-nerd',coordenadas:[-15.835,-48.044],endereco:'TaguatingaCentro,Brasília',telefone:'(61)3562-9876',horario:'14hàs23h',preco:'R$10-30/hora',nota:4.3,verificado:true,status:'confirmado',dataAdicao:newDate().toISOString()},{id:9,nome:'CentroCulturaldaRepública',descricao:'Espaçoculturalindependentecomexposiçõesalternativas',categoria:'geral',coordenadas:[-15.797,-47.879],endereco:'EixoMonumental,Brasília',horario:'9hàs18h',preco:'Gratuito',nota:4.4,verificado:true,status:'confirmado',dataAdicao:newDate().toISOString()},{id:10,nome:'SaraudoBeco',descricao:'Sarauindependentecompoesiaemúsica',categoria:'geral',coordenadas:[-15.840,-48.045],endereco:'TaguatingaNorte,Brasília',horario:'Quintas,19hàs23h',preco:'R$5-15',nota:4.1,verificado:true,status:'confirmado',dataAdicao:newDate().toISOString()},{id:11,nome:'VillaMixBrasília',descricao:'Casanoturnacommúsicasertanejaeeletrônica',categoria:'casas-noturnas',coordenadas:[-15.796,-47.885],endereco:'SCLS109-AsaSul,Brasília',telefone:'(61)3244-1010',horario:'22hàs4h',preco:'R$40-80',nota:4.2,verificado:true,status:'confirmado',dataAdicao:newDate().toISOString()},{id:12,nome:'Lounge442',descricao:'Loungesofisticadocomdrinksautorais',categoria:'casas-noturnas',coordenadas:[-15.794,-47.886],endereco:'CLN442-AsaNorte,Brasília',telefone:'(61)3328-4422',horario:'19hàs2h',preco:'R$30-60',nota:4.0,verificado:true,status:'confirmado',dataAdicao:newDate().toISOString()}];this.confirmedPoints=pontosDefault;this.proximoId=13;this.saveAllData();console.log(`${pontosDefault.length}pontospadraocarregados`);}//APIpública-Métodosprincipais/***Retornapontosvisíveis(confirmados)getPontos(){returnthis.confirmedPoints;}/***RetornapontosbaseadonoperfildousuáriogetPontosParaUsuario(userRole='visitor',username=null){if(userRole==='administrator'){return[...this.confirmedPoints,...this.pendingPoints];}returnthis.confirmedPoints;}/***Retornapontospendentes(apenasparaadmin)getPontosPendentes(){returnthis.pendingPoints;}/***Retornapontosocultos(apenasparaadmin)getPontosOcultos(){returnthis.hiddenPoints;}getCategorias(){returnthis.categorias;}getPontoById(id){constpontoId=parseInt(id);return[...this.confirmedPoints,...this.pendingPoints,...this.hiddenPoints].find(p=>p.id===pontoId);}obterPorId(id){returnthis.getPontoById(id);}obterPonto(id){returnthis.getPontoById(id);}obterTodos(){returnthis.getPontos();}obterCategoria(categoriaId){returnthis.categorias.find(c=>c.id===categoriaId);}/***Buscarpontosporcategoria*@param{string|number}categoria-IDdacategoriaou'todos'paratodas*@param{string}userRole-Papeldousuário(visitor,user,administrator)*@param{string}username-Nomedousuário(parafiltrospersonalizados)*@returns{Array}ArraydepontosdacategoriaespecificadabuscarPorCategoria(categoria='todos',userRole='visitor',username=null){//Secategoriafor'todos',retornartodosospontosbaseadonopapeldousuárioif(categoria==='todos'){returnthis.getPontosParaUsuario(userRole,username);}//ConvertercategoriaparanúmerosenecessárioconstcategoriaId=typeofcategoria==='string'&&categoria!=='todos'?parseInt(categoria):categoria;//Obterpontosbaseadonopapeldousuárioconstpontos=this.getPontosParaUsuario(userRole,username);//Filtrarporcategoriaespecíficareturnpontos.filter(ponto=>ponto.categoria===categoriaId);}/***Adicionarponto(comportamentobaseadonoperfil)adicionarPonto(dadosPonto,userRole='visitor',username=null){//Validareprocessarimagemsefornecidaif(dadosPonto.imagem){constisValidImage=this.validateImageUrl(dadosPonto.imagem.url,dadosPonto.imagem.source);if(!isValidImage){console.warn('InvalidimageURLprovided,removingimagedata');deletedadosPonto.imagem;}else{//EstruturardadosdaimagemcorretamentedadosPonto.imagem={url:dadosPonto.imagem.url,source:dadosPonto.imagem.source,description:dadosPonto.imagem.description||'',addedAt:newDate().toISOString()};}}constponto={id:this.proximoId++,...dadosPonto,dataAdicao:newDate().toISOString(),adicionadoPor:username||'anonimo'};if(userRole==='administrator'){//Adminadicionadiretamentecomoconfirmadoponto.status='confirmado';ponto.verificado=true;this.confirmedPoints.push(ponto);}else{//Usuáriocomumadicionacomopendenteponto.status='pendente';ponto.verificado=false;this.pendingPoints.push(ponto);//Registrarnoperfildousuárioif(username){constdadosUsuario=this.obterDadosUsuario(username);dadosUsuario.pontosEnviados.push(ponto.id);}}this.saveAllData();returnponto;}/***Aprovarpontopendente(apenasadmin)aprovarPonto(pontoId,userRole='visitor'){if(userRole!=='administrator'){thrownewError('Apenasadministradorespodemaprovarpontos');}constindex=this.pendingPoints.findIndex(p=>p.id===pontoId);if(index===-1){thrownewError('Pontopendentenãoencontrado');}constponto=this.pendingPoints.splice(index,1)[0];ponto.status='confirmado';ponto.verificado=true;ponto.dataAprovacao=newDate().toISOString();this.confirmedPoints.push(ponto);this.saveAllData();returnponto;}/***Ocultarponto(apenasadmin)-moveparapontosocultosocultarPonto(pontoId,userRole='visitor'){if(userRole!=='administrator'){thrownewError('Apenasadministradorespodemocultarpontos');}//Buscaremconfirmadosletindex=this.confirmedPoints.findIndex(p=>p.id===pontoId);letponto=null;if(index!==-1){ponto=this.confirmedPoints.splice(index,1)[0];}else{//Buscarempendentesindex=this.pendingPoints.findIndex(p=>p.id===pontoId);if(index!==-1){ponto=this.pendingPoints.splice(index,1)[0];}}if(!ponto){thrownewError('Pontonãoencontrado');}ponto.status='oculto';ponto.dataOcultacao=newDate().toISOString();this.hiddenPoints.push(ponto);this.saveAllData();returnponto;}/***Restaurarpontooculto(apenasadmin)restaurarPonto(pontoId,userRole='visitor'){if(userRole!=='administrator'){thrownewError('Apenasadministradorespodemrestaurarpontos');}constindex=this.hiddenPoints.findIndex(p=>p.id===pontoId);if(index===-1){thrownewError('Pontoocultonãoencontrado');}constponto=this.hiddenPoints.splice(index,1)[0];ponto.status='confirmado';ponto.verificado=true;ponto.dataRestauracao=newDate().toISOString();this.confirmedPoints.push(ponto);this.saveAllData();returnponto;}/***Adicionar/removerfavorito-FUNCIONALIDADEEMDESENVOLVIMENTO*!TODO:ImplementarsistemacompletodefavoritostoggleFavorito(pontoId,username){console.log('!TODO:ImplementartoggleFavorito-pontoId:',pontoId,'username:',username);returnfalse;//Retornarfalseparanãointerferirnosistema}/***Verificarsepontoéfavorito-FUNCIONALIDADEEMDESENVOLVIMENTO*!TODO:ImplementarsistemacompletodefavoritosisFavorito(pontoId,username){console.log('!TODO:ImplementarisFavorito-pontoId:',pontoId,'username:',username);returnfalse;//Sempreretornarfalseparanãomostrarcomofavorito}/***Obterpontosfavoritosdousuário-FUNCIONALIDADEEMDESENVOLVIMENTO*!TODO:ImplementarsistemacompletodefavoritosgetFavoritos(username){console.log('!TODO:ImplementargetFavoritos-username:',username);return[];//Retornararrayvazio}/***SugerirmudançaempontoexistentesugerirMudanca(pontoId,sugestoes,username){if(!username){thrownewError('Usuáriodeveestarlogadoparasugerirmudanças');}constponto=this.getPontoById(pontoId);if(!ponto){thrownewError('Pontonãoencontrado');}constsugestao={id:Date.now(),pontoId:pontoId,pontoOriginal:{...ponto},sugestoes:sugestoes,usuarioSugeriu:username,dataSugestao:newDate().toISOString(),status:'pendente'};constdadosUsuario=this.obterDadosUsuario(username);dadosUsuario.sugestoesEnviadas.push(sugestao.id);//Armazenarsugestõesemumalistaseparadaif(!this.usuarios._sugestoes){this.usuarios._sugestoes=[];}this.usuarios._sugestoes.push(sugestao);this.saveAllData();returnsugestao;}/***Obtersugestõespendentes(admin)getSugestoesPendentes(){if(!this.usuarios._sugestoes)return[];returnthis.usuarios._sugestoes.filter(s=>s.status==='pendente');}/***Aprovarsugestão(admin)aprovarSugestao(sugestaoId,userRole='visitor'){if(userRole!=='administrator'){thrownewError('Apenasadministradorespodemaprovarsugestões');}if(!this.usuarios._sugestoes)returnnull;constsugestao=this.usuarios._sugestoes.find(s=>s.id===sugestaoId);if(!sugestao){thrownewError('Sugestãonãoencontrada');}//Aplicarmudançasaopontoconstponto=this.getPontoById(sugestao.pontoId);if(ponto){Object.assign(ponto,sugestao.sugestoes);ponto.dataUltimaEdicao=newDate().toISOString();}//Marcarsugestãocomoaprovadasugestao.status='aprovada';sugestao.dataAprovacao=newDate().toISOString();this.saveAllData();returnsugestao;}atualizarPonto(pontoId,novosDados){//Buscaremtodasaslistasletponto=this.confirmedPoints.find(p=>p.id===pontoId);if(!ponto){ponto=this.pendingPoints.find(p=>p.id===pontoId);}if(!ponto){ponto=this.hiddenPoints.find(p=>p.id===pontoId);}if(ponto){Object.assign(ponto,novosDados);ponto.dataUltimaEdicao=newDate().toISOString();this.saveAllData();returnponto;}returnnull;}buscarPontos(termo){consttermoLower=termo.toLowerCase();returnthis.confirmedPoints.filter(ponto=>ponto.nome.toLowerCase().includes(termoLower)||ponto.descricao.toLowerCase().includes(termoLower)||ponto.endereco.toLowerCase().includes(termoLower));}/***Adicionarouatualizarimagemdeumponto*@param{number}pontoId-IDdoponto*@param{Object}imageData-Dadosdaimagem*@param{string}imageData.url-URLoucaminhodaimagem*@param{string}imageData.source-'web'ou'local'*@param{string}imageData.description-Descriçãodaimagem*@returns{boolean}-trueseatualizadocomsucessoupdatePointImage(pontoId,imageData){try{//Validardadosdaimagemif(!imageData.url||!imageData.source){thrownewError('URLesourcesãoobrigatórios');}if(!['web','local'].includes(imageData.source)){thrownewError('Sourcedeveser"web"ou"local"');}//Encontraropontoconstponto=this.getPontoById(pontoId);if(!ponto){thrownewError('Pontonãoencontrado');}//EstruturadaimagemconstimagemStructure={url:imageData.url,source:imageData.source,description:imageData.description||'',updatedAt:newDate().toISOString()};//Atualizaraimagemponto.imagem=imagemStructure;ponto.dataUltimaEdicao=newDate().toISOString();this.saveAllData();console.log(`Imageupdatedforpoint${pontoId}:${imageData.source}-${imageData.url}`);returntrue;}catch(error){console.error('Errorupdatingpointimage:',error);returnfalse;}}/***Removerimagemdeumponto*@param{number}pontoId-IDdoponto*@returns{boolean}-trueseremovidocomsucessoremovePointImage(pontoId){try{constponto=this.getPontoById(pontoId);if(!ponto){thrownewError('Pontonãoencontrado');}deleteponto.imagem;ponto.dataUltimaEdicao=newDate().toISOString();this.saveAllData();console.log(`Imageremovedfrompoint${pontoId}`);returntrue;}catch(error){console.error('Errorremovingpointimage:',error);returnfalse;}}/***Obterinformaçõesdeimagemdeumponto*@param{number}pontoId-IDdoponto*@returns{Object|null}-DadosdaimagemounullsenãohouvergetPointImage(pontoId){constponto=this.getPontoById(pontoId);returnponto?.imagem||null;}/***ValidarURLdeimagem*@param{string}url-URLparavalidar*@param{string}source-Tipodafonte('web'ou'local')*@returns{boolean}-trueseválidavalidateImageUrl(url,source){if(!url||typeofurl!=='string'){returnfalse;}if(source==='web'){//ValidarURLwebtry{consturlObj=newURL(url);return['http:','https:'].includes(urlObj.protocol);}catch{returnfalse;}}elseif(source==='local'){//Validarcaminholocal(relativoouabsoluto)returnurl.startsWith('/')||url.startsWith('./')||url.startsWith('../')||url.match(/^[a-zA-Z]:/)||url.startsWith('assets/');}returnfalse;}filterByCategory(categoria,username=null){if(categoria==='todos'){returnthis.confirmedPoints;}//!TODO:Implementarsistemadefavoritoscompletoif(categoria==='favoritos'&&username){console.log('!TODO:Implementarfiltrodefavoritos');return[];//Retornararrayvaziotemporariamente}returnthis.confirmedPoints.filter(p=>p.categoria===categoria);}getEstatisticas(){consttotalConfirmados=this.confirmedPoints.length;consttotalPendentes=this.pendingPoints.length;consttotalOcultos=this.hiddenPoints.length;constpontosPorCategoria={};//Inicializarcontadoresparatodasascategoriasthis.categorias.forEach(cat=>{pontosPorCategoria[cat.id]=0;});//Contarpontosconfirmadosporcategoriathis.confirmedPoints.forEach(ponto=>{if(pontosPorCategoria.hasOwnProperty(ponto.categoria)){pontosPorCategoria[ponto.categoria]++;}});return{totalPontos:totalConfirmados,totalConfirmados,totalPendentes,totalOcultos,pontosPorCategoria,pontosVerificados:totalConfirmados,pontosNaoVerificados:totalPendentes,totalUsuarios:Object.keys(this.usuarios).filter(k=>!k.startsWith('_')).length,totalSugestoes:this.usuarios._sugestoes?this.usuarios._sugestoes.length:0};}asynccarregarDados(){//Métodoparacompatibilidadecomapp.jsreturnPromise.resolve();}/***ExportardadosparabackupexportarDados(){return{confirmedPoints:this.confirmedPoints,pendingPoints:this.pendingPoints,hiddenPoints:this.hiddenPoints,usuarios:this.usuarios,categorias:this.categorias,dataExport:newDate().toISOString(),versao:'2.0'};}/***ImportardadosdebackupimportarDados(dados,userRole='visitor'){if(userRole!=='administrator'){thrownewError('Apenasadministradorespodemimportardados');}if(dados.versao&&(dados.confirmedPoints||dados.pontosConfirmados)){this.confirmedPoints=dados.confirmedPoints||dados.pontosConfirmados||[];this.pendingPoints=dados.pendingPoints||dados.pontosPendentes||[];this.hiddenPoints=dados.hiddenPoints||dados.pontosOcultos||[];this.usuarios=dados.usuarios||{};this.categorias=dados.categorias||this.categorias;//RecalcularpróximoIDconsttodosOsPontos=[...this.confirmedPoints,...this.pendingPoints,...this.hiddenPoints];this.proximoId=todosOsPontos.length>0?Math.max(...todosOsPontos.map(p=>p.id||0))+1:1;this.saveAllData();return{success:true,message:'Dadosimportadoscomsucesso'};}thrownewError('Formatodedadosinválido');}/***SalvardadosnolocalStorage(métododecompatibilidade)salvarNoLocalStorage(){this.saveAllData();}/***Deletarpontodefinitivamente*@param{number}pontoId-IDdopontoaserdeletado*@param{string}userRole-Papeldousuário*@returns{boolean}TruesedeletadocomsucessodeletarPonto(pontoId,userRole='visitor'){if(userRole!=='administrator'){thrownewError('Apenasadministradorespodemdeletarpontos');}letdeletado=false;constid=parseInt(pontoId);//Tentardeletardetodasaslistasletindex=this.confirmedPoints.findIndex(p=>p.id===id);if(index!==-1){this.confirmedPoints.splice(index,1);deletado=true;}index=this.pendingPoints.findIndex(p=>p.id===id);if(index!==-1){this.pendingPoints.splice(index,1);deletado=true;}index=this.hiddenPoints.findIndex(p=>p.id===id);if(index!==-1){this.hiddenPoints.splice(index,1);deletado=true;}if(deletado){this.saveAllData();console.log(`Ponto${pontoId}deletadodefinitivamente`);}returndeletado;}/***Removerponto(aliasparadeletarPontoparacompatibilidade)*@param{number}pontoId-IDdopontoaserremovido*@param{string}userRole-Papeldousuário*@returns{boolean}TrueseremovidocomsucessoremoverPonto(pontoId,userRole='visitor'){returnthis.deletarPonto(pontoId,userRole);}/***Buscarpontosporproximidadegeográfica*@param{number}lat-Latitudedocentro*@param{number}lng-Longitudedocentro*@param{number}raio-Raioemquilômetros*@param{string}userRole-Papeldousuário*@param{string}username-Nomedousuário*@returns{Array}ArraydepontosdentrodoraioespecificadobuscarPorProximidade(lat,lng,raio=1,userRole='visitor',username=null){constpontos=this.getPontosParaUsuario(userRole,username);returnpontos.filter(ponto=>{if(!ponto.coordenadas||ponto.coordenadas.length!==2){returnfalse;}const[pontoLat,pontoLng]=ponto.coordenadas;constdistancia=this.calcularDistancia(lat,lng,pontoLat,pontoLng);returndistancia<=raio;}).sort((a,b)=>{//OrdenarpordistânciaconstdistA=this.calcularDistancia(lat,lng,a.coordenadas[0],a.coordenadas[1]);constdistB=this.calcularDistancia(lat,lng,b.coordenadas[0],b.coordenadas[1]);returndistA-distB;});}/***CalculardistânciaentreduascoordenadasusandofórmuladeHaversine*@param{number}lat1-Latitudedoprimeiroponto*@param{number}lng1-Longitudedoprimeiroponto*@param{number}lat2-Latitudedosegundoponto*@param{number}lng2-Longitudedosegundoponto*@returns{number}DistânciaemquilômetroscalcularDistancia(lat1,lng1,lat2,lng2){constR=6371;//RaiodaTerraemkmconstdLat=this.degreesToRadians(lat2-lat1);constdLng=this.degreesToRadians(lng2-lng1);consta=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(this.degreesToRadians(lat1))*Math.cos(this.degreesToRadians(lat2))*Math.sin(dLng/2)*Math.sin(dLng/2);constc=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));returnR*c;}/***Convertergrauspararadianos*@param{number}degrees-Ânguloemgraus*@returns{number}ÂnguloemradianosdegreesToRadians(degrees){returndegrees*(Math.PI/180);}/***Dadospadrãodecategoriasparafallbackquandofile://nãopodecarregarJSONgetCategoriesDefault(){return[{"id":"geral","nome":"Geral","icon":"fasfa-theater-masks","cor":"#6c757d","descricao":"Pontosdeinteressegeralediversos"},{"id":"esportes-lazer","nome":"Esportes","icon":"fasfa-running","cor":"#28a745","descricao":"Atividadesesportivasedelazer"},{"id":"gastronomia","nome":"Gastronomia","icon":"fasfa-utensils","cor":"#dc3545","descricao":"Restaurantes,bareseexperiênciasculinárias"},{"id":"geek-nerd","nome":"Geek","icon":"fasfa-gamepad","cor":"#6f42c1","descricao":"Culturageek,gamesetecnologia"},{"id":"casas-noturnas","nome":"CasasNoturnas","icon":"fasfa-glass-cheers","cor":"#6610f2","descricao":"Vidanoturna,baresecasasdeshow"}];}/***DadospadrãodepontosconfirmadosparafallbackgetConfirmedPointsDefault(){return[{"id":1,"nome":"TeatroNacionalClaudioSantoro","categoria":"geral","coordenadas":[-15.796,-47.878],"descricao":"PrincipalteatrodeBrasília,comprogramaçãodiversificada","endereco":"ViaN2-AsaNorte","telefone":"(61)3325-6268","horario":"Conformeprogramação","preco":"R$20-80","avaliacao":4.6,"tags":["teatro","cultura","espetaculos"],"ativo":true,"dataCriacao":"2025-01-20T10:00:00.000Z","imagem":{"url":"https://images.unsplash.com/photo-1507924538820-ede94a04019d?w=400","source":"web","description":"TeatroNacionaldeBrasília"}},{"id":2,"nome":"MuseuNacionaldaRepública","categoria":"geral","coordenadas":[-15.798,-47.875],"descricao":"Espaçoculturalcomexposiçõesdearteehistória","endereco":"ViaN1-AsaNorte","telefone":"(61)3325-5220","horario":"Ter-Dom:9h-18h","preco":"R$5-15","avaliacao":4.3,"tags":["museu","arte","cultura"],"ativo":true,"dataCriacao":"2025-01-20T10:15:00.000Z","imagem":{"url":"https://images.unsplash.com/photo-1554072675-66db59dba46f?w=400","source":"web","description":"MuseuNacionaldaRepública"}},{"id":3,"nome":"ParquedaCidadeSarahKubitschek","categoria":"esportes-lazer","coordenadas":[-15.798,-47.896],"descricao":"MaiorparqueurbanodaAméricaLatina,idealparaatividadesfísicas","endereco":"AsaSul","telefone":"(61)3224-5717","horario":"24h","preco":"Gratuito","avaliacao":4.8,"tags":["parque","exercicios","natureza"],"ativo":true,"dataCriacao":"2025-01-20T10:30:00.000Z","imagem":{"url":"https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=400","source":"web","description":"ParquedaCidade"}}];}/***DadospadrãodeusuáriosparafallbackgetUsersDefault(){return[{"id":1,"username":"admin","password":"admin123","role":"administrator","email":"admin@sigdf.gov.br","nome":"AdministradordoSistema","dataCriacao":"2025-01-20T08:00:00.000Z","ativo":true}];}}//CriarinstânciaglobalconstdatabaseManager=newDatabaseManager();//Exportarparausoemmódulosif(typeofmodule!=='undefined'&&module.exports){module.exports=DatabaseManager;}//Disponibilizarglobalmentewindow.DatabaseManager=DatabaseManager;window.databaseManager=databaseManager;

```javascript
/***DatabaseManager-SistemadeBancodeDadoscomControledeAcesso**@authorTalesOliveira(github.com/TalesLimaOliveira)*@version1.0.0*@noteEstearquivocontémtrechosdecódigogeradoscomauxíliodeInteligênciaArtificial.*/classDatabaseManager{constructor(){this.confirmedPoints=[];this.pendingPoints=[];this.hiddenPoints=[];this.usuarios={};this.categorias=[];this.proximoId=1;this.baseStorageKey='pontosEntretenimento';this.databasePath='database/';//init()seráchamadoexplicitamentepeloapp.js}asyncinit(){try{console.log('InitializingDatabaseManagerwithnewstructure...');console.log(`Currentprotocol:${window.location.protocol}`);awaitthis.loadCategories();console.log('Categoriesloaded');awaitthis.loadAllData();console.log('Maindataloaded');this.migrateOldData();console.log('Datamigrationcompleted');this.migrateAlternativeCategory();console.log('Alternativecategorymigrationcompleted');//Verificaçãofinal-garantirquehádadosif(this.confirmedPoints.length===0){console.warn('Noconfirmedpointsafterloading,forcingdefaultdata...');this.confirmedPoints=this.getConfirmedPointsDefault();this.saveAllData();}if(this.categorias.length===0){console.warn('Nocategoriesafterloading,forcingdefaultcategories...');this.categorias=this.getCategoriesDefault();this.saveCategories();}console.log(`Finalstate:${this.confirmedPoints.length}confirmedpoints,${this.categorias.length}categories`);console.log('DatabaseManagersuccessfullyinitialized');}catch(error){console.error('ErrorinitializingDatabaseManager:',error);this.initializeDefaultData();}}/***LoadalldatafromJSONfiles*/asyncloadAllData(){try{console.log('IniciandocarregamentodedadosdosarquivosJSON...');//Primeiro,tentarcarregardosarquivosJSON(prioridade)letdadosCarregadosJSON=false;try{console.log('AttemptingtoloaddatafromJSONfiles...');//CarregarpontosconfirmadosconstpontosConfirmados=awaitthis.loadJsonFile('./database/pontos_confirmados.json');if(pontosConfirmados&&Array.isArray(pontosConfirmados)&&pontosConfirmados.length>0){this.confirmedPoints=pontosConfirmados;dadosCarregadosJSON=true;console.log(`${pontosConfirmados.length}pontosconfirmadoscarregadosdoJSON`);}//CarregarpontospendentesconstpontosPendentes=awaitthis.loadJsonFile('./database/pontos_pendentes.json');if(pontosPendentes&&Array.isArray(pontosPendentes)){this.pendingPoints=pontosPendentes;console.log(`${pontosPendentes.length}pontospendentescarregadosdoJSON`);}//CarregarpontosocultosconstpontosOcultos=awaitthis.loadJsonFile('./database/pontos_ocultos.json');if(pontosOcultos&&Array.isArray(pontosOcultos)){this.hiddenPoints=pontosOcultos;console.log(`${pontosOcultos.length}pontosocultoscarregadosdoJSON`);}//Carregarusuáriosconstusuarios=awaitthis.loadJsonFile('./database/usuarios.json');if(usuarios&&Array.isArray(usuarios)){this.usuarios=usuarios.reduce((acc,user)=>{acc[user.username]=user;returnacc;},{});console.log(`${usuarios.length}usuárioscarregadosdoJSON`);}}catch(error){console.warn('ErrorloadingfromJSONfiles:',error);}//Ifcouldn'tloadfromJSON,trylocalStorageif(!dadosCarregadosJSON){console.log('AttemptingtoloadfromlocalStorage...');constconfirmedPoints=localStorage.getItem(this.baseStorageKey+'_pontosConfirmados');constpendingPoints=localStorage.getItem(this.baseStorageKey+'_pontosPendentes');consthiddenPoints=localStorage.getItem(this.baseStorageKey+'_pontosOcultos');constusuarios=localStorage.getItem(this.baseStorageKey+'_usuarios');if(confirmedPoints){this.confirmedPoints=JSON.parse(confirmedPoints);console.log(`${this.confirmedPoints.length}pontosconfirmadoscarregadosdolocalStorage`);dadosCarregadosJSON=true;}if(pendingPoints){this.pendingPoints=JSON.parse(pendingPoints);}if(hiddenPoints){this.hiddenPoints=JSON.parse(hiddenPoints);}if(usuarios){this.usuarios=JSON.parse(usuarios);}}//Seaindanãohápontos,usardadospadrãoif(!dadosCarregadosJSON||this.confirmedPoints.length===0){console.log('Carregandodadospadrão...');this.inicializarPontosDefault();}//SalvardadoscarregadosnolocalStorageparacacheif(this.confirmedPoints.length>0){this.saveAllData();console.log('DatasavedtolocalStorageforcaching');}//CalcularpróximoIDconsttodosOsPontos=[...this.confirmedPoints,...this.pendingPoints,...this.hiddenPoints];this.proximoId=todosOsPontos.length>0?Math.max(...todosOsPontos.map(p=>p.id||0))+1:1;console.log(`Totalfinal:${this.confirmedPoints.length}confirmados,${this.pendingPoints.length}pendentes,${this.hiddenPoints.length}ocultos`);}catch(error){console.error('Criticalerrorloadingdata:',error);this.initializeDefaultData();}}/***FunçãoauxiliarparacarregararquivosJSONcompatívelcomfile://ehttp://*@param{string}url-URLdoarquivoJSON*@returns{Promise<Object>}-DadosJSONcarregados*/asyncloadJsonFile(url){//Detectarseestamosusandoprotocolofile://constisFileProtocol=window.location.protocol==='file:';console.log(`Loading:${url}(Protocol:${window.location.protocol})`);if(isFileProtocol){//Forfile://protocol,usedefaultembeddeddataconsole.log(`File://protocoldetected,usingdefaultdatafor:${url}`);//RetornardadospadrãobaseadonaURLif(url.includes('categorias.json')){returnthis.getCategoriesDefault();}elseif(url.includes('pontos_confirmados.json')){returnthis.getConfirmedPointsDefault();}elseif(url.includes('pontos_pendentes.json')){return[];}elseif(url.includes('pontos_ocultos.json')){return[];}elseif(url.includes('usuarios.json')){returnthis.getUsersDefault();}return[];}else{//ParaprotocoloHTTP/HTTPS,usarfetchnormalconsole.log(`🌍ProtocoloHTTPdetectado,carregandoviafetch:${url}`);try{constresponse=awaitfetch(url,{method:'GET',headers:{'Content-Type':'application/json','Cache-Control':'no-cache'}});if(!response.ok){thrownewError(`HTTPerror!status:${response.status}-${response.statusText}`);}constdata=awaitresponse.json();console.log(`Dadoscarregadoscomsucessode${url}:`,data.length||Object.keys(data).length,'itens');returndata;}catch(error){console.error(`Erroaocarregar${url}:`,error);throwerror;}}}/***Carregadadosdoarquivodb.jsonprincipal(versãoassíncrona)*/asynccarregarDoPrincipalDbAsync(){try{constdata=awaitthis.loadJsonFile('./db.json');if(data.pontos&&Array.isArray(data.pontos)){//Converterpontosdodb.jsonparaformatoesperadoconstpontosConvertidos=data.pontos.filter(ponto=>ponto.ativo!==false).map(ponto=>({id:ponto.id,nome:ponto.nome,descricao:ponto.descricao,categoria:ponto.categoria,coordenadas:ponto.coordenadas,endereco:ponto.endereco,telefone:ponto.telefone,website:ponto.website,horario:ponto.horario,preco:ponto.preco,nota:ponto.avaliacao||ponto.nota||0,verificado:true,status:'confirmado',dataAdicao:ponto.dataCriacao||newDate().toISOString()}));this.confirmedPoints=pontosConvertidos;this.saveAllData();console.log(`${pontosConvertidos.length}pontoscarregadosdodb.json`);}}catch(error){console.error('Erroaocarregardb.json:',error);//Nãolançarerro,deixarquesejausadoofallback}}/***Migrateolddatatonewstructure*/migrateOldData(){constoldPoints=localStorage.getItem(this.baseStorageKey+'_pontos');if(oldPoints&&this.confirmedPoints.length===0){console.log('Migratingolddata...');constpontos=JSON.parse(oldPoints);pontos.forEach(ponto=>{//Pontosverificadosvãoparaconfirmados,nãoverificadosparapendentesif(ponto.verificado){this.confirmedPoints.push({...ponto,status:'confirmado'});}else{this.pendingPoints.push({...ponto,status:'pendente'});}});this.saveAllData();console.log('Migracaoconcluida');}}/***Migratepointsfrom"alternative"categoryto"general"*/migrateAlternativeCategory(){letchanges=0;//Migrarpontosconfirmadosthis.confirmedPoints.forEach(ponto=>{if(ponto.categoria==='alternativo'){ponto.categoria='geral';changes++;}});//Migrarpontospendentesthis.pendingPoints.forEach(ponto=>{if(ponto.categoria==='alternativo'){ponto.categoria='geral';changes++;}});//Migrarpontosocultosthis.hiddenPoints.forEach(ponto=>{if(ponto.categoria==='alternativo'){ponto.categoria='geral';changes++;}});if(changes>0){this.saveAllData();console.log(`${changes}pointsmigratedfrom'alternativo'to'geral'category`);}//Removercategoria"alternativo"dascategoriassalvasthis.categorias=this.categorias.filter(cat=>cat.id!=='alternativo');this.saveCategories();}asyncloadCategories(){try{//Tentarcarregarusandoafunçãocompatívelconstcategorias=awaitthis.loadJsonFile('./database/categorias.json');this.categorias=categorias;console.log('Categoriascarregadas:',categorias.length);//Disparareventoparaatualizarmarcadoresdocument.dispatchEvent(newCustomEvent('database_categoriasCarregadas',{detail:{categorias:this.categorias}}));return;}catch(error){console.warn('Erroaocarregarcategorias:',error);}//Fallback:tentarcarregardolocalStorageconstsaved=localStorage.getItem(this.baseStorageKey+'_categorias');if(saved){this.categorias=JSON.parse(saved);console.log('CategoriascarregadasdolocalStorage');//Disparareventoparaatualizarmarcadoresdocument.dispatchEvent(newCustomEvent('database_categoriasCarregadas',{detail:{categorias:this.categorias}}));}else{//Fallbackfinal:categoriaspadrãothis.categorias=[{id:'geral',nome:'Geral',icon:'fasfa-theater-masks',cor:'#8b5cf6',descricao:'Teatros,cinemas,centrosculturais,casasdeshow,eventospúblicos'},{id:'esportes-lazer',nome:'EsporteseLazer',icon:'fasfa-running',cor:'#10b981',descricao:'Estádios,quadraspúblicas,academiasaoarlivre,pistasdeskate,parquesecológicos'},{id:'gastronomia',nome:'Gastronomia',icon:'fasfa-utensils',cor:'#2563eb',descricao:'Bares,restaurantes,feirasgastronômicas,cafeterias,foodtrucks'},{id:'geek-nerd',nome:'GeekeNerd',icon:'fasfa-gamepad',cor:'#7c3aed',descricao:'Lojasdeboardgames,cardgames,actionfigures,eventosdeculturapop,espaçosdee-sports'},{id:'casas-noturnas',nome:'CasasNoturnas',icon:'fasfa-glass-cheers',cor:'#f59e0b',descricao:'Boates,pubs,lounges,baladastemáticaseoutrosespaçosvoltadosàvidanoturna'}//!TODO:Implementarsistemadefavoritoscompleto//{//id:'favoritos',//nome:'Favoritos',//icon:'fasfa-heart',//cor:'#ec4899',//descricao:'Pontosmarcadoscomofavoritospelousuário'//}];this.saveCategories();console.log('Categoriaspadrãocarregadas');//Disparareventoparaatualizarmarcadoresdocument.dispatchEvent(newCustomEvent('database_categoriasCarregadas',{detail:{categorias:this.categorias}}));}}/***Salvatodososdados*/saveAllData(){localStorage.setItem(this.baseStorageKey+'_pontosConfirmados',JSON.stringify(this.confirmedPoints));localStorage.setItem(this.baseStorageKey+'_pontosPendentes',JSON.stringify(this.pendingPoints));localStorage.setItem(this.baseStorageKey+'_pontosOcultos',JSON.stringify(this.hiddenPoints));localStorage.setItem(this.baseStorageKey+'_usuarios',JSON.stringify(this.usuarios));}saveCategories(){localStorage.setItem(this.baseStorageKey+'_categorias',JSON.stringify(this.categorias));}/***Obtémdadosdousuáriooucriasenãoexistir*/obterDadosUsuario(username){if(!this.usuarios[username]){this.usuarios[username]={username:username,favoritos:[],pontosEnviados:[],sugestoesEnviadas:[],dataCriacao:newDate().toISOString()};this.saveAllData();}returnthis.usuarios[username];}/***Inicializardadospadrãoquandonãohádadossalvos*/initializeDefaultData(){console.log('Inicializandodadospadrão...');this.inicializarPontosDefault();this.loadCategories();//Garantirquecategoriasestejamcarregadasconsole.log('Dadospadraoinicializados');}inicializarPontosDefault(){constpontosDefault=[{id:1,nome:'TeatroNacionalClaudioSantoro',descricao:'PrincipalteatrodeBrasília,comprogramaçãodiversificada',categoria:'geral',coordenadas:[-15.796,-47.878],endereco:'ViaN2-AsaNorte,Brasília',telefone:'(61)3325-6268',horario:'Conformeprogramação',preco:'R$20-80',nota:4.6,verificado:true,status:'confirmado',dataAdicao:newDate().toISOString(),imagem:{url:'https://images.unsplash.com/photo-1507924538820-ede94a04019d?w=400',source:'web',description:'TeatroNacionaldeBrasília'}},{id:2,nome:'CineBrasília',descricao:'Cinemadearteecultura,comfilmesalternativos',categoria:'geral',coordenadas:[-15.795,-47.882],endereco:'EQS106/107-AsaSul,Brasília',telefone:'(61)3244-1660',horario:'14hàs22h',preco:'R$10-15',nota:4.4,verificado:true,status:'confirmado',dataAdicao:newDate().toISOString(),imagem:{url:'https://images.unsplash.com/photo-1489599433510-0fcf9d9c4e2d?w=400',source:'web',description:'CinemaBrasília'}},{id:3,nome:'EstádioNacionaldeBrasília',descricao:'Arenamultiusoparagrandeseventosesportivos',categoria:'esportes-lazer',coordenadas:[-15.783,-47.899],endereco:'SRPN-AsaNorte,Brasília',telefone:'(61)3424-4000',horario:'Conformeeventos',preco:'Variável',nota:4.5,verificado:true,status:'confirmado',dataAdicao:newDate().toISOString(),imagem:{url:'/assets/images/estadio-nacional.jpg',source:'local',description:'EstádioNacionaldeBrasília-ManéGarrincha'}},{id:4,nome:'ParquedaCidadeSarahKubitschek',descricao:'Maiorparqueurbanodomundo,idealparaesporteselazer',categoria:'esportes-lazer',coordenadas:[-15.788,-47.907],endereco:'AsaSul,Brasília',horario:'24horas',preco:'Gratuito',nota:4.7,verificado:true,status:'confirmado',dataAdicao:newDate().toISOString()},{id:5,nome:'RestauranteOlivae',descricao:'Restauranteitalianosofisticadocomambienteacolhedor',categoria:'gastronomia',coordenadas:[-15.795,-48.105],endereco:'CLN201-AsaNorte,Brasília',telefone:'(61)3340-8120',horario:'12hàs15h,19hàs23h',preco:'R$80-120',nota:4.5,verificado:true,status:'confirmado',dataAdicao:newDate().toISOString()},{id:6,nome:'FeiradaTorredeTV',descricao:'Feiragastronômicatradicionalaosfinsdesemana',categoria:'gastronomia',coordenadas:[-15.790,-47.896],endereco:'TorredeTV,AsaNorte,Brasília',horario:'Sábadosedomingos,9hàs18h',preco:'R$15-40',nota:4.2,verificado:true,status:'confirmado',dataAdicao:newDate().toISOString()},{id:7,nome:'Dragonstore',descricao:'Lojaespecializadaemjogos,cardseculturageek',categoria:'geek-nerd',coordenadas:[-15.794,-47.889],endereco:'CLN208-AsaNorte,Brasília',telefone:'(61)3328-1234',horario:'10hàs22h',preco:'R$20-200',nota:4.6,verificado:true,status:'confirmado',dataAdicao:newDate().toISOString()},{id:8,nome:'ArenaE-SportsBSB',descricao:'Centrodee-sportscomtorneiosecompetições',categoria:'geek-nerd',coordenadas:[-15.835,-48.044],endereco:'TaguatingaCentro,Brasília',telefone:'(61)3562-9876',horario:'14hàs23h',preco:'R$10-30/hora',nota:4.3,verificado:true,status:'confirmado',dataAdicao:newDate().toISOString()},{id:9,nome:'CentroCulturaldaRepública',descricao:'Espaçoculturalindependentecomexposiçõesalternativas',categoria:'geral',coordenadas:[-15.797,-47.879],endereco:'EixoMonumental,Brasília',horario:'9hàs18h',preco:'Gratuito',nota:4.4,verificado:true,status:'confirmado',dataAdicao:newDate().toISOString()},{id:10,nome:'SaraudoBeco',descricao:'Sarauindependentecompoesiaemúsica',categoria:'geral',coordenadas:[-15.840,-48.045],endereco:'TaguatingaNorte,Brasília',horario:'Quintas,19hàs23h',preco:'R$5-15',nota:4.1,verificado:true,status:'confirmado',dataAdicao:newDate().toISOString()},{id:11,nome:'VillaMixBrasília',descricao:'Casanoturnacommúsicasertanejaeeletrônica',categoria:'casas-noturnas',coordenadas:[-15.796,-47.885],endereco:'SCLS109-AsaSul,Brasília',telefone:'(61)3244-1010',horario:'22hàs4h',preco:'R$40-80',nota:4.2,verificado:true,status:'confirmado',dataAdicao:newDate().toISOString()},{id:12,nome:'Lounge442',descricao:'Loungesofisticadocomdrinksautorais',categoria:'casas-noturnas',coordenadas:[-15.794,-47.886],endereco:'CLN442-AsaNorte,Brasília',telefone:'(61)3328-4422',horario:'19hàs2h',preco:'R$30-60',nota:4.0,verificado:true,status:'confirmado',dataAdicao:newDate().toISOString()}];this.confirmedPoints=pontosDefault;this.proximoId=13;this.saveAllData();console.log(`${pontosDefault.length}pontospadraocarregados`);}//APIpública-Métodosprincipais/***Retornapontosvisíveis(confirmados)*/getPontos(){returnthis.confirmedPoints;}/***Retornapontosbaseadonoperfildousuário*/getPontosParaUsuario(userRole='visitor',username=null){if(userRole==='administrator'){return[...this.confirmedPoints,...this.pendingPoints];}returnthis.confirmedPoints;}/***Retornapontospendentes(apenasparaadmin)*/getPontosPendentes(){returnthis.pendingPoints;}/***Retornapontosocultos(apenasparaadmin)*/getPontosOcultos(){returnthis.hiddenPoints;}getCategorias(){returnthis.categorias;}getPontoById(id){constpontoId=parseInt(id);return[...this.confirmedPoints,...this.pendingPoints,...this.hiddenPoints].find(p=>p.id===pontoId);}obterPorId(id){returnthis.getPontoById(id);}obterPonto(id){returnthis.getPontoById(id);}obterTodos(){returnthis.getPontos();}obterCategoria(categoriaId){returnthis.categorias.find(c=>c.id===categoriaId);}/***Buscarpontosporcategoria*@param{string|number}categoria-IDdacategoriaou'todos'paratodas*@param{string}userRole-Papeldousuário(visitor,user,administrator)*@param{string}username-Nomedousuário(parafiltrospersonalizados)*@returns{Array}Arraydepontosdacategoriaespecificada*/buscarPorCategoria(categoria='todos',userRole='visitor',username=null){//Secategoriafor'todos',retornartodosospontosbaseadonopapeldousuárioif(categoria==='todos'){returnthis.getPontosParaUsuario(userRole,username);}//ConvertercategoriaparanúmerosenecessárioconstcategoriaId=typeofcategoria==='string'&&categoria!=='todos'?parseInt(categoria):categoria;//Obterpontosbaseadonopapeldousuárioconstpontos=this.getPontosParaUsuario(userRole,username);//Filtrarporcategoriaespecíficareturnpontos.filter(ponto=>ponto.categoria===categoriaId);}/***Adicionarponto(comportamentobaseadonoperfil)*/adicionarPonto(dadosPonto,userRole='visitor',username=null){//Validareprocessarimagemsefornecidaif(dadosPonto.imagem){constisValidImage=this.validateImageUrl(dadosPonto.imagem.url,dadosPonto.imagem.source);if(!isValidImage){console.warn('InvalidimageURLprovided,removingimagedata');deletedadosPonto.imagem;}else{//EstruturardadosdaimagemcorretamentedadosPonto.imagem={url:dadosPonto.imagem.url,source:dadosPonto.imagem.source,description:dadosPonto.imagem.description||'',addedAt:newDate().toISOString()};}}constponto={id:this.proximoId++,...dadosPonto,dataAdicao:newDate().toISOString(),adicionadoPor:username||'anonimo'};if(userRole==='administrator'){//Adminadicionadiretamentecomoconfirmadoponto.status='confirmado';ponto.verificado=true;this.confirmedPoints.push(ponto);}else{//Usuáriocomumadicionacomopendenteponto.status='pendente';ponto.verificado=false;this.pendingPoints.push(ponto);//Registrarnoperfildousuárioif(username){constdadosUsuario=this.obterDadosUsuario(username);dadosUsuario.pontosEnviados.push(ponto.id);}}this.saveAllData();returnponto;}/***Aprovarpontopendente(apenasadmin)*/aprovarPonto(pontoId,userRole='visitor'){if(userRole!=='administrator'){thrownewError('Apenasadministradorespodemaprovarpontos');}constindex=this.pendingPoints.findIndex(p=>p.id===pontoId);if(index===-1){thrownewError('Pontopendentenãoencontrado');}constponto=this.pendingPoints.splice(index,1)[0];ponto.status='confirmado';ponto.verificado=true;ponto.dataAprovacao=newDate().toISOString();this.confirmedPoints.push(ponto);this.saveAllData();returnponto;}/***Ocultarponto(apenasadmin)-moveparapontosocultos*/ocultarPonto(pontoId,userRole='visitor'){if(userRole!=='administrator'){thrownewError('Apenasadministradorespodemocultarpontos');}//Buscaremconfirmadosletindex=this.confirmedPoints.findIndex(p=>p.id===pontoId);letponto=null;if(index!==-1){ponto=this.confirmedPoints.splice(index,1)[0];}else{//Buscarempendentesindex=this.pendingPoints.findIndex(p=>p.id===pontoId);if(index!==-1){ponto=this.pendingPoints.splice(index,1)[0];}}if(!ponto){thrownewError('Pontonãoencontrado');}ponto.status='oculto';ponto.dataOcultacao=newDate().toISOString();this.hiddenPoints.push(ponto);this.saveAllData();returnponto;}/***Restaurarpontooculto(apenasadmin)*/restaurarPonto(pontoId,userRole='visitor'){if(userRole!=='administrator'){thrownewError('Apenasadministradorespodemrestaurarpontos');}constindex=this.hiddenPoints.findIndex(p=>p.id===pontoId);if(index===-1){thrownewError('Pontoocultonãoencontrado');}constponto=this.hiddenPoints.splice(index,1)[0];ponto.status='confirmado';ponto.verificado=true;ponto.dataRestauracao=newDate().toISOString();this.confirmedPoints.push(ponto);this.saveAllData();returnponto;}/***Adicionar/removerfavorito-FUNCIONALIDADEEMDESENVOLVIMENTO*!TODO:Implementarsistemacompletodefavoritos*/toggleFavorito(pontoId,username){console.log('!TODO:ImplementartoggleFavorito-pontoId:',pontoId,'username:',username);returnfalse;//Retornarfalseparanãointerferirnosistema}/***Verificarsepontoéfavorito-FUNCIONALIDADEEMDESENVOLVIMENTO*!TODO:Implementarsistemacompletodefavoritos*/isFavorito(pontoId,username){console.log('!TODO:ImplementarisFavorito-pontoId:',pontoId,'username:',username);returnfalse;//Sempreretornarfalseparanãomostrarcomofavorito}/***Obterpontosfavoritosdousuário-FUNCIONALIDADEEMDESENVOLVIMENTO*!TODO:Implementarsistemacompletodefavoritos*/getFavoritos(username){console.log('!TODO:ImplementargetFavoritos-username:',username);return[];//Retornararrayvazio}/***Sugerirmudançaempontoexistente*/sugerirMudanca(pontoId,sugestoes,username){if(!username){thrownewError('Usuáriodeveestarlogadoparasugerirmudanças');}constponto=this.getPontoById(pontoId);if(!ponto){thrownewError('Pontonãoencontrado');}constsugestao={id:Date.now(),pontoId:pontoId,pontoOriginal:{...ponto},sugestoes:sugestoes,usuarioSugeriu:username,dataSugestao:newDate().toISOString(),status:'pendente'};constdadosUsuario=this.obterDadosUsuario(username);dadosUsuario.sugestoesEnviadas.push(sugestao.id);//Armazenarsugestõesemumalistaseparadaif(!this.usuarios._sugestoes){this.usuarios._sugestoes=[];}this.usuarios._sugestoes.push(sugestao);this.saveAllData();returnsugestao;}/***Obtersugestõespendentes(admin)*/getSugestoesPendentes(){if(!this.usuarios._sugestoes)return[];returnthis.usuarios._sugestoes.filter(s=>s.status==='pendente');}/***Aprovarsugestão(admin)*/aprovarSugestao(sugestaoId,userRole='visitor'){if(userRole!=='administrator'){thrownewError('Apenasadministradorespodemaprovarsugestões');}if(!this.usuarios._sugestoes)returnnull;constsugestao=this.usuarios._sugestoes.find(s=>s.id===sugestaoId);if(!sugestao){thrownewError('Sugestãonãoencontrada');}//Aplicarmudançasaopontoconstponto=this.getPontoById(sugestao.pontoId);if(ponto){Object.assign(ponto,sugestao.sugestoes);ponto.dataUltimaEdicao=newDate().toISOString();}//Marcarsugestãocomoaprovadasugestao.status='aprovada';sugestao.dataAprovacao=newDate().toISOString();this.saveAllData();returnsugestao;}atualizarPonto(pontoId,novosDados){//Buscaremtodasaslistasletponto=this.confirmedPoints.find(p=>p.id===pontoId);if(!ponto){ponto=this.pendingPoints.find(p=>p.id===pontoId);}if(!ponto){ponto=this.hiddenPoints.find(p=>p.id===pontoId);}if(ponto){Object.assign(ponto,novosDados);ponto.dataUltimaEdicao=newDate().toISOString();this.saveAllData();returnponto;}returnnull;}buscarPontos(termo){consttermoLower=termo.toLowerCase();returnthis.confirmedPoints.filter(ponto=>ponto.nome.toLowerCase().includes(termoLower)||ponto.descricao.toLowerCase().includes(termoLower)||ponto.endereco.toLowerCase().includes(termoLower));}/***Adicionarouatualizarimagemdeumponto*@param{number}pontoId-IDdoponto*@param{Object}imageData-Dadosdaimagem*@param{string}imageData.url-URLoucaminhodaimagem*@param{string}imageData.source-'web'ou'local'*@param{string}imageData.description-Descriçãodaimagem*@returns{boolean}-trueseatualizadocomsucesso*/updatePointImage(pontoId,imageData){try{//Validardadosdaimagemif(!imageData.url||!imageData.source){thrownewError('URLesourcesãoobrigatórios');}if(!['web','local'].includes(imageData.source)){thrownewError('Sourcedeveser"web"ou"local"');}//Encontraropontoconstponto=this.getPontoById(pontoId);if(!ponto){thrownewError('Pontonãoencontrado');}//EstruturadaimagemconstimagemStructure={url:imageData.url,source:imageData.source,description:imageData.description||'',updatedAt:newDate().toISOString()};//Atualizaraimagemponto.imagem=imagemStructure;ponto.dataUltimaEdicao=newDate().toISOString();this.saveAllData();console.log(`Imageupdatedforpoint${pontoId}:${imageData.source}-${imageData.url}`);returntrue;}catch(error){console.error('Errorupdatingpointimage:',error);returnfalse;}}/***Removerimagemdeumponto*@param{number}pontoId-IDdoponto*@returns{boolean}-trueseremovidocomsucesso*/removePointImage(pontoId){try{constponto=this.getPontoById(pontoId);if(!ponto){thrownewError('Pontonãoencontrado');}deleteponto.imagem;ponto.dataUltimaEdicao=newDate().toISOString();this.saveAllData();console.log(`Imageremovedfrompoint${pontoId}`);returntrue;}catch(error){console.error('Errorremovingpointimage:',error);returnfalse;}}/***Obterinformaçõesdeimagemdeumponto*@param{number}pontoId-IDdoponto*@returns{Object|null}-Dadosdaimagemounullsenãohouver*/getPointImage(pontoId){constponto=this.getPontoById(pontoId);returnponto?.imagem||null;}/***ValidarURLdeimagem*@param{string}url-URLparavalidar*@param{string}source-Tipodafonte('web'ou'local')*@returns{boolean}-trueseválida*/validateImageUrl(url,source){if(!url||typeofurl!=='string'){returnfalse;}if(source==='web'){//ValidarURLwebtry{consturlObj=newURL(url);return['http:','https:'].includes(urlObj.protocol);}catch{returnfalse;}}elseif(source==='local'){//Validarcaminholocal(relativoouabsoluto)returnurl.startsWith('/')||url.startsWith('./')||url.startsWith('../')||url.match(/^[a-zA-Z]:/)||url.startsWith('assets/');}returnfalse;}filterByCategory(categoria,username=null){if(categoria==='todos'){returnthis.confirmedPoints;}//!TODO:Implementarsistemadefavoritoscompletoif(categoria==='favoritos'&&username){console.log('!TODO:Implementarfiltrodefavoritos');return[];//Retornararrayvaziotemporariamente}returnthis.confirmedPoints.filter(p=>p.categoria===categoria);}getEstatisticas(){consttotalConfirmados=this.confirmedPoints.length;consttotalPendentes=this.pendingPoints.length;consttotalOcultos=this.hiddenPoints.length;constpontosPorCategoria={};//Inicializarcontadoresparatodasascategoriasthis.categorias.forEach(cat=>{pontosPorCategoria[cat.id]=0;});//Contarpontosconfirmadosporcategoriathis.confirmedPoints.forEach(ponto=>{if(pontosPorCategoria.hasOwnProperty(ponto.categoria)){pontosPorCategoria[ponto.categoria]++;}});return{totalPontos:totalConfirmados,totalConfirmados,totalPendentes,totalOcultos,pontosPorCategoria,pontosVerificados:totalConfirmados,pontosNaoVerificados:totalPendentes,totalUsuarios:Object.keys(this.usuarios).filter(k=>!k.startsWith('_')).length,totalSugestoes:this.usuarios._sugestoes?this.usuarios._sugestoes.length:0};}asynccarregarDados(){//Métodoparacompatibilidadecomapp.jsreturnPromise.resolve();}/***Exportardadosparabackup*/exportarDados(){return{confirmedPoints:this.confirmedPoints,pendingPoints:this.pendingPoints,hiddenPoints:this.hiddenPoints,usuarios:this.usuarios,categorias:this.categorias,dataExport:newDate().toISOString(),versao:'2.0'};}/***Importardadosdebackup*/importarDados(dados,userRole='visitor'){if(userRole!=='administrator'){thrownewError('Apenasadministradorespodemimportardados');}if(dados.versao&&(dados.confirmedPoints||dados.pontosConfirmados)){this.confirmedPoints=dados.confirmedPoints||dados.pontosConfirmados||[];this.pendingPoints=dados.pendingPoints||dados.pontosPendentes||[];this.hiddenPoints=dados.hiddenPoints||dados.pontosOcultos||[];this.usuarios=dados.usuarios||{};this.categorias=dados.categorias||this.categorias;//RecalcularpróximoIDconsttodosOsPontos=[...this.confirmedPoints,...this.pendingPoints,...this.hiddenPoints];this.proximoId=todosOsPontos.length>0?Math.max(...todosOsPontos.map(p=>p.id||0))+1:1;this.saveAllData();return{success:true,message:'Dadosimportadoscomsucesso'};}thrownewError('Formatodedadosinválido');}/***SalvardadosnolocalStorage(métododecompatibilidade)*/salvarNoLocalStorage(){this.saveAllData();}/***Deletarpontodefinitivamente*@param{number}pontoId-IDdopontoaserdeletado*@param{string}userRole-Papeldousuário*@returns{boolean}Truesedeletadocomsucesso*/deletarPonto(pontoId,userRole='visitor'){if(userRole!=='administrator'){thrownewError('Apenasadministradorespodemdeletarpontos');}letdeletado=false;constid=parseInt(pontoId);//Tentardeletardetodasaslistasletindex=this.confirmedPoints.findIndex(p=>p.id===id);if(index!==-1){this.confirmedPoints.splice(index,1);deletado=true;}index=this.pendingPoints.findIndex(p=>p.id===id);if(index!==-1){this.pendingPoints.splice(index,1);deletado=true;}index=this.hiddenPoints.findIndex(p=>p.id===id);if(index!==-1){this.hiddenPoints.splice(index,1);deletado=true;}if(deletado){this.saveAllData();console.log(`Ponto${pontoId}deletadodefinitivamente`);}returndeletado;}/***Removerponto(aliasparadeletarPontoparacompatibilidade)*@param{number}pontoId-IDdopontoaserremovido*@param{string}userRole-Papeldousuário*@returns{boolean}Trueseremovidocomsucesso*/removerPonto(pontoId,userRole='visitor'){returnthis.deletarPonto(pontoId,userRole);}/***Buscarpontosporproximidadegeográfica*@param{number}lat-Latitudedocentro*@param{number}lng-Longitudedocentro*@param{number}raio-Raioemquilômetros*@param{string}userRole-Papeldousuário*@param{string}username-Nomedousuário*@returns{Array}Arraydepontosdentrodoraioespecificado*/buscarPorProximidade(lat,lng,raio=1,userRole='visitor',username=null){constpontos=this.getPontosParaUsuario(userRole,username);returnpontos.filter(ponto=>{if(!ponto.coordenadas||ponto.coordenadas.length!==2){returnfalse;}const[pontoLat,pontoLng]=ponto.coordenadas;constdistancia=this.calcularDistancia(lat,lng,pontoLat,pontoLng);returndistancia<=raio;}).sort((a,b)=>{//OrdenarpordistânciaconstdistA=this.calcularDistancia(lat,lng,a.coordenadas[0],a.coordenadas[1]);constdistB=this.calcularDistancia(lat,lng,b.coordenadas[0],b.coordenadas[1]);returndistA-distB;});}/***CalculardistânciaentreduascoordenadasusandofórmuladeHaversine*@param{number}lat1-Latitudedoprimeiroponto*@param{number}lng1-Longitudedoprimeiroponto*@param{number}lat2-Latitudedosegundoponto*@param{number}lng2-Longitudedosegundoponto*@returns{number}Distânciaemquilômetros*/calcularDistancia(lat1,lng1,lat2,lng2){constR=6371;//RaiodaTerraemkmconstdLat=this.degreesToRadians(lat2-lat1);constdLng=this.degreesToRadians(lng2-lng1);consta=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(this.degreesToRadians(lat1))*Math.cos(this.degreesToRadians(lat2))*Math.sin(dLng/2)*Math.sin(dLng/2);constc=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));returnR*c;}/***Convertergrauspararadianos*@param{number}degrees-Ânguloemgraus*@returns{number}Ânguloemradianos*/degreesToRadians(degrees){returndegrees*(Math.PI/180);}/***Dadospadrãodecategoriasparafallbackquandofile://nãopodecarregarJSON*/getCategoriesDefault(){return[{"id":"geral","nome":"Geral","icon":"fasfa-theater-masks","cor":"#6c757d","descricao":"Pontosdeinteressegeralediversos"},{"id":"esportes-lazer","nome":"Esportes","icon":"fasfa-running","cor":"#28a745","descricao":"Atividadesesportivasedelazer"},{"id":"gastronomia","nome":"Gastronomia","icon":"fasfa-utensils","cor":"#dc3545","descricao":"Restaurantes,bareseexperiênciasculinárias"},{"id":"geek-nerd","nome":"Geek","icon":"fasfa-gamepad","cor":"#6f42c1","descricao":"Culturageek,gamesetecnologia"},{"id":"casas-noturnas","nome":"CasasNoturnas","icon":"fasfa-glass-cheers","cor":"#6610f2","descricao":"Vidanoturna,baresecasasdeshow"}];}/***Dadospadrãodepontosconfirmadosparafallback*/getConfirmedPointsDefault(){return[{"id":1,"nome":"TeatroNacionalClaudioSantoro","categoria":"geral","coordenadas":[-15.796,-47.878],"descricao":"PrincipalteatrodeBrasília,comprogramaçãodiversificada","endereco":"ViaN2-AsaNorte","telefone":"(61)3325-6268","horario":"Conformeprogramação","preco":"R$20-80","avaliacao":4.6,"tags":["teatro","cultura","espetaculos"],"ativo":true,"dataCriacao":"2025-01-20T10:00:00.000Z","imagem":{"url":"https://images.unsplash.com/photo-1507924538820-ede94a04019d?w=400","source":"web","description":"TeatroNacionaldeBrasília"}},{"id":2,"nome":"MuseuNacionaldaRepública","categoria":"geral","coordenadas":[-15.798,-47.875],"descricao":"Espaçoculturalcomexposiçõesdearteehistória","endereco":"ViaN1-AsaNorte","telefone":"(61)3325-5220","horario":"Ter-Dom:9h-18h","preco":"R$5-15","avaliacao":4.3,"tags":["museu","arte","cultura"],"ativo":true,"dataCriacao":"2025-01-20T10:15:00.000Z","imagem":{"url":"https://images.unsplash.com/photo-1554072675-66db59dba46f?w=400","source":"web","description":"MuseuNacionaldaRepública"}},{"id":3,"nome":"ParquedaCidadeSarahKubitschek","categoria":"esportes-lazer","coordenadas":[-15.798,-47.896],"descricao":"MaiorparqueurbanodaAméricaLatina,idealparaatividadesfísicas","endereco":"AsaSul","telefone":"(61)3224-5717","horario":"24h","preco":"Gratuito","avaliacao":4.8,"tags":["parque","exercicios","natureza"],"ativo":true,"dataCriacao":"2025-01-20T10:30:00.000Z","imagem":{"url":"https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=400","source":"web","description":"ParquedaCidade"}}];}/***Dadospadrãodeusuáriosparafallback*/getUsersDefault(){return[{"id":1,"username":"admin","password":"admin123","role":"administrator","email":"admin@sigdf.gov.br","nome":"AdministradordoSistema","dataCriacao":"2025-01-20T08:00:00.000Z","ativo":true}];}}//CriarinstânciaglobalconstdatabaseManager=newDatabaseManager();//Exportarparausoemmódulosif(typeofmodule!=='undefined'&&module.exports){module.exports=DatabaseManager;}//Disponibilizarglobalmentewindow.DatabaseManager=DatabaseManager;window.databaseManager=databaseManager;
```

### src/js/info-panel.js

**Linha 1:** Implementarsistemadefavoritos//constisFavorito=isAuthenticated&&user?//window.databaseManager?.isFavorito(ponto.id,user.username):false;constisFavorito=false;//Temporariamentesemprefalsereturn`<divclass="info-user-actions"><divclass="action-buttons-top"><buttonclass="action-btnfavorite-btn"id="btn-favorite"data-ponto-id="${ponto.id}"title="Funcionalidadeemdesenvolvimento"><iclass="fasfa-heart"></i>Favoritar</button><buttonclass="action-btnroutes-btn"id="btn-routes"data-ponto-id="${ponto.id}"disabled><iclass="fasfa-route"></i>Rotas</button></div><divclass="action-buttons-bottom"><buttonclass="action-btnsuggest-btn"id="btn-suggest"data-ponto-id="${ponto.id}"><iclass="fasfa-edit"></i>Sugerirmudança</button></div></div>`;}/***ConfigurareventosdosbotõesdeaçãosetupActionButtons(ponto,user){//BotãodefavoritarconstfavoriteBtn=document.getElementById('btn-favorite');if(favoriteBtn){favoriteBtn.addEventListener('click',(e)=>{e.preventDefault();this.handleFavoriteClick(ponto);});}//Botãoderotas(nãofuncional)constroutesBtn=document.getElementById('btn-routes');if(routesBtn){routesBtn.addEventListener('click',(e)=>{e.preventDefault();this.showNotification('Funcionalidadederotasemdesenvolvimento','info');});}//BotãodesugerirmudançaconstsuggestBtn=document.getElementById('btn-suggest');if(suggestBtn){suggestBtn.addEventListener('click',(e)=>{e.preventDefault();this.handleSuggestClick(ponto);});}}/***HandlecliquenobotãodefavoritarhandleFavoriteClick(ponto){//!TODO:Implementarsistemadefavoritosconsole.log('!TODO:Implementarsistemadefavoritos');//Mostrarnotificaçãodedesenvolvimentothis.showNotification('Emdesenvolvimento','info');return;}/***HandlecliquenobotãodesugerirmudançahandleSuggestClick(ponto){//Verificaçãoseguradeautenticaçãoif(!window.authManager||!window.authManager.isAuthenticated()){console.log('InfoPanel:Usuárionãoautenticado-abrindomodaldelogin');if(!window.loginModal){console.error('InfoPanel:Modaldeloginnãodisponível');this.showNotification('Sistemadeloginnãodisponível.Recarregueapágina.','error');return;}window.loginModal.open({pendingAction:()=>this.handleSuggestClick(ponto)});return;}//Abrirmodaldeformuláriocomdadospré-preenchidosthis.openSuggestionFormModal(ponto);}/***Abrirmodaldeformuláriocomdadospré-preenchidosparasugestãoopenSuggestionFormModal(ponto){try{//Verificarseomodaldeadicionarpontoexisteif(!window.addPointModal){console.error('Modaldeadicionarpontonãoencontrado');this.showNotification('Erro:Modalnãodisponível','error');return;}//Abriromodalcomosdadosdopontoatualwindow.addPointModal.open({isEditMode:true,isSuggestion:true,pointData:{id:ponto.id,nome:ponto.nome||'',categoria:ponto.categoria||'geral',descricao:ponto.descricao||'',endereco:ponto.endereco||'',telefone:ponto.telefone||'',website:ponto.website||'',horario:ponto.horario||'',preco:ponto.preco||'',imagem:ponto.imagem||'',coordenadas:ponto.coordenadas||[ponto.lat,ponto.lng]},originalPoint:ponto,onSave:(dadosAtualizados)=>{this.processarSugestao(ponto,dadosAtualizados);}});console.log('Modaldesugestãoabertopara:',ponto.nome);}catch(error){console.error('Erroaoabrirmodaldesugestão:',error);this.showNotification('Erroaoabrirformuláriodesugestão','error');}}/***ProcessarsugestãoenviadapeloformulárioprocessarSugestao(pontoOriginal,dadosAtualizados){try{constuser=window.authManager.getCurrentUser();if(!user){this.showNotification('Erro:Usuárionãoautenticado','error');return;}//Identificarquaiscamposforamalteradosconstsugestoes={};constcamposParaComparar=['nome','categoria','descricao','endereco','telefone','website','horario','preco','imagem'];for(constcampoofcamposParaComparar){constvalorOriginal=pontoOriginal[campo]||'';constvalorNovo=dadosAtualizados[campo]||'';if(valorNovo!==valorOriginal&&valorNovo.trim()!==''){sugestoes[campo]=valorNovo.trim();}}//Verificarcoordenadasif(dadosAtualizados.coordenadas&&(dadosAtualizados.coordenadas[0]!==pontoOriginal.lat||dadosAtualizados.coordenadas[1]!==pontoOriginal.lng)){sugestoes.coordenadas=dadosAtualizados.coordenadas;}//Verificarseháalgumasugestãoif(Object.keys(sugestoes).length===0){this.showNotification('Nenhumaalteraçãodetectada','info');return;}//Enviarsugestãowindow.databaseManager.sugerirMudanca(pontoOriginal.id,sugestoes,user.username);this.showNotification('Sugestãoenviadaparaanálise!','success');console.log('Sugestãoprocessada:',sugestoes);}catch(error){console.error('Erroaoprocessarsugestão:',error);this.showNotification('Erroaoenviarsugestão','error');}}/***MostrarnotificaçãoshowNotification(message,type='info'){//Sistemadethrottlingparareduzirnotificaçõesrepetidasif(!this.notificationThrottle){this.notificationThrottle=newMap();}constthrottleKey=`${type}-${message}`;constnow=Date.now();constlastShown=this.notificationThrottle.get(throttleKey);//Paraerros,sómostrarsepassoupelomenos5segundos//Paraoutrostipos,2segundosconstthrottleTime=type==='error'?5000:2000;if(lastShown&&(now-lastShown)<throttleTime){console.log(`Notificaçãothrottled:${message}`);return;}this.notificationThrottle.set(throttleKey,now);//Usarosistemadenotificaçõesglobalsedisponívelif(window.notificationSystem){window.notificationSystem.show(message,type);return;}//Fallbackparaimplementaçãosimplesthis.showSimpleNotification(message,type);}/***ImplementaçãosimplesdenotificaçãocomofallbackshowSimpleNotification(message,type){//LimitarnúmerodenotificaçõessimultâneasconstexistingNotifications=document.querySelectorAll('.notification.show');if(existingNotifications.length>=3){//Removeramaisantigaconstoldest=existingNotifications[0];oldest.style.transform='translateX(100%)';setTimeout(()=>{if(oldest.parentNode){oldest.parentNode.removeChild(oldest);}},300);}constcolors={success:'#10b981',error:'#ef4444',info:'#3b82f6',warning:'#f59e0b'};constnotification=document.createElement('div');notification.className=`notification${type}show`;notification.innerHTML=`<divstyle="display:flex;align-items:center;gap:0.5rem;"><iclass="fasfa-${this.getNotificationIcon(type)}"></i><span>${message}</span></div>`;//ReduzirtamanhodasnotificaçõesdeerroconstfontSize=type==='error'?'0.85rem':'0.9rem';constpadding=type==='error'?'0.75rem':'1rem';notification.style.cssText=`position:fixed;top:${20+(existingNotifications.length*70)}px;right:20px;background:${colors[type]||colors.info};color:white;padding:${padding};border-radius:6px;z-index:10001;max-width:280px;font-size:${fontSize};transform:translateX(100%);transition:transform0.3sease;box-shadow:04px12pxrgba(0,0,0,0.15);`;document.body.appendChild(notification);//MostrarnotificaçãorequestAnimationFrame(()=>{notification.style.transform='translateX(0)';});//Tempobaseadonotipo:errosdurammenosconstduration=type==='error'?3000:4000;//RemoverapósotempoespecificadosetTimeout(()=>{notification.style.transform='translateX(100%)';setTimeout(()=>{if(notification.parentNode){document.body.removeChild(notification);}},300);},duration);}/***ObteríconeparanotificaçãogetNotificationIcon(type){consticons={success:'check-circle',error:'exclamation-circle',info:'info-circle',warning:'exclamation-triangle'};returnicons[type]||icons.info;}/***Renderizarinformaçõesbásicas*@param{Object}ponto-Dadosdoponto*@returns{string}HTMLdasinformaçõesbásicasrenderBasicInfo(ponto){lethtml='';if(ponto.endereco){html+=`<divclass="info-detail"><spanclass="info-detail-icon">📍</span><spanclass="info-detail-text">${ponto.endereco}</span></div>`;}if(ponto.descricao){html+=`<divclass="info-detail"><spanclass="info-detail-icon">📝</span><spanclass="info-detail-text">${ponto.descricao}</span></div>`;}returnhtml;}/***Renderizarinformaçõesdecontato*@param{Object}ponto-Dadosdoponto*@returns{string}HTMLdasinformaçõesdecontatorenderContactInfo(ponto){lethtml='';if(ponto.telefone){html+=`<divclass="info-detail"><spanclass="info-detail-icon">📞</span><spanclass="info-detail-text"><ahref="tel:${ponto.telefone}"class="info-link">${ponto.telefone}</a></span></div>`;}if(ponto.website){html+=`<divclass="info-detail"><spanclass="info-detail-icon">🌐</span><spanclass="info-detail-text"><ahref="${ponto.website}"target="_blank"class="info-link">Siteoficial</a></span></div>`;}returnhtml;}/***Renderizarinformaçõesadicionais*@param{Object}ponto-Dadosdoponto*@returns{string}HTMLdasinformaçõesadicionaisrenderAdditionalInfo(ponto){lethtml='';if(ponto.horario){html+=`<divclass="info-detail"><spanclass="info-detail-icon">🕒</span><spanclass="info-detail-text">${ponto.horario}</span></div>`;}if(ponto.preco){html+=`<divclass="info-detail"><spanclass="info-detail-icon">💰</span><spanclass="info-detail-text">${ponto.preco}</span></div>`;}if(ponto.avaliacao>0){html+=`<divclass="info-detail"><spanclass="info-detail-icon"></span><spanclass="info-detail-text">${ponto.avaliacao}/5</span></div>`;}returnhtml;}/***Renderizartags*@param{Object}ponto-Dadosdoponto*@returns{string}HTMLdastagsrenderTags(ponto){if(!ponto.tags||!Array.isArray(ponto.tags)||ponto.tags.length===0){return'';}consttagsHtml=ponto.tags.map(tag=>`<spanclass="info-tag">#${tag}</span>`).join('');return`<divclass="info-tags">${tagsHtml}</div>`;}/***Renderizaraçõesdeadministrador*@param{Object}ponto-Dadosdoponto*@returns{string}HTMLdasaçõesdeadminrenderAdminActions(ponto){return`<divclass="info-admin-actions"><buttonclass="info-admin-btnedit"data-action="edit"data-id="${ponto.id}"><iclass="fasfa-edit"></i>Editar</button><buttonclass="info-admin-btndelete"data-action="delete"data-id="${ponto.id}"><iclass="fasfa-trash"></i>Remover</button></div>`;}/***Obteríconedacategoria*@param{Object}categoria-Dadosdacategoria*@returns{string}EmojidoíconegetIconeCategoria(categoria){if(!categoria)return'📍';constmapaIcones={'cultura':'🎭','gastronomia':'🍴','noturno':'🍺','esportes':'','geral':'📍','teatro':'🎭','museu':'🏛','parque':'🌳','restaurante':'🍽','bar':'🍻','clube':'🎵','academia':'🏋','shopping':'🛍'};returnmapaIcones[categoria.id]||mapaIcones[categoria.nome?.toLowerCase()]||'📍';}/***Configurarbotõesdeadministrador*@param{Object}ponto-DadosdopontosetupAdminButtons(ponto){consteditBtn=this.panelBody.querySelector('[data-action="edit"]');constdeleteBtn=this.panelBody.querySelector('[data-action="delete"]');if(editBtn){editBtn.addEventListener('click',()=>{this.handleEditPoint(ponto.id);});}if(deleteBtn){deleteBtn.addEventListener('click',async()=>{try{awaitthis.handleDeletePoint(ponto.id);}catch(error){console.error('Erronoeventodedelete:',error);}});}}/***Manipularediçãodeponto*@param{number}pontoId-IDdopontohandleEditPoint(pontoId){if(window.mapManager&&typeofwindow.mapManager.editarPonto==='function'){window.mapManager.editarPonto(pontoId);}}/***Manipularremoçãodeponto*@param{number}pontoId-IDdopontoasynchandleDeletePoint(pontoId){if(window.mapManager&&typeofwindow.mapManager.removerPonto==='function'){try{awaitwindow.mapManager.removerPonto(pontoId);this.hide();//Fecharpainelapósremoção}catch(error){console.error('Erroaoremoverponto:',error);alert('Erroaoremoverponto.Tentenovamente.');}}}/***Verificarseopainelestávisível*@returns{boolean}isOpen(){returnthis.isVisible;}/***Obterpontoatual*@returns{Object|null}getCurrentPoint(){returnthis.currentPoint;}}//Instanciarglobalmentewindow.infoPanelManager=newInfoPanelManager();

```javascript
/***GerenciadordoPainelLateraldeInformações-CleanArchitecture**Responsabilidades:*-Exibirinformaçõesdospontosselecionados*-Controlarabertura/fechamentodopainel*-Renderizarconteúdodeformaestruturada*-Gerenciareventosdeinteração**@authorTalesOliveira(github.com/TalesLimaOliveira)*@version1.0.0*@noteEstearquivocontémtrechosdecódigogeradoscomauxíliodeInteligênciaArtificial.*/classInfoPanelManager{constructor(){this.panel=null;this.panelBody=null;this.panelTitle=null;this.panelImage=null;this.imagePlaceholder=null;this.closeButton=null;this.tabs=null;this.tabContents=null;this.currentTab='overview';this.isVisible=false;this.currentPoint=null;this.init();}/***Inicializaogerenciadordopainel*/init(){console.log('InicializandoInfoPanelManager...');this.setupElements();this.setupEventListeners();console.log('InfoPanelManagerinicializado');}/***ConfigurarelementosDOM*/setupElements(){this.panel=document.getElementById('info-panel');this.panelBody=document.getElementById('info-panel-body');this.panelTitle=document.getElementById('info-panel-title');this.panelImage=document.getElementById('info-panel-image');this.imagePlaceholder=document.querySelector('.info-panel-image-placeholder');this.closeButton=document.getElementById('info-panel-close');this.tabs=document.querySelectorAll('.info-panel-tab');this.tabContents=document.querySelectorAll('.info-panel-tab-content');if(!this.panel||!this.panelBody||!this.panelTitle||!this.closeButton){console.error('Elementosdopainelnãoencontrados');return;}}/***Configurareventlisteners*/setupEventListeners(){if(!this.closeButton)return;//Botãodefecharthis.closeButton.addEventListener('click',()=>{this.hide();});//Eventosdasabasthis.tabs.forEach(tab=>{tab.addEventListener('click',()=>{consttabName=tab.getAttribute('data-tab');this.switchTab(tabName);});});//FecharcomteclaESCdocument.addEventListener('keydown',(e)=>{if(e.key==='Escape'&&this.isVisible){//NãofecharsehouvermodalabertoconsthasOpenModal=document.querySelector('.modal-backdrop[style*="flex"]')||document.querySelector('.modal-backdrop[style*="block"]');if(!hasOpenModal){this.hide();}}});//Fecharaoclicarforadopainel(nomapa)document.addEventListener('click',(e)=>{if(this.isVisible&&!this.panel.contains(e.target)&&!e.target.closest('.marcador-otimizado')&&!e.target.closest('.modal-backdrop')&&!e.target.closest('.login-modal')&&!e.target.closest('.leaflet-popup')&&!e.target.closest('.leaflet-marker-icon')&&!e.target.closest('.custom-marker')){//AdicionardelayparaevitarfechamentoimediatodurantecliquesemmarcadoressetTimeout(()=>{if(this.isVisible){this.hide();}},100);}});}/***Alternarentreabas*@param{string}tabName-Nomedaaba*/switchTab(tabName){//Atualizarestadodaabaatualthis.currentTab=tabName;//Removerclasseactivedetodasasabaseconteúdosthis.tabs.forEach(tab=>tab.classList.remove('active'));this.tabContents.forEach(content=>content.classList.remove('active'));//AdicionarclasseactivenaabaeconteúdoselecionadosconstactiveTab=document.querySelector(`[data-tab="${tabName}"]`);constactiveContent=document.getElementById(`tab-${tabName}`);if(activeTab)activeTab.classList.add('active');if(activeContent)activeContent.classList.add('active');console.log(`Abaalteradapara:${tabName}`);}/***Exibirpainelcominformaçõesdoponto*@param{Object}ponto-Dadosdoponto*/show(ponto){if(!this.panel||!ponto)return;//EvitarqueeventosdecliqueinterfiramduranteaaberturaconstpreventClick=(e)=>{e.stopPropagation();e.preventDefault();};//Adicionarlistenertemporárioparaprevenirinterferênciadocument.addEventListener('click',preventClick,{once:true,capture:true});this.currentPoint=ponto;this.renderContent(ponto);this.setupImage(ponto);//GarantirqueaabaOverviewestáselecionadathis.switchTab('overview');//Adicionarclasseaobodyparaajustarlayoutdocument.body.classList.add('body-with-info-panel');//Mostrarpainelcomtransiçãosuavethis.panel.classList.remove('hidden');//UsarrequestAnimationFrameparagarantirqueatransiçãoocorrarequestAnimationFrame(()=>{this.panel.classList.add('visible');});this.isVisible=true;console.log('Painelabertopara:',ponto.nome);//RemoverolistenerpreventivoapósumbrevedelaysetTimeout(()=>{document.removeEventListener('click',preventClick,{capture:true});},200);}/***Ocultarpainel*/hide(){if(!this.panel||!this.isVisible)return;this.panel.classList.remove('visible');setTimeout(()=>{this.panel.classList.add('hidden');},300);//Removerclassedobodydocument.body.classList.remove('body-with-info-panel');this.isVisible=false;this.currentPoint=null;console.log('Painelfechado');}/***Configurarimagemdopainel*@param{Object}ponto-Dadosdoponto*/setupImage(ponto){if(!this.panelImage||!this.imagePlaceholder)return;//Definirtítulodaimagemthis.panelTitle.textContent=ponto.nome||'Localselecionado';//Verificarseháimagemdisponível(novaestruturaoulegada)letimageUrl=null;letimageDescription='';if(ponto.imagem){if(typeofponto.imagem==='object'&&ponto.imagem.url){//NovaestruturacomobjetodeimagemimageUrl=ponto.imagem.url;imageDescription=ponto.imagem.description||`Imagemde${ponto.nome}`;}elseif(typeofponto.imagem==='string'&&ponto.imagem!=='https://via.placeholder.com/300x200'){//EstruturalegadacomstringimageUrl=ponto.imagem;imageDescription=`Imagemde${ponto.nome}`;}}if(imageUrl){this.panelImage.src=imageUrl;this.panelImage.alt=imageDescription;this.panelImage.title=imageDescription;this.panelImage.style.display='block';this.imagePlaceholder.style.display='none';//Tratamentodeerrodecarregamentodaimagemthis.panelImage.onerror=()=>{console.warn(`Erroaocarregarimagem:${imageUrl}`);this.panelImage.style.display='none';this.imagePlaceholder.style.display='flex';};}else{//Mostrarplaceholderquandonãoháimagemthis.panelImage.style.display='none';this.imagePlaceholder.style.display='flex';}}/***Renderizarconteúdodopainel*@param{Object}ponto-Dadosdoponto*/renderContent(ponto){if(!this.panelBody)return;constcategoria=window.databaseManager?.obterCategoria(ponto.categoria);constisAdmin=window.authManager?.isAdmin();constuser=window.authManager?.getCurrentUser();//RenderizarapenasoconteúdodaabaOverviewthis.panelBody.innerHTML=`<divclass="info-details">${this.renderBasicInfo(ponto)}${this.renderContactInfo(ponto)}${this.renderAdditionalInfo(ponto)}${this.renderTags(ponto)}${this.renderUserActions(ponto,user)}${isAdmin?this.renderAdminActions(ponto):''}</div>`;//Configurareventosdosbotõesthis.setupActionButtons(ponto,user);if(isAdmin){this.setupAdminButtons(ponto);}}/***Renderizaraçõesdousuário(favoritar,sugerirmudança)*/renderUserActions(ponto,user){if(!ponto)return'';constisAuthenticated=window.authManager?.isAuthenticated();//!TODO:Implementarsistemadefavoritos//constisFavorito=isAuthenticated&&user?//window.databaseManager?.isFavorito(ponto.id,user.username):false;constisFavorito=false;//Temporariamentesemprefalsereturn`<divclass="info-user-actions"><divclass="action-buttons-top"><buttonclass="action-btnfavorite-btn"id="btn-favorite"data-ponto-id="${ponto.id}"title="Funcionalidadeemdesenvolvimento"><iclass="fasfa-heart"></i>Favoritar</button><buttonclass="action-btnroutes-btn"id="btn-routes"data-ponto-id="${ponto.id}"disabled><iclass="fasfa-route"></i>Rotas</button></div><divclass="action-buttons-bottom"><buttonclass="action-btnsuggest-btn"id="btn-suggest"data-ponto-id="${ponto.id}"><iclass="fasfa-edit"></i>Sugerirmudança</button></div></div>`;}/***Configurareventosdosbotõesdeação*/setupActionButtons(ponto,user){//BotãodefavoritarconstfavoriteBtn=document.getElementById('btn-favorite');if(favoriteBtn){favoriteBtn.addEventListener('click',(e)=>{e.preventDefault();this.handleFavoriteClick(ponto);});}//Botãoderotas(nãofuncional)constroutesBtn=document.getElementById('btn-routes');if(routesBtn){routesBtn.addEventListener('click',(e)=>{e.preventDefault();this.showNotification('Funcionalidadederotasemdesenvolvimento','info');});}//BotãodesugerirmudançaconstsuggestBtn=document.getElementById('btn-suggest');if(suggestBtn){suggestBtn.addEventListener('click',(e)=>{e.preventDefault();this.handleSuggestClick(ponto);});}}/***Handlecliquenobotãodefavoritar*/handleFavoriteClick(ponto){//!TODO:Implementarsistemadefavoritosconsole.log('!TODO:Implementarsistemadefavoritos');//Mostrarnotificaçãodedesenvolvimentothis.showNotification('Emdesenvolvimento','info');return;}/***Handlecliquenobotãodesugerirmudança*/handleSuggestClick(ponto){//Verificaçãoseguradeautenticaçãoif(!window.authManager||!window.authManager.isAuthenticated()){console.log('InfoPanel:Usuárionãoautenticado-abrindomodaldelogin');if(!window.loginModal){console.error('InfoPanel:Modaldeloginnãodisponível');this.showNotification('Sistemadeloginnãodisponível.Recarregueapágina.','error');return;}window.loginModal.open({pendingAction:()=>this.handleSuggestClick(ponto)});return;}//Abrirmodaldeformuláriocomdadospré-preenchidosthis.openSuggestionFormModal(ponto);}/***Abrirmodaldeformuláriocomdadospré-preenchidosparasugestão*/openSuggestionFormModal(ponto){try{//Verificarseomodaldeadicionarpontoexisteif(!window.addPointModal){console.error('Modaldeadicionarpontonãoencontrado');this.showNotification('Erro:Modalnãodisponível','error');return;}//Abriromodalcomosdadosdopontoatualwindow.addPointModal.open({isEditMode:true,isSuggestion:true,pointData:{id:ponto.id,nome:ponto.nome||'',categoria:ponto.categoria||'geral',descricao:ponto.descricao||'',endereco:ponto.endereco||'',telefone:ponto.telefone||'',website:ponto.website||'',horario:ponto.horario||'',preco:ponto.preco||'',imagem:ponto.imagem||'',coordenadas:ponto.coordenadas||[ponto.lat,ponto.lng]},originalPoint:ponto,onSave:(dadosAtualizados)=>{this.processarSugestao(ponto,dadosAtualizados);}});console.log('Modaldesugestãoabertopara:',ponto.nome);}catch(error){console.error('Erroaoabrirmodaldesugestão:',error);this.showNotification('Erroaoabrirformuláriodesugestão','error');}}/***Processarsugestãoenviadapeloformulário*/processarSugestao(pontoOriginal,dadosAtualizados){try{constuser=window.authManager.getCurrentUser();if(!user){this.showNotification('Erro:Usuárionãoautenticado','error');return;}//Identificarquaiscamposforamalteradosconstsugestoes={};constcamposParaComparar=['nome','categoria','descricao','endereco','telefone','website','horario','preco','imagem'];for(constcampoofcamposParaComparar){constvalorOriginal=pontoOriginal[campo]||'';constvalorNovo=dadosAtualizados[campo]||'';if(valorNovo!==valorOriginal&&valorNovo.trim()!==''){sugestoes[campo]=valorNovo.trim();}}//Verificarcoordenadasif(dadosAtualizados.coordenadas&&(dadosAtualizados.coordenadas[0]!==pontoOriginal.lat||dadosAtualizados.coordenadas[1]!==pontoOriginal.lng)){sugestoes.coordenadas=dadosAtualizados.coordenadas;}//Verificarseháalgumasugestãoif(Object.keys(sugestoes).length===0){this.showNotification('Nenhumaalteraçãodetectada','info');return;}//Enviarsugestãowindow.databaseManager.sugerirMudanca(pontoOriginal.id,sugestoes,user.username);this.showNotification('Sugestãoenviadaparaanálise!','success');console.log('Sugestãoprocessada:',sugestoes);}catch(error){console.error('Erroaoprocessarsugestão:',error);this.showNotification('Erroaoenviarsugestão','error');}}/***Mostrarnotificação*/showNotification(message,type='info'){//Sistemadethrottlingparareduzirnotificaçõesrepetidasif(!this.notificationThrottle){this.notificationThrottle=newMap();}constthrottleKey=`${type}-${message}`;constnow=Date.now();constlastShown=this.notificationThrottle.get(throttleKey);//Paraerros,sómostrarsepassoupelomenos5segundos//Paraoutrostipos,2segundosconstthrottleTime=type==='error'?5000:2000;if(lastShown&&(now-lastShown)<throttleTime){console.log(`Notificaçãothrottled:${message}`);return;}this.notificationThrottle.set(throttleKey,now);//Usarosistemadenotificaçõesglobalsedisponívelif(window.notificationSystem){window.notificationSystem.show(message,type);return;}//Fallbackparaimplementaçãosimplesthis.showSimpleNotification(message,type);}/***Implementaçãosimplesdenotificaçãocomofallback*/showSimpleNotification(message,type){//LimitarnúmerodenotificaçõessimultâneasconstexistingNotifications=document.querySelectorAll('.notification.show');if(existingNotifications.length>=3){//Removeramaisantigaconstoldest=existingNotifications[0];oldest.style.transform='translateX(100%)';setTimeout(()=>{if(oldest.parentNode){oldest.parentNode.removeChild(oldest);}},300);}constcolors={success:'#10b981',error:'#ef4444',info:'#3b82f6',warning:'#f59e0b'};constnotification=document.createElement('div');notification.className=`notification${type}show`;notification.innerHTML=`<divstyle="display:flex;align-items:center;gap:0.5rem;"><iclass="fasfa-${this.getNotificationIcon(type)}"></i><span>${message}</span></div>`;//ReduzirtamanhodasnotificaçõesdeerroconstfontSize=type==='error'?'0.85rem':'0.9rem';constpadding=type==='error'?'0.75rem':'1rem';notification.style.cssText=`position:fixed;top:${20+(existingNotifications.length*70)}px;right:20px;background:${colors[type]||colors.info};color:white;padding:${padding};border-radius:6px;z-index:10001;max-width:280px;font-size:${fontSize};transform:translateX(100%);transition:transform0.3sease;box-shadow:04px12pxrgba(0,0,0,0.15);`;document.body.appendChild(notification);//MostrarnotificaçãorequestAnimationFrame(()=>{notification.style.transform='translateX(0)';});//Tempobaseadonotipo:errosdurammenosconstduration=type==='error'?3000:4000;//RemoverapósotempoespecificadosetTimeout(()=>{notification.style.transform='translateX(100%)';setTimeout(()=>{if(notification.parentNode){document.body.removeChild(notification);}},300);},duration);}/***Obteríconeparanotificação*/getNotificationIcon(type){consticons={success:'check-circle',error:'exclamation-circle',info:'info-circle',warning:'exclamation-triangle'};returnicons[type]||icons.info;}/***Renderizarinformaçõesbásicas*@param{Object}ponto-Dadosdoponto*@returns{string}HTMLdasinformaçõesbásicas*/renderBasicInfo(ponto){lethtml='';if(ponto.endereco){html+=`<divclass="info-detail"><spanclass="info-detail-icon">📍</span><spanclass="info-detail-text">${ponto.endereco}</span></div>`;}if(ponto.descricao){html+=`<divclass="info-detail"><spanclass="info-detail-icon">📝</span><spanclass="info-detail-text">${ponto.descricao}</span></div>`;}returnhtml;}/***Renderizarinformaçõesdecontato*@param{Object}ponto-Dadosdoponto*@returns{string}HTMLdasinformaçõesdecontato*/renderContactInfo(ponto){lethtml='';if(ponto.telefone){html+=`<divclass="info-detail"><spanclass="info-detail-icon">📞</span><spanclass="info-detail-text"><ahref="tel:${ponto.telefone}"class="info-link">${ponto.telefone}</a></span></div>`;}if(ponto.website){html+=`<divclass="info-detail"><spanclass="info-detail-icon">🌐</span><spanclass="info-detail-text"><ahref="${ponto.website}"target="_blank"class="info-link">Siteoficial</a></span></div>`;}returnhtml;}/***Renderizarinformaçõesadicionais*@param{Object}ponto-Dadosdoponto*@returns{string}HTMLdasinformaçõesadicionais*/renderAdditionalInfo(ponto){lethtml='';if(ponto.horario){html+=`<divclass="info-detail"><spanclass="info-detail-icon">🕒</span><spanclass="info-detail-text">${ponto.horario}</span></div>`;}if(ponto.preco){html+=`<divclass="info-detail"><spanclass="info-detail-icon">💰</span><spanclass="info-detail-text">${ponto.preco}</span></div>`;}if(ponto.avaliacao>0){html+=`<divclass="info-detail"><spanclass="info-detail-icon"></span><spanclass="info-detail-text">${ponto.avaliacao}/5</span></div>`;}returnhtml;}/***Renderizartags*@param{Object}ponto-Dadosdoponto*@returns{string}HTMLdastags*/renderTags(ponto){if(!ponto.tags||!Array.isArray(ponto.tags)||ponto.tags.length===0){return'';}consttagsHtml=ponto.tags.map(tag=>`<spanclass="info-tag">#${tag}</span>`).join('');return`<divclass="info-tags">${tagsHtml}</div>`;}/***Renderizaraçõesdeadministrador*@param{Object}ponto-Dadosdoponto*@returns{string}HTMLdasaçõesdeadmin*/renderAdminActions(ponto){return`<divclass="info-admin-actions"><buttonclass="info-admin-btnedit"data-action="edit"data-id="${ponto.id}"><iclass="fasfa-edit"></i>Editar</button><buttonclass="info-admin-btndelete"data-action="delete"data-id="${ponto.id}"><iclass="fasfa-trash"></i>Remover</button></div>`;}/***Obteríconedacategoria*@param{Object}categoria-Dadosdacategoria*@returns{string}Emojidoícone*/getIconeCategoria(categoria){if(!categoria)return'📍';constmapaIcones={'cultura':'🎭','gastronomia':'🍴','noturno':'🍺','esportes':'','geral':'📍','teatro':'🎭','museu':'🏛','parque':'🌳','restaurante':'🍽','bar':'🍻','clube':'🎵','academia':'🏋','shopping':'🛍'};returnmapaIcones[categoria.id]||mapaIcones[categoria.nome?.toLowerCase()]||'📍';}/***Configurarbotõesdeadministrador*@param{Object}ponto-Dadosdoponto*/setupAdminButtons(ponto){consteditBtn=this.panelBody.querySelector('[data-action="edit"]');constdeleteBtn=this.panelBody.querySelector('[data-action="delete"]');if(editBtn){editBtn.addEventListener('click',()=>{this.handleEditPoint(ponto.id);});}if(deleteBtn){deleteBtn.addEventListener('click',async()=>{try{awaitthis.handleDeletePoint(ponto.id);}catch(error){console.error('Erronoeventodedelete:',error);}});}}/***Manipularediçãodeponto*@param{number}pontoId-IDdoponto*/handleEditPoint(pontoId){if(window.mapManager&&typeofwindow.mapManager.editarPonto==='function'){window.mapManager.editarPonto(pontoId);}}/***Manipularremoçãodeponto*@param{number}pontoId-IDdoponto*/asynchandleDeletePoint(pontoId){if(window.mapManager&&typeofwindow.mapManager.removerPonto==='function'){try{awaitwindow.mapManager.removerPonto(pontoId);this.hide();//Fecharpainelapósremoção}catch(error){console.error('Erroaoremoverponto:',error);alert('Erroaoremoverponto.Tentenovamente.');}}}/***Verificarseopainelestávisível*@returns{boolean}*/isOpen(){returnthis.isVisible;}/***Obterpontoatual*@returns{Object|null}*/getCurrentPoint(){returnthis.currentPoint;}}//Instanciarglobalmentewindow.infoPanelManager=newInfoPanelManager();
```

### src/js/map.js

**Linha 1:** Implementarsistemadefavoritos//constgruposNecessarios=['todos','favoritos','geral','esportes-lazer',//'gastronomia','geek-nerd','casas-noturnas'];constgruposNecessarios=['todos','geral','esportes-lazer','gastronomia','geek-nerd','casas-noturnas'];gruposNecessarios.forEach(categoria=>{if(!this.gruposPorCategoria.has(categoria)){this.gruposPorCategoria.set(categoria,L.layerGroup());}});}/***Aplicatemainicialbaseadonaspreferênciassalvas**Usadopor:init()*@private_aplicarTemaInicial(){try{//Sempreaplicartemaescurothis._aplicarTemaNoMapa(true);}catch(error){console.error('Erroaoaplicartemainicial:',error);}}/***Aplicatemaespecíficonomapa**@param{boolean}temaEscuro-Sedeveaplicartemaescuro*@private_aplicarTemaNoMapa(temaEscuro=false){try{//Paramantersimplicidade,mantemossempreacamadaderuas//OtemaescuroseráaplicadoviaCSSnainterfaceconsole.log(`Tema${temaEscuro?'escuro':'claro'}aplicadoaomapa`);}catch(error){console.error('Erroaoaplicartemanomapa:',error);}}/***Configuraeventlistenersprincipaisdomapa**Implementalistenerspara:*-Cliquesnomapa(modoadição)*-Eventosdobancodedados*-Mudançasdeautenticação**Usadopor:init()*@private_configurarEventListeners(){//Clicknomapaparaadicionarpontos(apenasadminemmodoadição)this.map.on('click',(e)=>{if(this._isAdminEmModoAdicao()){this._iniciarAdicaoPonto(e.latlng);}});//Eventosdosistemadedadosthis._configurarEventosDatabase();//Eventosdeautenticaçãothis._configurarEventosAuth();}/***Configuraeventosrelacionadosaobancodedados*@private_configurarEventosDatabase(){//Pontoadicionadodocument.addEventListener('database_pontoAdicionado',(e)=>{this.addMarker(e.detail);});//Pontoatualizadodocument.addEventListener('database_pontoAtualizado',(e)=>{this.atualizarMarcador(e.detail);});//Pontoremovidodocument.addEventListener('database_pontoRemovido',(e)=>{this.removeMarker(e.detail.id);});//Categoriascarregadas/atualizadas-recarregarmarcadoresdocument.addEventListener('database_categoriasCarregadas',()=>{console.log('Categoriascarregadas,recarregandomarcadores...');this.recarregarMarcadores();});}/***Configuraeventosrelacionadosàautenticação*@private_configurarEventosAuth(){document.addEventListener('authStateChanged',(e)=>{constisAdmin=e.detail.type==='login'&&e.detail.user?.role==='administrator';this._atualizarControlesAdmin(isAdmin);//Recarregarpontosbaseadononovocontextodeusuáriothis.reloadPoints();});}/***Verificaseousuárioéadmineestáemmodoadição*@returns{boolean}*@private_isAdminEmModoAdicao(){returnwindow.authManager?.isAdmin?.()&&this.modoAdicao;}/***Configuracontrolesespecíficosdomapa**Removecontrolesdesnecessáriosparainterfacelimpa*Adicionacontrolesespecíficosparaadministradores**Usadopor:init()*@private_configurarControles(){try{//Removercontrolespadrãoparainterfacemaislimpa//Oscontrolesdezoomsãoremovidosintencionalmente//Adicionarcontrolesespecíficosparaadminsif(window.authManager?.isAdmin?.()){this._adicionarControlesAdmin();}console.log('Controlesdomapaconfigurados');}catch(error){console.error('Erroaoconfigurarcontroles:',error);}}/***Adicionacontrolesespecíficosparaadministradores*@private_adicionarControlesAdmin(){//Controledecoordenadasparafacilitaradiçãodepontosthis._adicionarControleCoordenadas();}/***Adicionacontroledecoordenadasparaadmins*@private_adicionarControleCoordenadas(){//!TODO:Implementspecificmapcontrolsifneeded//Porenquanto,coordenadassãomostradasnoconsolenoclick}/***Atualizacontrolesbaseadonostatusdeadmin**@param{boolean}isAdmin-Seousuárioéadministrador*Usadopor:_configurarEventosAuth()*@private_atualizarControlesAdmin(isAdmin){try{if(isAdmin){this._adicionarControlesAdmin();}else{this._removerControlesAdmin();}}catch(error){console.error('Erroaoatualizarcontrolesadmin:',error);}}/***Removecontrolesespecíficosdeadministrador*@private_removerControlesAdmin(){//!TODO:Implementremovalofspecificcontrolsifadded//Porenquanto,apenasdesabilitamododeadiçãothis.modoAdicao=false;}//==========================================//MÉTODOSPÚBLICOS-INTERFACEPRINCIPAL//==========================================/***Alternatemadomapa(métodopúblico)**@param{boolean}temaEscuro-Sedeveaplicartemaescuro*Usadopor:interfacealternarTemaMapa(temaEscuro=false){try{this._aplicarTemaNoMapa(temaEscuro);console.log(`Temadomapaalteradopara${temaEscuro?'escuro':'claro'}`);}catch(error){console.error('Erroaoalterartemadomapa:',error);}}/***Aplicatemainicialbaseadonasconfiguraçõessalvas**Métodopúblicomantidoparacompatibilidadecomcódigolegado*@deprecatedUse_aplicarTemaInicial()internamente*Usadopor:interfaceaplicarTemaInicial(){this._aplicarTemaInicial();}/***Adicionacontroledecoordenadasparaadministradores**Exibecoordenadasemtemporealparafacilitaradiçãodepontos*Usadopor:_adicionarControlesAdmin()adicionarControlesCoordenadas(){try{constcontroleCoordenadas=L.control({position:'bottomleft'});controleCoordenadas.onAdd=function(){constdiv=L.DomUtil.create('div','controle-coordenadas');div.style.cssText=`background:rgba(255,255,255,0.9);padding:5px10px;border-radius:5px;fontSize:12px;fontFamily:monospace;border:1pxsolid#ccc;box-shadow:02px4pxrgba(0,0,0,0.1);`;div.innerHTML='Lat:-,Lng:-';returndiv;};controleCoordenadas.addTo(this.map);//Atualizarcoordenadasnomovimentodomousethis.map.on('mousemove',(e)=>{const{lat,lng}=e.latlng;constdiv=document.querySelector('.controle-coordenadas');if(div){div.innerHTML=`Lat:${lat.toFixed(6)},Lng:${lng.toFixed(6)}`;}});console.log('📍Controledecoordenadasadicionado');}catch(error){console.error('Erroaoadicionarcontroledecoordenadas:',error);}}//==========================================//MÉTODOSDECARREGAMENTOEEXIBIÇÃO//==========================================/***MostraindicadordecarregamentomostrarCarregamento(texto='Carregando...'){constdiv=document.createElement('div');div.className='loading-overlay';div.style.cssText=`position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:10000;color:white;font-size:18px;`;div.innerHTML=`<divstyle="text-align:center;"><divstyle="border:4pxsolid#f3f3f3;border-radius:50%;border-top:4pxsolid#3498db;width:40px;height:40px;animation:spin2slinearinfinite;margin:0auto10px;"></div>${texto}</div>`;//AdicionaranimaçãoCSSif(!document.querySelector('#loading-animation-style')){conststyle=document.createElement('style');style.id='loading-animation-style';style.textContent='@keyframesspin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}';document.head.appendChild(style);}document.body.appendChild(div);returndiv;}/***CarregartodosospontosnomapaloadPoints(){if(!window.databaseManager){console.warn('DatabaseManagernãodisponível');return;}//Obtercontextodousuárioatualconstuser=window.authManager?.getCurrentUser();constuserRole=user?.role||'visitor';constusername=user?.username||null;constpontos=window.databaseManager.buscarPorCategoria('todos',userRole,username);//Mostrarfeedbackvisualimediatothis._mostrarCarregamento(true);//Limparmarcadoresexistentesthis.marcadores.forEach(marcador=>{this.map.removeLayer(marcador);});this.marcadores.clear();//Carregaremlotesparamelhorperformancethis._loadPointsInBatches(pontos);}/***Limparcachedeícones(útilquandocategoriassãoatualizadas)limparCacheIcones(){this.iconCache.clear();if(this._iconeCache){this._iconeCache.clear();}console.log('Cachedeíconeslimpo');}/***RecarregartodososmarcadorescomíconesatualizadosrecarregarMarcadores(){this.limparCacheIcones();//Recarregarpontosparaaplicarnovosíconesif(window.databaseManager){this.carregarPontos();}}/***LimpartodososmarcadoresdomapaclearMarkers(){try{console.log('🧹Limpandomarcadoresexistentes...');//Removergruposdomapaelimparsuascamadasthis.gruposPorCategoria.forEach((grupo,categoria)=>{if(this.map.hasLayer(grupo)){this.map.removeLayer(grupo);console.log(`➖Grupo${categoria}removidodomapa`);}grupo.clearLayers();});//Limpartodasasreferênciasthis.gruposPorCategoria.clear();this.marcadores.clear();console.log('Marcadoreslimpos');}catch(error){console.error('Erroaolimparmarcadores:',error);}}/***Adicionarmarcadoraomapa*@param{Object}ponto-DadosdopontoaddMarker(ponto){try{if(!ponto||!ponto.id||!ponto.nome){console.warn('Dadosdopontoinválidos:',ponto);return;}//Verificarsejáexisteummarcadorparaestepontoif(this.marcadores&&this.marcadores.has(ponto.id)){console.log(`Marcadorjáexisteparaponto${ponto.id},ignorando...`);return;}console.log(`📍Adicionandomarcador:${ponto.nome}(ID:${ponto.id})`);//Verificarcoordenadasletcoordenadas;if(ponto.coordenadas&&Array.isArray(ponto.coordenadas)&&ponto.coordenadas.length===2){coordenadas=ponto.coordenadas;//[latitude,longitude]}elseif(ponto.latitude&&ponto.longitude){coordenadas=[ponto.latitude,ponto.longitude];}else{console.warn(`Coordenadasinválidasparaponto:${ponto.nome}`,ponto.coordenadas);return;}//Obtercategoriaouusarpadrãoletcategoria=null;if(window.databaseManager&&window.databaseManager.obterCategoria){categoria=window.databaseManager.obterCategoria(ponto.categoria);}if(!categoria){console.warn(`Categorianãoencontrada:${ponto.categoria},usandopadrão`);categoria={id:ponto.categoria||'geral',cor:'#3b82f6',icon:'fasfa-map-marker-alt',nome:ponto.categoria||'Geral'};}//CriaríconeconstisPendente=ponto.status==='pendente';console.log(`Criandoíconeparacategoria:${categoria.id}(pendente:${isPendente})`);consticone=this._criarIconeOtimizado(categoria,isPendente);//Criarmarcadorconstmarcador=L.marker(coordenadas,{icon:icone,title:ponto.nome,riseOnHover:true});//Configurareventosdomarcadormarcador.on('click',(e)=>{e.originalEvent?.stopPropagation();this.selecionarPonto(ponto);});//Eventosdehoversimplesmarcador.on('mouseover',()=>{constelement=marcador.getElement();if(element){consticonDiv=element.querySelector('.marker-icon');if(iconDiv){iconDiv.style.transform='scale(1.1)';iconDiv.style.boxShadow='04px12pxrgba(0,0,0,0.6)';}}});marcador.on('mouseout',()=>{constelement=marcador.getElement();if(element&&!element.classList.contains('marcador-selecionado')){consticonDiv=element.querySelector('.marker-icon');if(iconDiv){iconDiv.style.transform='scale(1)';iconDiv.style.boxShadow='03px8pxrgba(0,0,0,0.4)';}}});//Garantirqueosgruposexistamthis._criarGruposBasicos();//InicializarMapsenecessárioif(!this.marcadores){this.marcadores=newMap();}//AdicionaraogrupodacategoriaespecíficaconstcategoriaId=categoria.id;if(!this.gruposPorCategoria.has(categoriaId)){this.gruposPorCategoria.set(categoriaId,L.layerGroup());}constgrupoCategoriaAtual=this.gruposPorCategoria.get(categoriaId);grupoCategoriaAtual.addLayer(marcador);//Adicionartambémaogrupo"todos"if(!this.gruposPorCategoria.has('todos')){this.gruposPorCategoria.set('todos',L.layerGroup());}constgrupoTodos=this.gruposPorCategoria.get('todos');grupoTodos.addLayer(marcador);//***IMPORTANTE:Adicionarosgruposaomapaparaqueosmarcadoresapareçam***if(!this.map.hasLayer(grupoCategoriaAtual)){grupoCategoriaAtual.addTo(this.map);console.log(`Grupodacategoria${categoriaId}adicionadoaomapa`);}if(!this.map.hasLayer(grupoTodos)){grupoTodos.addTo(this.map);console.log('Grupo"todos"adicionadoaomapa');}//Salvarreferênciadomarcadorthis.marcadores.set(ponto.id,marcador);console.log(`Marcadoradicionado:${ponto.nome}nacategoria${categoriaId}`);//Debug:Verificarseomarcadorfoiadicionadocorretamenteaosgruposconsole.log(`Debuggruposapósadicionarmarcador:`);console.log(`-Grupo${categoriaId}:${grupoCategoriaAtual.getLayers().length}marcadores`);console.log(`-Grupotodos:${grupoTodos.getLayers().length}marcadores`);console.log(`-Totalmarcadoressalvos:${this.marcadores.size}`);}catch(error){console.error('Erroaoadicionarmarcador:',error,ponto);}}/***Selecionarpontoeexibirnopainellateral*@param{Object}ponto-DadosdopontoselecionarPonto(ponto){try{console.log('📍Pontoselecionado:',ponto.nome);//Incrementarvisualizaçõesthis.incrementarViews(ponto.id);//Destacarmarcadorselecionadoprimeirothis.destacarMarcadorSelecionado(ponto.id);//Exibirnopainellateralcomdelayparaevitarconflitosif(window.infoPanelManager){//UsarrequestAnimationFrameparagarantirqueoeventosejaprocessadorequestAnimationFrame(()=>{window.infoPanelManager.show(ponto);});}else{console.warn('InfoPanelManagernãodisponível');}}catch(error){console.error('Erroaoselecionarponto:',error);}}/***Destacarmarcadorselecionado*@param{number}pontoId-IDdopontodestacarMarcadorSelecionado(pontoId){//Removerdestaquedeoutrosmarcadoresthis.marcadores.forEach((marcador,id)=>{constelement=marcador.getElement();if(element){element.classList.remove('marcador-selecionado');}});//DestacarmarcadoratualconstmarcadorAtual=this.marcadores.get(pontoId);if(marcadorAtual){constelement=marcadorAtual.getElement();if(element){element.classList.add('marcador-selecionado');}}}/***Obteríconelegívelparacategoria*@param{Object}categoria-Dadosdacategoria*@returns{string}EmojiouíconelegívelobterIconeLegivel(categoria){if(!categoria)return'📍';//MapearcategoriasparaemojislegíveisconstmapaIcones={'geral':'🎭','esportes-lazer':'','gastronomia':'🍽','geek-nerd':'🎮','casas-noturnas':'🍻'//!TODO:Implementarsistemadefavoritos//'favoritos':'❤'};//TentarencontrarporIDdacategoriaif(mapaIcones[categoria.id]){returnmapaIcones[categoria.id];}//Fallbackparaíconepadrãoreturn'📍';}/***Filtrarpontosporcategoria*@param{string}categoria-CategoriaafiltrarfilterByCategory(categoria,username=null){console.log(`Iniciandofiltroporcategoria:${categoria}`);console.log(`Gruposdisponíveis:`,Array.from(this.gruposPorCategoria.keys()));//Garantirqueosgruposexistamif(!this.gruposPorCategoria.size){console.log('📍Inicializandogruposdecategorias...');this._inicializarGruposCategorias();}//RemoverTODOSosgruposativosdomapaprimeiroletgruposRemovidos=0;this.gruposPorCategoria.forEach((grupo,cat)=>{if(this.map.hasLayer(grupo)){this.map.removeLayer(grupo);gruposRemovidos++;console.log(`➖Removidogrupo:${cat}(${grupo.getLayers().length}pontos)`);}});console.log(`Totaldegruposremovidos:${gruposRemovidos}`);//!TODO:Implementarsistemadefavoritos//Lógicaespecialparafavoritos//if(categoria==='favoritos'&&username){//this.filtrarFavoritos(username);//this.activeCategory=categoria;//console.log(`Filtrodefavoritosaplicadopara:${username}`);//return;//}if(categoria==='favoritos'){console.log('Sistemadefavoritosemdesenvolvimento');return;}//Adicionargrupodacategoriaselecionadaif(categoria==='todos'){//Mostrartodosospontos-adicionartodososgruposdecategoriasreaisletgruposAdicionados=0;lettotalPontos=0;this.gruposPorCategoria.forEach((grupo,cat)=>{if(cat!=='favoritos'&&cat!=='todos'){this.map.addLayer(grupo);gruposAdicionados++;totalPontos+=grupo.getLayers().length;console.log(`➕Adicionadogrupo:${cat}(${grupo.getLayers().length}pontos)`);}});this.activeCategory='todos';console.log(`Mostrandotodosospontos(${gruposAdicionados}grupos,${totalPontos}pontostotal)`);}elseif(this.gruposPorCategoria.has(categoria)){//Mostrarapenaspontosdacategoriaespecíficaconstgrupo=this.gruposPorCategoria.get(categoria);this.map.addLayer(grupo);this.activeCategory=categoria;console.log(`Mostrandopontosdacategoria:${categoria}(${grupo.getLayers().length}pontos)`);}else{//Categorianãoexiste,fallbackpara"todos"console.warn(`Categoria'${categoria}'nãoencontrada,mostrandotodos`);letgruposAdicionados=0;lettotalPontos=0;this.gruposPorCategoria.forEach((grupo,cat)=>{if(cat!=='favoritos'&&cat!=='todos'){this.map.addLayer(grupo);gruposAdicionados++;totalPontos+=grupo.getLayers().length;console.log(`➕Adicionadogrupo(fallback):${cat}(${grupo.getLayers().length}pontos)`);}});this.activeCategory='todos';}console.log(`Filtroaplicado:${this.activeCategory}`);//VerificarquantospontosestãovisíveisnomapaletpontosVisiveis=0;this.gruposPorCategoria.forEach((grupo,cat)=>{if(this.map.hasLayer(grupo)){pontosVisiveis+=grupo.getLayers().length;}});console.log(`Totaldepontosvisíveis:${pontosVisiveis}`);}/***Filtrarapenaspontosfavoritosdousuário-FUNCIONALIDADEEMDESENVOLVIMENTO*!TODO:ImplementarsistemacompletodefavoritosfiltrarFavoritos(username){console.log('!TODO:ImplementarfiltrarFavoritos-username:',username);console.log('Sistemadefavoritosemdesenvolvimento');//Funçãotemporariamentedesabilitadareturn;}/***Recarregarpontosbaseadonopapeldousuário*OtimizadocomcarregamentoemlotesreloadPoints(userRole='visitor',username=null){try{console.log(`Recarregandopontospara${userRole}...`);//Verificarseomapafoiinicializadoif(!this.map){console.warn('Mapanãofoiinicializado,inicializandoagora...');this.init();if(!this.map){console.error('Falhaaoinicializaromapa');return;}}//VerificarseoDatabaseManagerestádisponívelif(!window.databaseManager){console.error('DatabaseManagernãodisponível');return;}//Mostrarindicadordecarregamentothis._mostrarCarregamento(true);//Obterpontosbaseadonoperfilletpontos;if(userRole==='administrator'){constconfirmados=window.databaseManager.getPontos()||[];constpendentes=window.databaseManager.getPontosPendentes()||[];pontos=[...confirmados,...pendentes];}else{pontos=window.databaseManager.getPontos()||[];//Apenasconfirmados}console.log(`📦${pontos.length}pontosobtidosdobancodedados`);//Debug:mostraralgunspontosdeexemploif(pontos.length>0){console.log('Exemplodepontos:',pontos.slice(0,3).map(p=>({id:p.id,nome:p.nome,categoria:p.categoria,coordenadas:p.coordenadas,ativo:p.ativo})));//VerificarsehácoordenadasválidasconstpontosComCoordenadas=pontos.filter(p=>p.coordenadas&&Array.isArray(p.coordenadas)&&p.coordenadas.length===2);console.log(`📍Pontoscomcoordenadasválidas:${pontosComCoordenadas.length}`);}else{console.warn('NenhumpontoencontradonoDatabaseManager');//TentarforçarrecarregamentodoDatabaseManagerif(window.databaseManager.carregarTodosDados){console.log('TentandorecarregardadosdoDatabaseManager...');window.databaseManager.loadAllData().then(()=>{console.log('Dadosrecarregados,tentandonovamente...');setTimeout(()=>this.reloadPoints(userRole,username),100);}).catch(error=>{console.error('ErroaorecarregarDatabaseManager:',error);this._mostrarCarregamento(false);});return;}else{this._mostrarCarregamento(false);return;}}//Limparestadoanteriorcompletamenteconsole.log('Limpandoestadoanterior...');this.clearMarkers();this.limparCacheIcones();//Recriargruposbásicosconsole.log('Criandogruposbásicos...');this._criarGruposBasicos();//Senãohápontos,finalizaraquiif(pontos.length===0){console.log('Nenhumpontoparacarregar');this._finalizarCarregamento(0);return;}//Carregarpontosemlotesparamelhorperformanceconsole.log('📍Iniciandocarregamentoemlotes...');this._loadPointsInBatches(pontos);}catch(error){console.error('Erroaorecarregarpontos:',error);this._mostrarCarregamento(false);}}/***Atualizarmarcador*@param{Object}ponto-DadosatualizadosdopontoatualizarMarcador(ponto){if(this.marcadores.has(ponto.id)){//Removermarcadorantigothis.removeMarker(ponto.id);//Adicionarmarcadoratualizadothis.addMarker(ponto);}}/***Removermarcador*@param{number}id-IDdopontoremoveMarker(id){if(this.marcadores.has(id)){constmarcador=this.marcadores.get(id);//Removerdetodososgruposthis.gruposPorCategoria.forEach(grupo=>{grupo.removeLayer(marcador);});//Removerdomapathis.map.removeLayer(marcador);//Removerdareferênciathis.marcadores.delete(id);}}/***Incrementarvisualizaçõesdoponto*@param{number}id-IDdopontoincrementarViews(id){constponto=databaseManager.obterPonto(id);if(ponto&&ponto.metadata){ponto.metadata.views=(ponto.metadata.views||0)+1;databaseManager.salvarNoLocalStorage();}}/***Iniciarmododeadiçãodeponto*@param{Object}latlng-CoordenadasdocliqueiniciarAdicaoPonto(latlng){if(!authManager.isAdmin()){return;}//Disparareventoparaabrirmodaldeadiçãoconstevent=newCustomEvent('abrirModalAdicao',{detail:{coordenadas:[latlng.lat,latlng.lng]}});document.dispatchEvent(event);}/***Ativar/desativarmododeadição*@param{boolean}ativo-SeomododeveestarativosetModoAdicao(ativo){this.modoAdicao=ativo;//Alterarcursordomapaif(ativo){this.map.getContainer().style.cursor='crosshair';}else{this.map.getContainer().style.cursor='';}}/***Centralizarmapaempontoespecífico*@param{number}id-IDdopontocentralizarEm(id){constponto=databaseManager.obterPonto(id);if(ponto){this.map.setView(ponto.coordenadas,16);//Abrirpopupdomarcadorif(this.marcadores.has(id)){this.marcadores.get(id).openPopup();}}}/***Editarponto(placeholderparaintegraçãocommodal)*@param{number}id-IDdopontoeditarPonto(id){constevent=newCustomEvent('editarPonto',{detail:{id}});document.dispatchEvent(event);}/***Removerpontocomconfirmação*@param{number}id-IDdopontoasyncremoverPonto(id){constponto=databaseManager.obterPonto(id);if(!ponto)return;constconfirmacao=confirm(`Temcertezaquedesejaremover"${ponto.nome}"?`);if(confirmacao){try{awaitdatabaseManager.deletarPonto(id);alert('Pontoremovidocomsucesso!');}catch(error){alert('Erroaoremoverponto:'+error.message);}}}/***Atualizarcontrolesadministrativos*@param{boolean}isAdmin-SeousuárioéadminatualizarControlesAdmin(isAdmin){if(isAdmin&&!document.querySelector('.controle-coordenadas')){this.adicionarControlesCoordenadas();}}/***Buscarpontospróximosàposiçãoatual*@param{number}raio-RaioemkmbuscarProximos(raio=2){constcentro=this.map.getCenter();//Obtercontextodousuárioatualconstuser=window.authManager?.getCurrentUser();constuserRole=user?.role||'visitor';constusername=user?.username||null;constpontos=databaseManager.buscarPorProximidade(centro.lat,centro.lng,raio,userRole,username);//Destacarpontospróximosthis.destacarPontos(pontos.map(p=>p.id));returnpontos;}/***Destacarpontosespecíficos*@param{Array}ids-IDsdospontosadestacardestacarPontos(ids){//Removerdestaquesanterioresthis.marcadores.forEach(marcador=>{marcador.setOpacity(0.5);});//Destacarpontosselecionadosids.forEach(id=>{if(this.marcadores.has(id)){this.marcadores.get(id).setOpacity(1);}});//Restauraropacidadeapós5segundossetTimeout(()=>{this.marcadores.forEach(marcador=>{marcador.setOpacity(1);});},5000);}/***CentralizarmapaemBrasíliacentralizarBrasilia(){constcentro=[-15.794700,-47.890000];this.map.setView(centro,11);}/***Obterboundsdetodosospontos*@returns{Object}BoundsdoLeafletobterBoundsPontos(){//Obtercontextodousuárioatualconstuser=window.authManager?.getCurrentUser();constuserRole=user?.role||'visitor';constusername=user?.username||null;constpontos=databaseManager.buscarPorCategoria('todos',userRole,username);if(pontos.length===0)returnnull;constcoordenadas=pontos.map(p=>p.coordenadas);returnL.latLngBounds(coordenadas);}/***AjustarzoomparamostrartodosospontosajustarZoomParaTodos(){constbounds=this.obterBoundsPontos();if(bounds){this.map.fitBounds(bounds,{padding:[20,20]});}}/***Forçaredimensionamentodomapa-útilapósmudançasdelayoutforcarRedimensionamento(){if(this.map){console.log('Forçandoredimensionamentodomapa...');this.map.invalidateSize(true);//SegundainvalidaçãoparagarantirsetTimeout(()=>{if(this.map){this.map.invalidateSize(true);}},100);}}/***Mostrar/Ocultarindicadordecarregamentodomapa(otimizado)*@private_mostrarCarregamento(mostrar){constmapContainer=document.getElementById(this.containerId);if(!mapContainer)return;letloadingIndicator=mapContainer.querySelector('.map-loading');if(mostrar&&!loadingIndicator){loadingIndicator=document.createElement('div');loadingIndicator.className='map-loading';loadingIndicator.innerHTML=`<divstyle="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.8);color:white;padding:8px16px;border-radius:6px;z-index:1000;font-size:14px;font-family:Arial,sans-serif;">⚡Carregando...</div>`;mapContainer.appendChild(loadingIndicator);}elseif(!mostrar&&loadingIndicator){loadingIndicator.remove();}}/***Carregarpontosemlotesparamelhorperformance*@private_loadPointsInBatches(pontos){constBATCH_SIZE=100;//Aumentadode50para100pontosporvezparacarregamentomaisrápidoconstBATCH_DELAY=5;//Reduzidode10mspara5msentrecadaloteletindice=0;consttotalPontos=pontos.length;constprocessarLote=()=>{constloteAtual=pontos.slice(indice,indice+BATCH_SIZE);//ProcessarloteatualloteAtual.forEach(ponto=>{try{this.addMarker(ponto);}catch(error){console.error(`Erroaoadicionarponto${ponto.id}:`,error);}});indice+=BATCH_SIZE;//Atualizarprogressovisualconstprogresso=Math.min(100,Math.round((indice/totalPontos)*100));this._atualizarProgressoCarregamento(progresso);//Processarpróximoloteoufinalizarif(indice<totalPontos){setTimeout(processarLote,BATCH_DELAY);}else{this._finalizarCarregamento(totalPontos);}};//Iniciarprocessamentoconsole.log(`📍Iniciandocarregamentode${totalPontos}pontosemlotes...`);processarLote();}/***Atualizarprogressodocarregamento*@private_atualizarProgressoCarregamento(progresso){constmapContainer=document.getElementById(this.containerId);constloadingIndicator=mapContainer?.querySelector('.map-loadingspan');if(loadingIndicator){loadingIndicator.textContent=`Carregandopontos...${progresso}%`;}}/***Finalizarcarregamentocomfeedback*@private_finalizarCarregamento(totalPontos){console.log(`${totalPontos}pontoscarregadoscomsucesso`);//AplicarfiltroparagarantirqueosmarcadoressejamvisíveissetTimeout(()=>{constcategoriaAtual=this.activeCategory||'todos';console.log(`Aplicandofiltrofinal:${categoriaAtual}`);this.filterByCategory(categoriaAtual);},50);//Removerindicadordecarregamentorapidamente(otimização)setTimeout(()=>{this._mostrarCarregamento(false);},100);//Reduzidode500mspara100ms//Dispatcheventodecarregamentocompletowindow.dispatchEvent(newCustomEvent('mapaPontosCarregados',{detail:{totalPontos}}));}/***Cachedeíconesparaevitarrecriaçãodesnecessária*@private_obterIconeCache(categoria,isPendente=false){constcacheKey=`${categoria.id}_${isPendente}_${window.innerWidth<=768?'mobile':(window.innerWidth<=1024?'tablet':'desktop')}`;if(!this._iconeCache){this._iconeCache=newMap();}if(!this._iconeCache.has(cacheKey)){consticone=this._criarIconeOtimizado(categoria,isPendente);this._iconeCache.set(cacheKey,icone);}returnthis._iconeCache.get(cacheKey);}/***Criaríconeotimizado(simplificadoemaisrobusto)*@private_criarIconeOtimizado(categoria,isPendente=false){//TamanhosresponsivosconstisMobile=window.innerWidth<=768;constisTablet=window.innerWidth<=1024;lettamanho,fontSize;if(isMobile){tamanho=48;fontSize=26;}elseif(isTablet){tamanho=42;fontSize=22;}else{tamanho=38;fontSize=20;}constcor=categoria?.cor||'#3b82f6';consticon=categoria?.icon||'fasfa-map-marker-alt';constopacity=isPendente?0.7:1;constborderStyle=isPendente?'dashed':'solid';returnL.divIcon({className:'marcador-otimizado',html:`<divclass="marker-icon"style="width:${tamanho}px!important;height:${tamanho}px!important;background-color:${cor};color:white;border-radius:50%;display:flex!important;align-items:center!important;justify-content:center!important;border:3px${borderStyle}white!important;box-shadow:03px10pxrgba(0,0,0,0.4)!important;font-size:${fontSize}px!important;opacity:${opacity};cursor:pointer!important;position:relative!important;z-index:1000!important;transition:all0.2sease!important;"><iclass="${icon}"style="color:white!important;font-size:${fontSize}px!important;line-height:1!important;pointer-events:none!important;"></i></div>`,iconSize:[tamanho,tamanho],iconAnchor:[tamanho/2,tamanho/2],popupAnchor:[0,-tamanho/2],className:'marcador-leaflet'});}}//CriarinstânciaglobalseminicializarautomaticamenteconstmapManager=newMapManager();//FunçãoparainicializaromapaapósDOMestarprontofunctioninicializarMapa(containerId='map'){if(!mapManager.map){mapManager.init();}returnmapManager;}//Exportarparausoemmódulosif(typeofmodule!=='undefined'&&module.exports){module.exports={MapManager,inicializarMapa};}//Disponibilizarglobalmentewindow.MapManager=MapManager;window.mapManager=mapManager;window.inicializarMapa=inicializarMapa;//AdicionarCSSotimizadoparamarcadoresif(!document.querySelector('#map-markers-css')){conststyleSheet=document.createElement('style');styleSheet.id='map-markers-css';styleSheet.textContent=`.marcador-otimizado{overflow:visible!important;z-index:1000!important;}.marcador-otimizado.marker-icon{width:100%;height:100%;border:3pxsolidwhite;border-radius:50%;box-shadow:03px10pxrgba(0,0,0,0.4);display:flex;align-items:center;justify-content:center;color:white;cursor:pointer;transition:all0.2sease;overflow:visible!important;position:relative;}.marcador-otimizado.marker-icon:hover{transform:scale(1.1);box-shadow:04px12pxrgba(0,0,0,0.6);z-index:1001;}.marcador-otimizado.marker-iconi{display:flex;align-items:center;justify-content:center;width:100%;height:100%;}/*Garantirvisibilidadeemtodososdispositivos.leaflet-marker-icon.marcador-otimizado{overflow:visible!important;z-index:1000!important;}/*Correçãoparamarcadorescortados.leaflet-marker-pane{overflow:visible!important;}.leaflet-map-pane{overflow:visible!important;}`;document.head.appendChild(styleSheet);}

```javascript
/***MapManager-GerenciadordeMapasInterativos**Responsabilidades:*-InicializareconfigurarmapaLeaflet*-Gerenciarmarcadoresecategorias*-Controlarresponsividadeeperformance*-Filtrarpontosporcategoriaeusuário*-Gerenciarmododeadiçãodepontos**Usadopor:PontosEntretenimentoApp*Dependências:Leaflet.js,DatabaseManager**@authorTalesOliveira(github.com/TalesLimaOliveira)*@version1.0.0*@noteEstearquivocontémtrechosdecódigogeradoscomauxíliodeInteligênciaArtificial.*/classMapManager{/***ConstrutordoMapManager*@param{string}containerId-IDdocontainerHTMLdomapa*/constructor(containerId='map'){//Configuraçõesbásicasthis.containerId=containerId;this.map=null;//Markermanagementthis.markers=newMap();//MapofmarkersbyIDthis.marcadores=newMap();//Aliasparacompatibilidadethis.groupsByCategory=newMap();//Markergroupsbycategorythis.gruposPorCategoria=this.groupsByCategory;//Aliasparacompatibilidadethis.iconCache=newMap();//Iconcacheforbetterperformance//Applicationstatethis.activeCategory='todos';//Currentlyfilteredcategorythis.openPopup=null;//IDofcurrentlyopenpopupthis.additionMode=false;//Ifinpointadditionmode//Constantesdomapathis.BRASILIA_CENTER=[-15.794700,-47.890000];this.DEFAULT_ZOOM=11;this.MIN_ZOOM=10;this.MAX_ZOOM=18;this.DF_BOUNDS=L.latLngBounds([-16.5,-48.5],//Southwest[-15.3,-47.2]//Northeast);//Nãoinicializarautomaticamente-aguardarDOM//this.init();seráchamadopeloAppInitializer}/***Inicializaomapaetodososseuscomponentes**Fluxodeinicialização:*1.Validarcontaineredependências*2.Criarmapabase*3.Configurarcamadas*4.Aplicartemainicial*5.Configurareventos*6.Configurarcontroles*7.Configurarresponsividade**Usadopor:Constructor*@throws{Error}SecontainernãoexistirouLeafletnãoestivercarregado*/init(){try{console.log('InicializandoMapManager...');//Validarpré-requisitosthis._validarPreRequisitos();//Inicializarcomponentesnaordemcorretathis._criarMapa();this._configurarCamadas();this._aplicarTemaInicial();this._configurarEventListeners();this._configurarControles();this._configurarResponsividade();console.log('MapManagersuccessfullyinitialized');}catch(error){console.error('ErrorinitializingMapManager:',error);throwerror;}}/***Validapré-requisitosparainicialização*@private*@throws{Error}Serequisitosnãoatendidos*/_validarPreRequisitos(){//VerificarseLeafletestádisponívelif(typeofL==='undefined'){thrownewError('Leafletnãoestácarregado');}//VerificarseoDOMestáprontoif(document.readyState==='loading'){thrownewError('DOMaindanãoestápronto');}//Verificarseocontainerexisteconstcontainer=document.getElementById(this.containerId);if(!container){thrownewError(`Container'${this.containerId}'nãoencontrado`);}}/***Configuraresponsividadecompletadomapa**Implementa:*-ResizeObserverpararedimensionamentodocontainer*-Listenerparamudançasdeorientação*-Debouncedresizehandler*-Configuraçõesresponsivasdomapa**Usadopor:init()*@private*/_configurarResponsividade(){//ResizeObserverparamudançasnocontainerthis._configurarResizeObserver();//Listenersparamudançasdeorientaçãoejanelathis._configurarEventListenersResponsivos();//Aplicarconfiguraçõesresponsivasbaseadasnotamanhoatualthis._aplicarConfiguracoesMobile();}/***ConfiguraResizeObserverparaocontainerdomapa*@private*/_configurarResizeObserver(){if(!ResizeObserver)return;constresizeObserver=newResizeObserver(this._debounce(()=>{if(this.map){//AguardarminimamenteparagarantirqueocontainerestádimensionadosetTimeout(()=>{this.map.invalidateSize();},50);//Reduzidode100mspara50ms}},50));//Reduzidode100mspara50msconstmapContainer=document.getElementById(this.containerId);if(mapContainer){resizeObserver.observe(mapContainer);}}/***Configuraeventlistenersresponsivos*@private*/_configurarEventListenersResponsivos(){//Mudançasdeorientaçãoemdispositivosmóveiswindow.addEventListener('orientationchange',()=>{setTimeout(()=>{if(this.map){this.map.invalidateSize();this._aplicarConfiguracoesMobile();}},500);});//Redimensionamentodajanelawindow.addEventListener('resize',this._debounce(()=>{if(this.map){this.map.invalidateSize();this._aplicarConfiguracoesMobile();}},250));}/***Funçãoutilitáriadedebounceparaotimizarperformance*@private*@param{Function}func-Funçãoaserdebounced*@param{number}wait-Tempodeesperaemms*@returns{Function}Funçãodebounced*/_debounce(func,wait){lettimeout;returnfunctionexecutedFunction(...args){constlater=()=>{clearTimeout(timeout);func.apply(this,args);};clearTimeout(timeout);timeout=setTimeout(later,wait);};}/***Criaomapabasecomconfiguraçõesotimizadas**Configuraçõesaplicadas:*-CentroemBrasília*-LimitesdoDistritoFederal*-Controlescustomizados*-RendererCanvasparaperformance**Usadopor:init()*@private*/_criarMapa(){//Verificarseocontainertemdimensõesválidasconstcontainer=document.getElementById(this.containerId);if(container){constrect=container.getBoundingClientRect();console.log(`Containerdimensions:${rect.width}x${rect.height}`);//Seocontainernãotemaltura,aguardarumpoucoif(rect.height===0){console.log('Containerwithoutheight,waiting...');setTimeout(()=>this._criarMapa(),100);return;}}//Criarmapacomconfiguraçõesotimizadasthis.map=L.map(this.containerId,{center:this.BRASILIA_CENTER,zoom:this.DEFAULT_ZOOM,zoomControl:false,//ControlecustomizadoseráadicionadoattributionControl:false,//RemovidoparainterfacelimpapreferCanvas:true,//Melhorperformanceparamuitosmarcadoresrenderer:L.canvas(),//RendererdecanvasotimizadomaxBounds:this.DF_BOUNDS,//LimitaráreanavegávelminZoom:this.MIN_ZOOM,maxZoom:this.MAX_ZOOM});//Forçarumainvalidaçãoinicialotimizada(reduzidodelay)setTimeout(()=>{if(this.map){this.map.invalidateSize(true);console.log('Mapinitializedandresized');}},50);//Reduzidode100mspara50ms//Aplicarconfiguraçõesresponsivasiniciaisthis._aplicarConfiguracoesMobile();}/***Aplicaconfiguraçõesespecíficasparadispositivosmóveis*@private*/_aplicarConfiguracoesMobile(){if(!this.map)return;constisMobile=window.innerWidth<=768;if(isMobile){//Configuraçõesparamobile:zoommaissuavethis.map.options.zoomSnap=0.5;this.map.options.zoomDelta=0.5;this.map.options.wheelPxPerZoomLevel=120;//Popupresponsivothis.map.options.maxPopupWidth=Math.min(300,window.innerWidth-40);}else{//Configuraçõesparadesktop:zoomprecisothis.map.options.zoomSnap=1;this.map.options.zoomDelta=1;this.map.options.wheelPxPerZoomLevel=60;//Popupmaiorparadesktopthis.map.options.maxPopupWidth=400;}}/***Configuraascamadasbasedomapa**Implementa:*-CamadadetilesOpenStreetMap*-Inicializaçãodosgruposdecategorias*-Carregamentoinicialdospontos**Usadopor:init()*@private*/_configurarCamadas(){//Criareadicionarcamadaderuasotimizadaparacarregamentorápidothis.camadaRuas=L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19,attribution:'',//Removidoparainterfacelimpaloading:'lazy',//CarregamentootimizadocrossOrigin:true,keepBuffer:2,//ManterbuffermenorparaeconomizarmemóriaupdateWhenIdle:true,//AtualizarapenasquandoparadoupdateWhenZooming:false,//NãoatualizardurantezoomparamelhorperformanceupdateInterval:150//Reduzirfrequênciadeatualizações});this.camadaRuas.addTo(this.map);//Inicializargruposdecategoriasthis._inicializarGruposCategorias();}/***Inicializagruposdemarcadoresporcategoria**CriaumLayerGroupparacadacategoriadisponível,*permitindofiltroseficientesporcategoria**@param{Array}pontosCustomizados-Pontosespecíficosparacarregar(opcional)*Usadopor:_configurarCamadas(),filterByCategory()*@private*/_inicializarGruposCategorias(pontosCustomizados=null){//Limpargruposexistentesdomapathis.gruposPorCategoria.forEach(grupo=>{if(this.map.hasLayer(grupo)){this.map.removeLayer(grupo);}});this.gruposPorCategoria.clear();//Criargruposbásicosthis._criarGruposBasicos();//AguardarDatabaseManagerestardisponívelif(window.databaseManager){try{constcategorias=window.databaseManager.getCategorias();//Criargrupoparacadacategoriadobancocategorias.forEach(categoria=>{if(!this.gruposPorCategoria.has(categoria.id)){this.gruposPorCategoria.set(categoria.id,L.layerGroup());}});//Carregarpontossedisponíveisconstpontos=pontosCustomizados||this._obterPontosParaCarregar();if(pontos&&pontos.length>0){this._loadPoints(pontos);}console.log(`Categorygroupsinitialized:${this.gruposPorCategoria.size}groups`);}catch(error){console.error('Errorinitializingcategorygroups:',error);}}else{console.warn('DatabaseManagernotavailabletoinitializecategories');}}/***Obtémpontosparacarregarbaseadonoperfildousuário**Lógicadeacesso:*-Administrator:vêpontosconfirmados+pendentes*-User/Visitor:vêapenaspontosconfirmados**@returns{Array}Listadepontosparacarregar*Usadopor:_inicializarGruposCategorias(),recarregarPontos()*@private*/_obterPontosParaCarregar(){if(!window.databaseManager){console.warn('DatabaseManagernotavailable');return[];}try{constuser=window.authManager?.getCurrentUser();if(user&&user.role==='administrator'){//Adminvêtodosospontos(confirmados+pendentes)constconfirmados=window.databaseManager.getPontos();constpendentes=window.databaseManager.getPontosPendentes();return[...confirmados,...pendentes];}else{//Visitante/usuáriovêapenasconfirmadosreturnwindow.databaseManager.getPontos();}}catch(error){console.error('Errorgettingpoints:',error);return[];}}/***Carregapontosnomapacriandomarcadoresapropriados**@param{Array}pontos-Listadepontosaseremcarregados*Usadopor:_inicializarGruposCategorias(),recarregarPontos()*@private*/_loadPoints(pontos){try{console.log(`📍Loading${pontos.length}pointsonmap...`);console.log('Dadosdospontos:',pontos);//Limparmarcadoresexistentesthis.clearMarkers();//Inicializargruposprimeirosenecessárioif(this.gruposPorCategoria.size===0){console.log('🔧Criandogruposbásicos...');this._criarGruposBasicos();}//Checkifmapisreadyif(!this.map){console.error('Mapisnotinitialized');return;}console.log(`Mapapronto,processando${pontos.length}pontos...`);//Adicionarcadapontopontos.forEach((ponto,index)=>{try{console.log(`Processandoponto${index+1}/${pontos.length}:${ponto.nome}(ID:${ponto.id})`);this.addMarker(ponto);}catch(error){console.error(`Erroaoadicionarponto${ponto.id||index}:`,error);}});//Debug:mostrarquantospontosforamadicionadosporcategoriaconsole.log(`Pontoscarregadosporcategoria:`);this.gruposPorCategoria.forEach((grupo,categoria)=>{if(categoria!=='todos'){console.log(`-${categoria}:${grupo.getLayers().length}pontos`);}});console.log(`Totalde${pontos.length}pontosprocessados`);console.log(`📍Totaldemarcadorescriados:${this.marcadores.size}`);}catch(error){console.error('Erroaocarregarpontos:',error);}}/***Criagruposbásicosnecessários*@private*/_criarGruposBasicos(){//!TODO:Implementarsistemadefavoritos//constgruposNecessarios=['todos','favoritos','geral','esportes-lazer',//'gastronomia','geek-nerd','casas-noturnas'];constgruposNecessarios=['todos','geral','esportes-lazer','gastronomia','geek-nerd','casas-noturnas'];gruposNecessarios.forEach(categoria=>{if(!this.gruposPorCategoria.has(categoria)){this.gruposPorCategoria.set(categoria,L.layerGroup());}});}/***Aplicatemainicialbaseadonaspreferênciassalvas**Usadopor:init()*@private*/_aplicarTemaInicial(){try{//Sempreaplicartemaescurothis._aplicarTemaNoMapa(true);}catch(error){console.error('Erroaoaplicartemainicial:',error);}}/***Aplicatemaespecíficonomapa**@param{boolean}temaEscuro-Sedeveaplicartemaescuro*@private*/_aplicarTemaNoMapa(temaEscuro=false){try{//Paramantersimplicidade,mantemossempreacamadaderuas//OtemaescuroseráaplicadoviaCSSnainterfaceconsole.log(`Tema${temaEscuro?'escuro':'claro'}aplicadoaomapa`);}catch(error){console.error('Erroaoaplicartemanomapa:',error);}}/***Configuraeventlistenersprincipaisdomapa**Implementalistenerspara:*-Cliquesnomapa(modoadição)*-Eventosdobancodedados*-Mudançasdeautenticação**Usadopor:init()*@private*/_configurarEventListeners(){//Clicknomapaparaadicionarpontos(apenasadminemmodoadição)this.map.on('click',(e)=>{if(this._isAdminEmModoAdicao()){this._iniciarAdicaoPonto(e.latlng);}});//Eventosdosistemadedadosthis._configurarEventosDatabase();//Eventosdeautenticaçãothis._configurarEventosAuth();}/***Configuraeventosrelacionadosaobancodedados*@private*/_configurarEventosDatabase(){//Pontoadicionadodocument.addEventListener('database_pontoAdicionado',(e)=>{this.addMarker(e.detail);});//Pontoatualizadodocument.addEventListener('database_pontoAtualizado',(e)=>{this.atualizarMarcador(e.detail);});//Pontoremovidodocument.addEventListener('database_pontoRemovido',(e)=>{this.removeMarker(e.detail.id);});//Categoriascarregadas/atualizadas-recarregarmarcadoresdocument.addEventListener('database_categoriasCarregadas',()=>{console.log('Categoriascarregadas,recarregandomarcadores...');this.recarregarMarcadores();});}/***Configuraeventosrelacionadosàautenticação*@private*/_configurarEventosAuth(){document.addEventListener('authStateChanged',(e)=>{constisAdmin=e.detail.type==='login'&&e.detail.user?.role==='administrator';this._atualizarControlesAdmin(isAdmin);//Recarregarpontosbaseadononovocontextodeusuáriothis.reloadPoints();});}/***Verificaseousuárioéadmineestáemmodoadição*@returns{boolean}*@private*/_isAdminEmModoAdicao(){returnwindow.authManager?.isAdmin?.()&&this.modoAdicao;}/***Configuracontrolesespecíficosdomapa**Removecontrolesdesnecessáriosparainterfacelimpa*Adicionacontrolesespecíficosparaadministradores**Usadopor:init()*@private*/_configurarControles(){try{//Removercontrolespadrãoparainterfacemaislimpa//Oscontrolesdezoomsãoremovidosintencionalmente//Adicionarcontrolesespecíficosparaadminsif(window.authManager?.isAdmin?.()){this._adicionarControlesAdmin();}console.log('Controlesdomapaconfigurados');}catch(error){console.error('Erroaoconfigurarcontroles:',error);}}/***Adicionacontrolesespecíficosparaadministradores*@private*/_adicionarControlesAdmin(){//Controledecoordenadasparafacilitaradiçãodepontosthis._adicionarControleCoordenadas();}/***Adicionacontroledecoordenadasparaadmins*@private*/_adicionarControleCoordenadas(){//!TODO:Implementspecificmapcontrolsifneeded//Porenquanto,coordenadassãomostradasnoconsolenoclick}/***Atualizacontrolesbaseadonostatusdeadmin**@param{boolean}isAdmin-Seousuárioéadministrador*Usadopor:_configurarEventosAuth()*@private*/_atualizarControlesAdmin(isAdmin){try{if(isAdmin){this._adicionarControlesAdmin();}else{this._removerControlesAdmin();}}catch(error){console.error('Erroaoatualizarcontrolesadmin:',error);}}/***Removecontrolesespecíficosdeadministrador*@private*/_removerControlesAdmin(){//!TODO:Implementremovalofspecificcontrolsifadded//Porenquanto,apenasdesabilitamododeadiçãothis.modoAdicao=false;}//==========================================//MÉTODOSPÚBLICOS-INTERFACEPRINCIPAL//==========================================/***Alternatemadomapa(métodopúblico)**@param{boolean}temaEscuro-Sedeveaplicartemaescuro*Usadopor:interface*/alternarTemaMapa(temaEscuro=false){try{this._aplicarTemaNoMapa(temaEscuro);console.log(`Temadomapaalteradopara${temaEscuro?'escuro':'claro'}`);}catch(error){console.error('Erroaoalterartemadomapa:',error);}}/***Aplicatemainicialbaseadonasconfiguraçõessalvas**Métodopúblicomantidoparacompatibilidadecomcódigolegado*@deprecatedUse_aplicarTemaInicial()internamente*Usadopor:interface*/aplicarTemaInicial(){this._aplicarTemaInicial();}/***Adicionacontroledecoordenadasparaadministradores**Exibecoordenadasemtemporealparafacilitaradiçãodepontos*Usadopor:_adicionarControlesAdmin()*/adicionarControlesCoordenadas(){try{constcontroleCoordenadas=L.control({position:'bottomleft'});controleCoordenadas.onAdd=function(){constdiv=L.DomUtil.create('div','controle-coordenadas');div.style.cssText=`background:rgba(255,255,255,0.9);padding:5px10px;border-radius:5px;fontSize:12px;fontFamily:monospace;border:1pxsolid#ccc;box-shadow:02px4pxrgba(0,0,0,0.1);`;div.innerHTML='Lat:-,Lng:-';returndiv;};controleCoordenadas.addTo(this.map);//Atualizarcoordenadasnomovimentodomousethis.map.on('mousemove',(e)=>{const{lat,lng}=e.latlng;constdiv=document.querySelector('.controle-coordenadas');if(div){div.innerHTML=`Lat:${lat.toFixed(6)},Lng:${lng.toFixed(6)}`;}});console.log('📍Controledecoordenadasadicionado');}catch(error){console.error('Erroaoadicionarcontroledecoordenadas:',error);}}//==========================================//MÉTODOSDECARREGAMENTOEEXIBIÇÃO//==========================================/***Mostraindicadordecarregamento*/mostrarCarregamento(texto='Carregando...'){constdiv=document.createElement('div');div.className='loading-overlay';div.style.cssText=`position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:10000;color:white;font-size:18px;`;div.innerHTML=`<divstyle="text-align:center;"><divstyle="border:4pxsolid#f3f3f3;border-radius:50%;border-top:4pxsolid#3498db;width:40px;height:40px;animation:spin2slinearinfinite;margin:0auto10px;"></div>${texto}</div>`;//AdicionaranimaçãoCSSif(!document.querySelector('#loading-animation-style')){conststyle=document.createElement('style');style.id='loading-animation-style';style.textContent='@keyframesspin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}';document.head.appendChild(style);}document.body.appendChild(div);returndiv;}/***Carregartodosospontosnomapa*/loadPoints(){if(!window.databaseManager){console.warn('DatabaseManagernãodisponível');return;}//Obtercontextodousuárioatualconstuser=window.authManager?.getCurrentUser();constuserRole=user?.role||'visitor';constusername=user?.username||null;constpontos=window.databaseManager.buscarPorCategoria('todos',userRole,username);//Mostrarfeedbackvisualimediatothis._mostrarCarregamento(true);//Limparmarcadoresexistentesthis.marcadores.forEach(marcador=>{this.map.removeLayer(marcador);});this.marcadores.clear();//Carregaremlotesparamelhorperformancethis._loadPointsInBatches(pontos);}/***Limparcachedeícones(útilquandocategoriassãoatualizadas)*/limparCacheIcones(){this.iconCache.clear();if(this._iconeCache){this._iconeCache.clear();}console.log('Cachedeíconeslimpo');}/***Recarregartodososmarcadorescomíconesatualizados*/recarregarMarcadores(){this.limparCacheIcones();//Recarregarpontosparaaplicarnovosíconesif(window.databaseManager){this.carregarPontos();}}/***Limpartodososmarcadoresdomapa*/clearMarkers(){try{console.log('🧹Limpandomarcadoresexistentes...');//Removergruposdomapaelimparsuascamadasthis.gruposPorCategoria.forEach((grupo,categoria)=>{if(this.map.hasLayer(grupo)){this.map.removeLayer(grupo);console.log(`➖Grupo${categoria}removidodomapa`);}grupo.clearLayers();});//Limpartodasasreferênciasthis.gruposPorCategoria.clear();this.marcadores.clear();console.log('Marcadoreslimpos');}catch(error){console.error('Erroaolimparmarcadores:',error);}}/***Adicionarmarcadoraomapa*@param{Object}ponto-Dadosdoponto*/addMarker(ponto){try{if(!ponto||!ponto.id||!ponto.nome){console.warn('Dadosdopontoinválidos:',ponto);return;}//Verificarsejáexisteummarcadorparaestepontoif(this.marcadores&&this.marcadores.has(ponto.id)){console.log(`Marcadorjáexisteparaponto${ponto.id},ignorando...`);return;}console.log(`📍Adicionandomarcador:${ponto.nome}(ID:${ponto.id})`);//Verificarcoordenadasletcoordenadas;if(ponto.coordenadas&&Array.isArray(ponto.coordenadas)&&ponto.coordenadas.length===2){coordenadas=ponto.coordenadas;//[latitude,longitude]}elseif(ponto.latitude&&ponto.longitude){coordenadas=[ponto.latitude,ponto.longitude];}else{console.warn(`Coordenadasinválidasparaponto:${ponto.nome}`,ponto.coordenadas);return;}//Obtercategoriaouusarpadrãoletcategoria=null;if(window.databaseManager&&window.databaseManager.obterCategoria){categoria=window.databaseManager.obterCategoria(ponto.categoria);}if(!categoria){console.warn(`Categorianãoencontrada:${ponto.categoria},usandopadrão`);categoria={id:ponto.categoria||'geral',cor:'#3b82f6',icon:'fasfa-map-marker-alt',nome:ponto.categoria||'Geral'};}//CriaríconeconstisPendente=ponto.status==='pendente';console.log(`Criandoíconeparacategoria:${categoria.id}(pendente:${isPendente})`);consticone=this._criarIconeOtimizado(categoria,isPendente);//Criarmarcadorconstmarcador=L.marker(coordenadas,{icon:icone,title:ponto.nome,riseOnHover:true});//Configurareventosdomarcadormarcador.on('click',(e)=>{e.originalEvent?.stopPropagation();this.selecionarPonto(ponto);});//Eventosdehoversimplesmarcador.on('mouseover',()=>{constelement=marcador.getElement();if(element){consticonDiv=element.querySelector('.marker-icon');if(iconDiv){iconDiv.style.transform='scale(1.1)';iconDiv.style.boxShadow='04px12pxrgba(0,0,0,0.6)';}}});marcador.on('mouseout',()=>{constelement=marcador.getElement();if(element&&!element.classList.contains('marcador-selecionado')){consticonDiv=element.querySelector('.marker-icon');if(iconDiv){iconDiv.style.transform='scale(1)';iconDiv.style.boxShadow='03px8pxrgba(0,0,0,0.4)';}}});//Garantirqueosgruposexistamthis._criarGruposBasicos();//InicializarMapsenecessárioif(!this.marcadores){this.marcadores=newMap();}//AdicionaraogrupodacategoriaespecíficaconstcategoriaId=categoria.id;if(!this.gruposPorCategoria.has(categoriaId)){this.gruposPorCategoria.set(categoriaId,L.layerGroup());}constgrupoCategoriaAtual=this.gruposPorCategoria.get(categoriaId);grupoCategoriaAtual.addLayer(marcador);//Adicionartambémaogrupo"todos"if(!this.gruposPorCategoria.has('todos')){this.gruposPorCategoria.set('todos',L.layerGroup());}constgrupoTodos=this.gruposPorCategoria.get('todos');grupoTodos.addLayer(marcador);//***IMPORTANTE:Adicionarosgruposaomapaparaqueosmarcadoresapareçam***if(!this.map.hasLayer(grupoCategoriaAtual)){grupoCategoriaAtual.addTo(this.map);console.log(`Grupodacategoria${categoriaId}adicionadoaomapa`);}if(!this.map.hasLayer(grupoTodos)){grupoTodos.addTo(this.map);console.log('Grupo"todos"adicionadoaomapa');}//Salvarreferênciadomarcadorthis.marcadores.set(ponto.id,marcador);console.log(`Marcadoradicionado:${ponto.nome}nacategoria${categoriaId}`);//Debug:Verificarseomarcadorfoiadicionadocorretamenteaosgruposconsole.log(`Debuggruposapósadicionarmarcador:`);console.log(`-Grupo${categoriaId}:${grupoCategoriaAtual.getLayers().length}marcadores`);console.log(`-Grupotodos:${grupoTodos.getLayers().length}marcadores`);console.log(`-Totalmarcadoressalvos:${this.marcadores.size}`);}catch(error){console.error('Erroaoadicionarmarcador:',error,ponto);}}/***Selecionarpontoeexibirnopainellateral*@param{Object}ponto-Dadosdoponto*/selecionarPonto(ponto){try{console.log('📍Pontoselecionado:',ponto.nome);//Incrementarvisualizaçõesthis.incrementarViews(ponto.id);//Destacarmarcadorselecionadoprimeirothis.destacarMarcadorSelecionado(ponto.id);//Exibirnopainellateralcomdelayparaevitarconflitosif(window.infoPanelManager){//UsarrequestAnimationFrameparagarantirqueoeventosejaprocessadorequestAnimationFrame(()=>{window.infoPanelManager.show(ponto);});}else{console.warn('InfoPanelManagernãodisponível');}}catch(error){console.error('Erroaoselecionarponto:',error);}}/***Destacarmarcadorselecionado*@param{number}pontoId-IDdoponto*/destacarMarcadorSelecionado(pontoId){//Removerdestaquedeoutrosmarcadoresthis.marcadores.forEach((marcador,id)=>{constelement=marcador.getElement();if(element){element.classList.remove('marcador-selecionado');}});//DestacarmarcadoratualconstmarcadorAtual=this.marcadores.get(pontoId);if(marcadorAtual){constelement=marcadorAtual.getElement();if(element){element.classList.add('marcador-selecionado');}}}/***Obteríconelegívelparacategoria*@param{Object}categoria-Dadosdacategoria*@returns{string}Emojiouíconelegível*/obterIconeLegivel(categoria){if(!categoria)return'📍';//MapearcategoriasparaemojislegíveisconstmapaIcones={'geral':'🎭','esportes-lazer':'','gastronomia':'🍽','geek-nerd':'🎮','casas-noturnas':'🍻'//!TODO:Implementarsistemadefavoritos//'favoritos':'❤'};//TentarencontrarporIDdacategoriaif(mapaIcones[categoria.id]){returnmapaIcones[categoria.id];}//Fallbackparaíconepadrãoreturn'📍';}/***Filtrarpontosporcategoria*@param{string}categoria-Categoriaafiltrar*/filterByCategory(categoria,username=null){console.log(`Iniciandofiltroporcategoria:${categoria}`);console.log(`Gruposdisponíveis:`,Array.from(this.gruposPorCategoria.keys()));//Garantirqueosgruposexistamif(!this.gruposPorCategoria.size){console.log('📍Inicializandogruposdecategorias...');this._inicializarGruposCategorias();}//RemoverTODOSosgruposativosdomapaprimeiroletgruposRemovidos=0;this.gruposPorCategoria.forEach((grupo,cat)=>{if(this.map.hasLayer(grupo)){this.map.removeLayer(grupo);gruposRemovidos++;console.log(`➖Removidogrupo:${cat}(${grupo.getLayers().length}pontos)`);}});console.log(`Totaldegruposremovidos:${gruposRemovidos}`);//!TODO:Implementarsistemadefavoritos//Lógicaespecialparafavoritos//if(categoria==='favoritos'&&username){//this.filtrarFavoritos(username);//this.activeCategory=categoria;//console.log(`Filtrodefavoritosaplicadopara:${username}`);//return;//}if(categoria==='favoritos'){console.log('Sistemadefavoritosemdesenvolvimento');return;}//Adicionargrupodacategoriaselecionadaif(categoria==='todos'){//Mostrartodosospontos-adicionartodososgruposdecategoriasreaisletgruposAdicionados=0;lettotalPontos=0;this.gruposPorCategoria.forEach((grupo,cat)=>{if(cat!=='favoritos'&&cat!=='todos'){this.map.addLayer(grupo);gruposAdicionados++;totalPontos+=grupo.getLayers().length;console.log(`➕Adicionadogrupo:${cat}(${grupo.getLayers().length}pontos)`);}});this.activeCategory='todos';console.log(`Mostrandotodosospontos(${gruposAdicionados}grupos,${totalPontos}pontostotal)`);}elseif(this.gruposPorCategoria.has(categoria)){//Mostrarapenaspontosdacategoriaespecíficaconstgrupo=this.gruposPorCategoria.get(categoria);this.map.addLayer(grupo);this.activeCategory=categoria;console.log(`Mostrandopontosdacategoria:${categoria}(${grupo.getLayers().length}pontos)`);}else{//Categorianãoexiste,fallbackpara"todos"console.warn(`Categoria'${categoria}'nãoencontrada,mostrandotodos`);letgruposAdicionados=0;lettotalPontos=0;this.gruposPorCategoria.forEach((grupo,cat)=>{if(cat!=='favoritos'&&cat!=='todos'){this.map.addLayer(grupo);gruposAdicionados++;totalPontos+=grupo.getLayers().length;console.log(`➕Adicionadogrupo(fallback):${cat}(${grupo.getLayers().length}pontos)`);}});this.activeCategory='todos';}console.log(`Filtroaplicado:${this.activeCategory}`);//VerificarquantospontosestãovisíveisnomapaletpontosVisiveis=0;this.gruposPorCategoria.forEach((grupo,cat)=>{if(this.map.hasLayer(grupo)){pontosVisiveis+=grupo.getLayers().length;}});console.log(`Totaldepontosvisíveis:${pontosVisiveis}`);}/***Filtrarapenaspontosfavoritosdousuário-FUNCIONALIDADEEMDESENVOLVIMENTO*!TODO:Implementarsistemacompletodefavoritos*/filtrarFavoritos(username){console.log('!TODO:ImplementarfiltrarFavoritos-username:',username);console.log('Sistemadefavoritosemdesenvolvimento');//Funçãotemporariamentedesabilitadareturn;}/***Recarregarpontosbaseadonopapeldousuário*Otimizadocomcarregamentoemlotes*/reloadPoints(userRole='visitor',username=null){try{console.log(`Recarregandopontospara${userRole}...`);//Verificarseomapafoiinicializadoif(!this.map){console.warn('Mapanãofoiinicializado,inicializandoagora...');this.init();if(!this.map){console.error('Falhaaoinicializaromapa');return;}}//VerificarseoDatabaseManagerestádisponívelif(!window.databaseManager){console.error('DatabaseManagernãodisponível');return;}//Mostrarindicadordecarregamentothis._mostrarCarregamento(true);//Obterpontosbaseadonoperfilletpontos;if(userRole==='administrator'){constconfirmados=window.databaseManager.getPontos()||[];constpendentes=window.databaseManager.getPontosPendentes()||[];pontos=[...confirmados,...pendentes];}else{pontos=window.databaseManager.getPontos()||[];//Apenasconfirmados}console.log(`📦${pontos.length}pontosobtidosdobancodedados`);//Debug:mostraralgunspontosdeexemploif(pontos.length>0){console.log('Exemplodepontos:',pontos.slice(0,3).map(p=>({id:p.id,nome:p.nome,categoria:p.categoria,coordenadas:p.coordenadas,ativo:p.ativo})));//VerificarsehácoordenadasválidasconstpontosComCoordenadas=pontos.filter(p=>p.coordenadas&&Array.isArray(p.coordenadas)&&p.coordenadas.length===2);console.log(`📍Pontoscomcoordenadasválidas:${pontosComCoordenadas.length}`);}else{console.warn('NenhumpontoencontradonoDatabaseManager');//TentarforçarrecarregamentodoDatabaseManagerif(window.databaseManager.carregarTodosDados){console.log('TentandorecarregardadosdoDatabaseManager...');window.databaseManager.loadAllData().then(()=>{console.log('Dadosrecarregados,tentandonovamente...');setTimeout(()=>this.reloadPoints(userRole,username),100);}).catch(error=>{console.error('ErroaorecarregarDatabaseManager:',error);this._mostrarCarregamento(false);});return;}else{this._mostrarCarregamento(false);return;}}//Limparestadoanteriorcompletamenteconsole.log('Limpandoestadoanterior...');this.clearMarkers();this.limparCacheIcones();//Recriargruposbásicosconsole.log('Criandogruposbásicos...');this._criarGruposBasicos();//Senãohápontos,finalizaraquiif(pontos.length===0){console.log('Nenhumpontoparacarregar');this._finalizarCarregamento(0);return;}//Carregarpontosemlotesparamelhorperformanceconsole.log('📍Iniciandocarregamentoemlotes...');this._loadPointsInBatches(pontos);}catch(error){console.error('Erroaorecarregarpontos:',error);this._mostrarCarregamento(false);}}/***Atualizarmarcador*@param{Object}ponto-Dadosatualizadosdoponto*/atualizarMarcador(ponto){if(this.marcadores.has(ponto.id)){//Removermarcadorantigothis.removeMarker(ponto.id);//Adicionarmarcadoratualizadothis.addMarker(ponto);}}/***Removermarcador*@param{number}id-IDdoponto*/removeMarker(id){if(this.marcadores.has(id)){constmarcador=this.marcadores.get(id);//Removerdetodososgruposthis.gruposPorCategoria.forEach(grupo=>{grupo.removeLayer(marcador);});//Removerdomapathis.map.removeLayer(marcador);//Removerdareferênciathis.marcadores.delete(id);}}/***Incrementarvisualizaçõesdoponto*@param{number}id-IDdoponto*/incrementarViews(id){constponto=databaseManager.obterPonto(id);if(ponto&&ponto.metadata){ponto.metadata.views=(ponto.metadata.views||0)+1;databaseManager.salvarNoLocalStorage();}}/***Iniciarmododeadiçãodeponto*@param{Object}latlng-Coordenadasdoclique*/iniciarAdicaoPonto(latlng){if(!authManager.isAdmin()){return;}//Disparareventoparaabrirmodaldeadiçãoconstevent=newCustomEvent('abrirModalAdicao',{detail:{coordenadas:[latlng.lat,latlng.lng]}});document.dispatchEvent(event);}/***Ativar/desativarmododeadição*@param{boolean}ativo-Seomododeveestarativo*/setModoAdicao(ativo){this.modoAdicao=ativo;//Alterarcursordomapaif(ativo){this.map.getContainer().style.cursor='crosshair';}else{this.map.getContainer().style.cursor='';}}/***Centralizarmapaempontoespecífico*@param{number}id-IDdoponto*/centralizarEm(id){constponto=databaseManager.obterPonto(id);if(ponto){this.map.setView(ponto.coordenadas,16);//Abrirpopupdomarcadorif(this.marcadores.has(id)){this.marcadores.get(id).openPopup();}}}/***Editarponto(placeholderparaintegraçãocommodal)*@param{number}id-IDdoponto*/editarPonto(id){constevent=newCustomEvent('editarPonto',{detail:{id}});document.dispatchEvent(event);}/***Removerpontocomconfirmação*@param{number}id-IDdoponto*/asyncremoverPonto(id){constponto=databaseManager.obterPonto(id);if(!ponto)return;constconfirmacao=confirm(`Temcertezaquedesejaremover"${ponto.nome}"?`);if(confirmacao){try{awaitdatabaseManager.deletarPonto(id);alert('Pontoremovidocomsucesso!');}catch(error){alert('Erroaoremoverponto:'+error.message);}}}/***Atualizarcontrolesadministrativos*@param{boolean}isAdmin-Seousuárioéadmin*/atualizarControlesAdmin(isAdmin){if(isAdmin&&!document.querySelector('.controle-coordenadas')){this.adicionarControlesCoordenadas();}}/***Buscarpontospróximosàposiçãoatual*@param{number}raio-Raioemkm*/buscarProximos(raio=2){constcentro=this.map.getCenter();//Obtercontextodousuárioatualconstuser=window.authManager?.getCurrentUser();constuserRole=user?.role||'visitor';constusername=user?.username||null;constpontos=databaseManager.buscarPorProximidade(centro.lat,centro.lng,raio,userRole,username);//Destacarpontospróximosthis.destacarPontos(pontos.map(p=>p.id));returnpontos;}/***Destacarpontosespecíficos*@param{Array}ids-IDsdospontosadestacar*/destacarPontos(ids){//Removerdestaquesanterioresthis.marcadores.forEach(marcador=>{marcador.setOpacity(0.5);});//Destacarpontosselecionadosids.forEach(id=>{if(this.marcadores.has(id)){this.marcadores.get(id).setOpacity(1);}});//Restauraropacidadeapós5segundossetTimeout(()=>{this.marcadores.forEach(marcador=>{marcador.setOpacity(1);});},5000);}/***CentralizarmapaemBrasília*/centralizarBrasilia(){constcentro=[-15.794700,-47.890000];this.map.setView(centro,11);}/***Obterboundsdetodosospontos*@returns{Object}BoundsdoLeaflet*/obterBoundsPontos(){//Obtercontextodousuárioatualconstuser=window.authManager?.getCurrentUser();constuserRole=user?.role||'visitor';constusername=user?.username||null;constpontos=databaseManager.buscarPorCategoria('todos',userRole,username);if(pontos.length===0)returnnull;constcoordenadas=pontos.map(p=>p.coordenadas);returnL.latLngBounds(coordenadas);}/***Ajustarzoomparamostrartodosospontos*/ajustarZoomParaTodos(){constbounds=this.obterBoundsPontos();if(bounds){this.map.fitBounds(bounds,{padding:[20,20]});}}/***Forçaredimensionamentodomapa-útilapósmudançasdelayout*/forcarRedimensionamento(){if(this.map){console.log('Forçandoredimensionamentodomapa...');this.map.invalidateSize(true);//SegundainvalidaçãoparagarantirsetTimeout(()=>{if(this.map){this.map.invalidateSize(true);}},100);}}/***Mostrar/Ocultarindicadordecarregamentodomapa(otimizado)*@private*/_mostrarCarregamento(mostrar){constmapContainer=document.getElementById(this.containerId);if(!mapContainer)return;letloadingIndicator=mapContainer.querySelector('.map-loading');if(mostrar&&!loadingIndicator){loadingIndicator=document.createElement('div');loadingIndicator.className='map-loading';loadingIndicator.innerHTML=`<divstyle="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.8);color:white;padding:8px16px;border-radius:6px;z-index:1000;font-size:14px;font-family:Arial,sans-serif;">⚡Carregando...</div>`;mapContainer.appendChild(loadingIndicator);}elseif(!mostrar&&loadingIndicator){loadingIndicator.remove();}}/***Carregarpontosemlotesparamelhorperformance*@private*/_loadPointsInBatches(pontos){constBATCH_SIZE=100;//Aumentadode50para100pontosporvezparacarregamentomaisrápidoconstBATCH_DELAY=5;//Reduzidode10mspara5msentrecadaloteletindice=0;consttotalPontos=pontos.length;constprocessarLote=()=>{constloteAtual=pontos.slice(indice,indice+BATCH_SIZE);//ProcessarloteatualloteAtual.forEach(ponto=>{try{this.addMarker(ponto);}catch(error){console.error(`Erroaoadicionarponto${ponto.id}:`,error);}});indice+=BATCH_SIZE;//Atualizarprogressovisualconstprogresso=Math.min(100,Math.round((indice/totalPontos)*100));this._atualizarProgressoCarregamento(progresso);//Processarpróximoloteoufinalizarif(indice<totalPontos){setTimeout(processarLote,BATCH_DELAY);}else{this._finalizarCarregamento(totalPontos);}};//Iniciarprocessamentoconsole.log(`📍Iniciandocarregamentode${totalPontos}pontosemlotes...`);processarLote();}/***Atualizarprogressodocarregamento*@private*/_atualizarProgressoCarregamento(progresso){constmapContainer=document.getElementById(this.containerId);constloadingIndicator=mapContainer?.querySelector('.map-loadingspan');if(loadingIndicator){loadingIndicator.textContent=`Carregandopontos...${progresso}%`;}}/***Finalizarcarregamentocomfeedback*@private*/_finalizarCarregamento(totalPontos){console.log(`${totalPontos}pontoscarregadoscomsucesso`);//AplicarfiltroparagarantirqueosmarcadoressejamvisíveissetTimeout(()=>{constcategoriaAtual=this.activeCategory||'todos';console.log(`Aplicandofiltrofinal:${categoriaAtual}`);this.filterByCategory(categoriaAtual);},50);//Removerindicadordecarregamentorapidamente(otimização)setTimeout(()=>{this._mostrarCarregamento(false);},100);//Reduzidode500mspara100ms//Dispatcheventodecarregamentocompletowindow.dispatchEvent(newCustomEvent('mapaPontosCarregados',{detail:{totalPontos}}));}/***Cachedeíconesparaevitarrecriaçãodesnecessária*@private*/_obterIconeCache(categoria,isPendente=false){constcacheKey=`${categoria.id}_${isPendente}_${window.innerWidth<=768?'mobile':(window.innerWidth<=1024?'tablet':'desktop')}`;if(!this._iconeCache){this._iconeCache=newMap();}if(!this._iconeCache.has(cacheKey)){consticone=this._criarIconeOtimizado(categoria,isPendente);this._iconeCache.set(cacheKey,icone);}returnthis._iconeCache.get(cacheKey);}/***Criaríconeotimizado(simplificadoemaisrobusto)*@private*/_criarIconeOtimizado(categoria,isPendente=false){//TamanhosresponsivosconstisMobile=window.innerWidth<=768;constisTablet=window.innerWidth<=1024;lettamanho,fontSize;if(isMobile){tamanho=48;fontSize=26;}elseif(isTablet){tamanho=42;fontSize=22;}else{tamanho=38;fontSize=20;}constcor=categoria?.cor||'#3b82f6';consticon=categoria?.icon||'fasfa-map-marker-alt';constopacity=isPendente?0.7:1;constborderStyle=isPendente?'dashed':'solid';returnL.divIcon({className:'marcador-otimizado',html:`<divclass="marker-icon"style="width:${tamanho}px!important;height:${tamanho}px!important;background-color:${cor};color:white;border-radius:50%;display:flex!important;align-items:center!important;justify-content:center!important;border:3px${borderStyle}white!important;box-shadow:03px10pxrgba(0,0,0,0.4)!important;font-size:${fontSize}px!important;opacity:${opacity};cursor:pointer!important;position:relative!important;z-index:1000!important;transition:all0.2sease!important;"><iclass="${icon}"style="color:white!important;font-size:${fontSize}px!important;line-height:1!important;pointer-events:none!important;"></i></div>`,iconSize:[tamanho,tamanho],iconAnchor:[tamanho/2,tamanho/2],popupAnchor:[0,-tamanho/2],className:'marcador-leaflet'});}}//CriarinstânciaglobalseminicializarautomaticamenteconstmapManager=newMapManager();//FunçãoparainicializaromapaapósDOMestarprontofunctioninicializarMapa(containerId='map'){if(!mapManager.map){mapManager.init();}returnmapManager;}//Exportarparausoemmódulosif(typeofmodule!=='undefined'&&module.exports){module.exports={MapManager,inicializarMapa};}//Disponibilizarglobalmentewindow.MapManager=MapManager;window.mapManager=mapManager;window.inicializarMapa=inicializarMapa;//AdicionarCSSotimizadoparamarcadoresif(!document.querySelector('#map-markers-css')){conststyleSheet=document.createElement('style');styleSheet.id='map-markers-css';styleSheet.textContent=`.marcador-otimizado{overflow:visible!important;z-index:1000!important;}.marcador-otimizado.marker-icon{width:100%;height:100%;border:3pxsolidwhite;border-radius:50%;box-shadow:03px10pxrgba(0,0,0,0.4);display:flex;align-items:center;justify-content:center;color:white;cursor:pointer;transition:all0.2sease;overflow:visible!important;position:relative;}.marcador-otimizado.marker-icon:hover{transform:scale(1.1);box-shadow:04px12pxrgba(0,0,0,0.6);z-index:1001;}.marcador-otimizado.marker-iconi{display:flex;align-items:center;justify-content:center;width:100%;height:100%;}/*Garantirvisibilidadeemtodososdispositivos*/.leaflet-marker-icon.marcador-otimizado{overflow:visible!important;z-index:1000!important;}/*Correçãoparamarcadorescortados*/.leaflet-marker-pane{overflow:visible!important;}.leaflet-map-pane{overflow:visible!important;}`;document.head.appendChild(styleSheet);}
```


## Prioridades Identificadas

### 1. Sistema de Favoritos (Alta Prioridade)
- Implementar funcionalidade completa de favoritos
- Adicionar persistência de favoritos por usuário
- Criar filtro de pontos favoritos
- Interface para gerenciar favoritos

### 2. Controles de Mapa para Administradores (Média Prioridade)
- Implementar controles específicos de administração no mapa
- Sistema de coordenadas para facilitar adição de pontos
- Remoção de controles específicos quando não for admin

### 3. Estatísticas da Aplicação (Baixa Prioridade)
- Configuração de estatísticas da aplicação
- Métricas de uso e engagement

## Observações

- Todas as pendências foram identificadas automaticamente através dos comentários `!TODO:` no código
- As funcionalidades marcadas como "em desenvolvimento" devem ser priorizadas
- Sistema de favoritos é a principal funcionalidade pendente que afeta a experiência do usuário
