/***DynamicUserButtonComponent*Managestheuserbuttondisplaybasedonauthenticationstate*Showsdifferentstatesforvisitors,regularusers,andadministrators**@authorGeneratedbyGitHubCopilot*@version1.0.0*/classDynamicUserButton{constructor(){this.currentUser=null;this.isAuthenticated=false;this.isAdmin=false;this.desktopButton=null;this.mobileButton=null;this.userMenu=null;this.isMenuOpen=false;this.init();}/***Initializethedynamicuserbuttoncomponent*/init(){console.log('InitializingDynamicUserButton...');//WaitforDOMifnotreadyif(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',()=>{this.initializeComponent();});}else{this.initializeComponent();}}/***InitializecomponentafterDOMisready*/initializeComponent(){this.findButtonElements();this.updateButtonState();this.setupEventListeners();console.log('DynamicUserButtoninitializedsuccessfully');}/***Findandcachebuttonelements*/findButtonElements(){this.desktopButton=document.getElementById('desktop-login-btn');this.mobileButton=document.getElementById('mobile-login-btn');if(!this.desktopButton||!this.mobileButton){console.warn('DynamicUserButton:Somebuttonelementsnotfound.Desktop:',!!this.desktopButton,'Mobile:',!!this.mobileButton);}else{console.log('DynamicUserButton:Buttonelementsfoundsuccessfully');}}/***Updatebuttonstatebasedonauthenticationstatus*/updateButtonState(){//Checkauthenticationstatusthis.checkAuthenticationState();//Updatebothdesktopandmobilebuttonsiftheyexistif(this.desktopButton){this.updateButton(this.desktopButton);}if(this.mobileButton){this.updateButton(this.mobileButton);}}/***Checkcurrentauthenticationstate*/checkAuthenticationState(){if(window.authManager&&window.authManager.isAuthenticated()){this.isAuthenticated=true;this.currentUser=window.authManager.getCurrentUser();this.isAdmin=this.currentUser&&this.currentUser.role==='administrator';}else{this.isAuthenticated=false;this.currentUser=null;this.isAdmin=false;}}/***Updateindividualbuttonbasedonstate*@param{HTMLElement}button-Buttonelementtoupdate*/updateButton(button){if(!button)return;if(!this.isAuthenticated){//Visitorstate-showloginbuttonthis.setVisitorState(button);}elseif(this.isAdmin){//Administratorstate-showadminbuttonthis.setAdminState(button);}else{//Regularuserstate-showuserbuttonthis.setUserState(button);}}/***Setbuttontovisitorstate*@param{HTMLElement}button-Buttonelement*/setVisitorState(button){consticon=button.querySelector('i');consttext=button.querySelector('.login-btn-text');if(icon){icon.className='fasfa-user';}if(text){text.textContent='ENTRAR';}button.className='login-btn'+(button.classList.contains('mobile')?'mobile':'desktop');button.setAttribute('aria-label','Fazerlogin');}/***Setbuttontoregularuserstate*@param{HTMLElement}button-Buttonelement*/setUserState(button){consticon=button.querySelector('i');consttext=button.querySelector('.login-btn-text');if(icon){icon.className='fasfa-user';}if(text){text.innerHTML=`${this.currentUser.nome}<iclass="fasfa-chevron-downuser-menu-arrow"></i>`;}button.className='user-btn'+(button.classList.contains('mobile')?'mobile':'desktop');button.setAttribute('aria-label','Menudousu√°rio');}/***Setbuttontoadministratorstate*@param{HTMLElement}button-Buttonelement*/setAdminState(button){consticon=button.querySelector('i');consttext=button.querySelector('.login-btn-text');if(icon){icon.className='fasfa-shield-alt';}if(text){text.innerHTML=`${this.currentUser.nome}<iclass="fasfa-chevron-downuser-menu-arrow"></i>`;}button.className='admin-btn'+(button.classList.contains('mobile')?'mobile':'desktop');button.setAttribute('aria-label','Menudoadministrador');}/***Setupeventlisteners*/setupEventListeners(){//Desktopbuttonclickif(this.desktopButton){this.desktopButton.addEventListener('click',(e)=>this.handleButtonClick(e));}//Mobilebuttonclickif(this.mobileButton){this.mobileButton.addEventListener('click',(e)=>this.handleButtonClick(e));}//Listenforauthenticationstatechangesdocument.addEventListener('authStateChanged',()=>{console.log('DynamicUserButton:Authstatechanged,updatingbutton...');this.updateButtonState();});//Closemenuwhenclickingoutsidedocument.addEventListener('click',(e)=>{if(this.isMenuOpen&&!e.target.closest('.user-dropdown-menu')&&!e.target.closest('.user-btn')&&!e.target.closest('.admin-btn')){this.closeUserMenu();}});//ClosemenuwithESCkeydocument.addEventListener('keydown',(e)=>{if(e.key==='Escape'&&this.isMenuOpen){this.closeUserMenu();}});//Listenforresizeeventstorepositionmenuifopenwindow.addEventListener('resize',()=>{if(this.isMenuOpen&&this.userMenu){this.closeUserMenu();//Closeonresizeforsimplicity}});}/***Handlebuttonclick*@param{Event}e-Clickevent*/handleButtonClick(e){e.preventDefault();e.stopPropagation();if(!this.isAuthenticated){//Showloginmodalforvisitorsthis.openLoginModal();}else{//Toggleusermenuforauthenticatedusersthis.toggleUserMenu(e.target);}}/***Openloginmodal*/openLoginModal(){if(window.loginModal){window.loginModal.open();}else{console.error('DynamicUserButton:Loginmodalnotavailable');}}/***Toggleusermenudropdown*@param{HTMLElement}buttonElement-Clickedbuttonelement*/toggleUserMenu(buttonElement){if(this.isMenuOpen){this.closeUserMenu();}else{this.openUserMenu(buttonElement);}}/***Openusermenudropdown*@param{HTMLElement}buttonElement-Buttonelementthattriggeredthemenu*/openUserMenu(buttonElement){this.closeUserMenu();//Closeanyexistingmenufirst//Createmenuifitdoesn'texistif(!this.userMenu){this.createUserMenu();}//Updatemenucontentbasedonuserrolethis.updateMenuContent();//Positionandshowmenuthis.positionMenu(buttonElement);this.userMenu.style.display='block';this.isMenuOpen=true;//AddanimationrequestAnimationFrame(()=>{this.userMenu.classList.add('show');});}/***Closeusermenudropdown*/closeUserMenu(){if(this.userMenu&&this.isMenuOpen){this.userMenu.classList.remove('show');setTimeout(()=>{if(this.userMenu){this.userMenu.style.display='none';}},200);this.isMenuOpen=false;}}/***Createusermenudropdownelement*/createUserMenu(){constmenuHTML=`<divid="user-dropdown-menu"class="user-dropdown-menu"><divclass="user-dropdown-content"><!--Menuitemswillbeinsertedhere--></div></div>`;//RemoveexistingmenuifanyconstexistingMenu=document.getElementById('user-dropdown-menu');if(existingMenu){existingMenu.remove();}document.body.insertAdjacentHTML('beforeend',menuHTML);this.userMenu=document.getElementById('user-dropdown-menu');}/***Updatemenucontentbasedonuserrole*/updateMenuContent(){if(!this.userMenu)return;constmenuContent=this.userMenu.querySelector('.user-dropdown-content');letmenuItems=[];if(this.isAdmin){//AdministratormenuitemsmenuItems=[{icon:'fasfa-tachometer-alt',label:'PainelAdministrativo',action:'dashboard',class:'admin-item'},{icon:'fasfa-user-cog',label:'Gerenciarconta',action:'account',class:'account-item'},{icon:'fasfa-sign-out-alt',label:'Sair',action:'logout',class:'logout-item'}];}else{//RegularusermenuitemsmenuItems=[{icon:'fasfa-user-cog',label:'Gerenciarconta',action:'account',class:'account-item'},{icon:'fasfa-sign-out-alt',label:'Sair',action:'logout',class:'logout-item'}];}menuContent.innerHTML=menuItems.map(item=>`<buttonclass="user-menu-item${item.class}"data-action="${item.action}"><iclass="${item.icon}"></i><span>${item.label}</span></button>`).join('');//AddeventlistenerstomenuitemsmenuItems.forEach((item,index)=>{constbutton=menuContent.children[index];button.addEventListener('click',()=>{this.handleMenuAction(item.action);this.closeUserMenu();});});}/***Handlemenuaction*@param{string}action-Actiontoperform*/handleMenuAction(action){switch(action){case'dashboard':this.openAdminDashboard();break;case'account':this.openAccountManagement();break;case'logout':this.performLogout();break;default:console.warn(`DynamicUserButton:Unknownaction:${action}`);}}/***Openadmindashboard*/openAdminDashboard(){if(window.location.pathname.endsWith('admin.html')){//Alreadyonadminpagereturn;}window.location.href='admin.html';}/***Openaccountmanagement(placeholder)*/openAccountManagement(){//!TODO:Implementaccountmanagementmodalthis.showNotification('Funcionalidadedegerenciamentodecontaemdesenvolvimento','info');}/***Performlogout*/performLogout(){if(window.authManager&&window.authManager.logout){window.authManager.logout();this.showNotification('Logoutrealizadocomsucesso','success');//UpdatebuttonstateandreloadpagesetTimeout(()=>{window.location.reload();},800);}else{console.error('DynamicUserButton:AuthManagernotavailableforlogout');}}/***Positionmenurelativetobutton*@param{HTMLElement}buttonElement-Buttonelement*/positionMenu(buttonElement){if(!this.userMenu||!buttonElement)return;constbuttonRect=buttonElement.getBoundingClientRect();constmenuWidth=220;constmenuHeight=this.isAdmin?140:100;constviewport={width:window.innerWidth,height:window.innerHeight};letleft=buttonRect.left;lettop=buttonRect.bottom+8;//Formobile,centerthemenumoreappropriatelyif(viewport.width<=768){left=Math.max(8,Math.min(buttonRect.left,viewport.width-menuWidth-8));}else{//Desktop:adjustifmenuwouldgooffscreenif(left+menuWidth>viewport.width){left=buttonRect.right-menuWidth;}}//Adjustverticalpositionifmenuwouldgooffscreenif(top+menuHeight>viewport.height){top=buttonRect.top-menuHeight-8;}//Ensuremenustayswithinviewportleft=Math.max(8,Math.min(left,viewport.width-menuWidth-8));top=Math.max(8,Math.min(top,viewport.height-menuHeight-8));this.userMenu.style.left=`${left}px`;this.userMenu.style.top=`${top}px`;}/***Shownotificationmessage*@param{string}message-Messagetoshow*@param{string}type-Typeofnotification(success,error,info,warning)*/showNotification(message,type='info'){if(window.infoPanelManager&&window.infoPanelManager.showNotification){window.infoPanelManager.showNotification(message,type);}else{console.log(`${type.toUpperCase()}:${message}`);}}/***Refreshthebuttonstate(calledexternallywhenauthstatechanges)*/refresh(){this.updateButtonState();}}//Initializegloballywindow.dynamicUserButton=newDynamicUserButton();